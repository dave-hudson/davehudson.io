{
  "metadata": {
    "version": "0.1",
    "parent": null
  },
  "conversation": [
    {
      "id": "e2a8b7dd-616e-4b25-b49c-2f79029eaeeb",
      "timestamp": "2025-07-27T12:51:24.369393+00:00",
      "type": "user_message",
      "content": "I need to extract the publication dates from the blog posts in the m6r.ai directory. Please read through all the post.ts files in the subdirectories and extract the dateTime field from each BlogPost constructor.\n\nThe directories are:\n- m6r.ai/000003-Introducing-Metaphor/\n- m6r.ai/000004-Code-reviews-using-Metaphor/\n- m6r.ai/000005-commit-critic/\n- m6r.ai/000008-Vibe-coding/\n- m6r.ai/000009-Initial-thoughts-on-Google-Gemini-25/\n- m6r.ai/000010-The-importance-of-context-in-AI-assisted-coding/\n- m6r.ai/000011-Introducing-Metaphor-commands/\n- m6r.ai/000012-Writing-tests-with-Metaphor/\n\nPlease return a list with the directory name and the dateTime value for each post.",
      "completed": true,
      "user_name": "gemini-1.5-flash",
      "model": "gemini-1.5-flash",
      "reasoning_capability": 1,
      "temperature": 0.7
    },
    {
      "id": "094c49e6-fdcd-47cc-be4e-47b8bdbaa2a2",
      "timestamp": "2025-07-27T12:51:25.158696+00:00",
      "type": "ai_response",
      "content": "",
      "completed": true,
      "model": "gemini-1.5-flash",
      "reasoning_capability": 1,
      "temperature": 0.7,
      "tool_calls": [
        {
          "id": "call_0",
          "name": "filesystem",
          "arguments": {
            "operation": "list_directory",
            "path": "m6r.ai"
          }
        }
      ]
    },
    {
      "id": "f66ef70f-551d-405b-85f0-540dab49266f",
      "timestamp": "2025-07-27T12:51:25.165352+00:00",
      "type": "tool_call",
      "content": "```json\n{\n    \"id\": \"call_0\",\n    \"name\": \"filesystem\",\n    \"arguments\": {\n        \"operation\": \"list_directory\",\n        \"path\": \"m6r.ai\"\n    }\n}\n```",
      "completed": true,
      "tool_calls": [
        {
          "id": "call_0",
          "name": "filesystem",
          "arguments": {
            "operation": "list_directory",
            "path": "m6r.ai"
          }
        }
      ]
    },
    {
      "id": "62caaca3-cfa1-478a-af6a-ea6b9d849af3",
      "timestamp": "2025-07-27T12:51:25.177870+00:00",
      "type": "tool_result",
      "content": "```json\n{\n    \"id\": \"call_0\",\n    \"name\": \"filesystem\",\n    \"content\": \"Directory: m6r.ai\\nItems: 11\\n\\n\\ud83d\\udcc1 000003-Introducing-Metaphor/\\n\\ud83d\\udcc1 000004-Code-reviews-using-Metaphor/\\n\\ud83d\\udcc1 000005-commit-critic/\\n\\ud83d\\udcc1 000008-Vibe-coding/\\n\\ud83d\\udcc1 000009-Initial-thoughts-on-Google-Gemini-25/\\n\\ud83d\\udcc1 000010-The-importance-of-context-in-AI-assisted-coding/\\n\\ud83d\\udcc1 000011-Introducing-Metaphor-commands/\\n\\ud83d\\udcc1 000012-Writing-tests-with-Metaphor/\\n\\ud83d\\udcc4 BlogPost.ts (698 bytes)\\n\\ud83d\\udcc4 Makefile.mk (860 bytes)\\n\\ud83d\\udcc4 blog.ts (8,086 bytes)\",\n    \"error\": null\n}\n```",
      "completed": true,
      "tool_results": [
        {
          "id": "call_0",
          "name": "filesystem",
          "content": "Directory: m6r.ai\nItems: 11\n\n\ud83d\udcc1 000003-Introducing-Metaphor/\n\ud83d\udcc1 000004-Code-reviews-using-Metaphor/\n\ud83d\udcc1 000005-commit-critic/\n\ud83d\udcc1 000008-Vibe-coding/\n\ud83d\udcc1 000009-Initial-thoughts-on-Google-Gemini-25/\n\ud83d\udcc1 000010-The-importance-of-context-in-AI-assisted-coding/\n\ud83d\udcc1 000011-Introducing-Metaphor-commands/\n\ud83d\udcc1 000012-Writing-tests-with-Metaphor/\n\ud83d\udcc4 BlogPost.ts (698 bytes)\n\ud83d\udcc4 Makefile.mk (860 bytes)\n\ud83d\udcc4 blog.ts (8,086 bytes)",
          "error": null
        }
      ]
    },
    {
      "id": "486bb833-6447-4136-9eb2-3cf456122a59",
      "timestamp": "2025-07-27T12:51:25.186048+00:00",
      "type": "user_message",
      "content": "",
      "completed": true,
      "tool_results": [
        {
          "id": "call_0",
          "name": "filesystem",
          "content": "Directory: m6r.ai\nItems: 11\n\n\ud83d\udcc1 000003-Introducing-Metaphor/\n\ud83d\udcc1 000004-Code-reviews-using-Metaphor/\n\ud83d\udcc1 000005-commit-critic/\n\ud83d\udcc1 000008-Vibe-coding/\n\ud83d\udcc1 000009-Initial-thoughts-on-Google-Gemini-25/\n\ud83d\udcc1 000010-The-importance-of-context-in-AI-assisted-coding/\n\ud83d\udcc1 000011-Introducing-Metaphor-commands/\n\ud83d\udcc1 000012-Writing-tests-with-Metaphor/\n\ud83d\udcc4 BlogPost.ts (698 bytes)\n\ud83d\udcc4 Makefile.mk (860 bytes)\n\ud83d\udcc4 blog.ts (8,086 bytes)",
          "error": null
        }
      ]
    },
    {
      "id": "022cfdbb-c397-44d0-bec9-904537b895e1",
      "timestamp": "2025-07-27T12:51:25.904592+00:00",
      "type": "ai_response",
      "content": "",
      "completed": true,
      "model": "gemini-1.5-flash",
      "reasoning_capability": 1,
      "temperature": 0.7,
      "tool_calls": [
        {
          "id": "call_0",
          "name": "filesystem",
          "arguments": {
            "path": "m6r.ai/000003-Introducing-Metaphor/post.ts",
            "operation": "read_file"
          }
        }
      ]
    },
    {
      "id": "99b30b1a-dcb6-45b3-b605-6c0aba924127",
      "timestamp": "2025-07-27T12:51:25.909880+00:00",
      "type": "tool_call",
      "content": "```json\n{\n    \"id\": \"call_0\",\n    \"name\": \"filesystem\",\n    \"arguments\": {\n        \"path\": \"m6r.ai/000003-Introducing-Metaphor/post.ts\",\n        \"operation\": \"read_file\"\n    }\n}\n```",
      "completed": true,
      "tool_calls": [
        {
          "id": "call_0",
          "name": "filesystem",
          "arguments": {
            "path": "m6r.ai/000003-Introducing-Metaphor/post.ts",
            "operation": "read_file"
          }
        }
      ]
    },
    {
      "id": "33067ccd-f33e-46da-9330-0148bcd139a1",
      "timestamp": "2025-07-27T12:51:25.919093+00:00",
      "type": "tool_result",
      "content": "```json\n{\n    \"id\": \"call_0\",\n    \"name\": \"filesystem\",\n    \"content\": \"File: m6r.ai/000003-Introducing-Metaphor/post.ts\\nSize: 7,025 bytes\\nEncoding: utf-8\\n\\nimport {h, VElement} from '../../lib/dvdi';\\nimport {BlogPost} from '../BlogPost';\\n\\nfunction blogArticle_000003(): VElement[] {\\n    return [\\n        h('p', {},\\n            'AI is rapidly changing the way we build software.  It offers expert advice tailored to developers\\\\' needs and can ' +\\n            'quickly automate many tasks.  While impressive, these tools are still focused on implementing software in the ' +\\n            'programming languages we would use if AI didn\\\\'t exist.'\\n        ),\\n        h('p', {},\\n            'Throughout the history of software engineering, the most significant productivity improvements have come when we ' +\\n            'move to a higher level of design.  So, today, I\\\\'m announcing the first public version of a simple new language, ' +\\n            'Metaphor, that helps make that move to a new higher-level of design.'\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'What problem is it solving?'),\\n            h('p', {},\\n                'Like people, AI agents cannot do things without clear, detailed instructions.  If we give ambiguous, ' +\\n                'incomplete, or conflicting instructions, they become confused and do unexpected things.  Unlike people, ' +\\n                'though, they usually won\\\\'t tell you they\\\\'re confused unless you ask them.'\\n            ),\\n            h('p', {},\\n                'Metaphor is designed to let you progressively build precise and unambiguous requirements so AI agents ' +\\n                'can generate software and documentation.  Instead of you and your team focusing on how you build software, ' +\\n                'you can concentrate on what you want and how you want it to behave.'\\n            )\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'How does it work?'),\\n            h('p', {},\\n                'Metaphor has a very simple structure.  Within this structure, Metaphor uses natural language.'\\n            ),\\n            h('p', {},\\n                'In this v0.1 release, there are just 5 keywords!  These are:'\\n            ),\\n            h('ul', {},\\n                h('li', {},\\n                    h('code', {}, 'Action:'),\\n                    ' the action we want the agent to perform.'\\n                ),\\n                h('li', {},\\n                    h('code', {}, 'Context:'),\\n                    ' information that will be required by the AI agent to do its work.'\\n                ),\\n                h('li', {},\\n                    h('code', {}, 'Embed:'),\\n                    ' embed another file into the current metaphor file as part of the context.'\\n                ),\\n                h('li', {},\\n                    h('code', {}, 'Include:'),\\n                    ' pull other metaphor files into the current metaphor file.'\\n                ),\\n                h('li', {},\\n                    h('code', {}, 'Role:'),\\n                    ' the role to be taken by an AI agent (this is a placeholder for now but will be used later).'\\n                )\\n            ),\\n            h('p', {},\\n                'The idea is to gather all the essential elements of a software design in one place.  This includes design ' +\\n                'considerations that would typically come from many different disciplines.  For example, it can capture ' +\\n                'ideas that usually originate with product managers, software engineers, QA analysts, security experts, and ' +\\n                'more.'\\n            ),\\n            h('p', {},\\n                'Once read, this is compiled into a \\\"large context prompt\\\" (LCP) for one or more backend AI agents to ' +\\n                'process.  An LCP is designed to provide all the information an AI agent needs to perform an action.  ' +\\n                'Examples of actions might be reviewing requirements for ambiguity, reviewing some existing software against ' +\\n                'a requirement, or building something completely new.'\\n            ),\\n            h('p', {},\\n                'Metaphor is designed to capture everything within the LCP, so there\\\\'s no need to rely on a continued ' +\\n                'dialogue or fine-tuned learning in any AI large language model (LLM).  This also makes it easy to discard ' +\\n                'anything that doesn\\\\'t work as desired and try out new ideas.'\\n            ),\\n            h('p', {},\\n                'Modular designs are vital in software development, so Metaphor descriptions can be broken into modular ' +\\n                'components (',\\n                h('code', {}, '.m6r'),\\n                ' files).  This makes it easy to build library-like elements that can be reused between projects or ' +\\n                'leverage a project description for many different actions.'\\n            ),\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'Initial release'),\\n            h('p', {},\\n                'The Metaphor prompt compiler, ',\\n                h('code', {}, 'm6rc'),\\n                ', is being released under an Apache 2.0 open-source software license to encourage you to experiment with ' +\\n                'it and to give you the chance to contribute to it.'\\n            ),\\n            h('p', {},\\n                'This is a v0.1 release, so you can expect the language and the tools to evolve quickly over the next few ' +\\n                'months.'\\n            ),\\n            h('p', {},\\n                'The software is available on GitHub at: ',\\n                h('a', {\\n                        href: 'https://github.com/m6r-ai/m6rc',\\n                        target: '_blank',\\n                        title: 'M6RC git repository on GitHub'\\n                    },\\n                    'github.com/m6r-ai/m6rc'\\n                )\\n            ),\\n            h('p', {},\\n                'There\\\\'s also a discussion forum over on Google Groups: ',\\n                h('a', {\\n                        href: 'https://groups.google.com/g/metaphor-language',\\n                        target: '_blank',\\n                        title: 'metaphor-language discussion group'\\n                    },\\n                    'groups.google.com/g/metaphor-language'\\n                )\\n            ),\\n            h('p', {},\\n                'I look forward to seeing what you can build with Metaphor!'\\n            ),\\n            h('figure', {},\\n                h('img', {\\n                    src: '/blog/000003-Introducing-Metaphor/metaphor-whiteboard.webp',\\n                    alt: 'A photo of the whiteboard notes for this release of Metaphor.',\\n                    width: 3450,\\n                    height: 2361\\n                }),\\n                h('figcaption', {}, 'The whiteboard notes for Metaphor v0.1')\\n            )\\n        )\\n    ];\\n}\\n\\nexport const blogPost_000003 = new BlogPost(\\n    'Introducing Metaphor: An AI-First software development language',\\n    'Dave Hudson',\\n    '2024-11-01',\\n    '/blog/000003-Introducing-Metaphor',\\n    'Introducing Metaphor: An AI-First software development language.',\\n    '/blog/000003-Introducing-Metaphor/metaphor-whiteboard.webp',\\n    blogArticle_000003\\n);\\n\",\n    \"error\": null\n}\n```",
      "completed": true,
      "tool_results": [
        {
          "id": "call_0",
          "name": "filesystem",
          "content": "File: m6r.ai/000003-Introducing-Metaphor/post.ts\nSize: 7,025 bytes\nEncoding: utf-8\n\nimport {h, VElement} from '../../lib/dvdi';\nimport {BlogPost} from '../BlogPost';\n\nfunction blogArticle_000003(): VElement[] {\n    return [\n        h('p', {},\n            'AI is rapidly changing the way we build software.  It offers expert advice tailored to developers\\' needs and can ' +\n            'quickly automate many tasks.  While impressive, these tools are still focused on implementing software in the ' +\n            'programming languages we would use if AI didn\\'t exist.'\n        ),\n        h('p', {},\n            'Throughout the history of software engineering, the most significant productivity improvements have come when we ' +\n            'move to a higher level of design.  So, today, I\\'m announcing the first public version of a simple new language, ' +\n            'Metaphor, that helps make that move to a new higher-level of design.'\n        ),\n        h('section', {},\n            h('h2', {}, 'What problem is it solving?'),\n            h('p', {},\n                'Like people, AI agents cannot do things without clear, detailed instructions.  If we give ambiguous, ' +\n                'incomplete, or conflicting instructions, they become confused and do unexpected things.  Unlike people, ' +\n                'though, they usually won\\'t tell you they\\'re confused unless you ask them.'\n            ),\n            h('p', {},\n                'Metaphor is designed to let you progressively build precise and unambiguous requirements so AI agents ' +\n                'can generate software and documentation.  Instead of you and your team focusing on how you build software, ' +\n                'you can concentrate on what you want and how you want it to behave.'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'How does it work?'),\n            h('p', {},\n                'Metaphor has a very simple structure.  Within this structure, Metaphor uses natural language.'\n            ),\n            h('p', {},\n                'In this v0.1 release, there are just 5 keywords!  These are:'\n            ),\n            h('ul', {},\n                h('li', {},\n                    h('code', {}, 'Action:'),\n                    ' the action we want the agent to perform.'\n                ),\n                h('li', {},\n                    h('code', {}, 'Context:'),\n                    ' information that will be required by the AI agent to do its work.'\n                ),\n                h('li', {},\n                    h('code', {}, 'Embed:'),\n                    ' embed another file into the current metaphor file as part of the context.'\n                ),\n                h('li', {},\n                    h('code', {}, 'Include:'),\n                    ' pull other metaphor files into the current metaphor file.'\n                ),\n                h('li', {},\n                    h('code', {}, 'Role:'),\n                    ' the role to be taken by an AI agent (this is a placeholder for now but will be used later).'\n                )\n            ),\n            h('p', {},\n                'The idea is to gather all the essential elements of a software design in one place.  This includes design ' +\n                'considerations that would typically come from many different disciplines.  For example, it can capture ' +\n                'ideas that usually originate with product managers, software engineers, QA analysts, security experts, and ' +\n                'more.'\n            ),\n            h('p', {},\n                'Once read, this is compiled into a \"large context prompt\" (LCP) for one or more backend AI agents to ' +\n                'process.  An LCP is designed to provide all the information an AI agent needs to perform an action.  ' +\n                'Examples of actions might be reviewing requirements for ambiguity, reviewing some existing software against ' +\n                'a requirement, or building something completely new.'\n            ),\n            h('p', {},\n                'Metaphor is designed to capture everything within the LCP, so there\\'s no need to rely on a continued ' +\n                'dialogue or fine-tuned learning in any AI large language model (LLM).  This also makes it easy to discard ' +\n                'anything that doesn\\'t work as desired and try out new ideas.'\n            ),\n            h('p', {},\n                'Modular designs are vital in software development, so Metaphor descriptions can be broken into modular ' +\n                'components (',\n                h('code', {}, '.m6r'),\n                ' files).  This makes it easy to build library-like elements that can be reused between projects or ' +\n                'leverage a project description for many different actions.'\n            ),\n        ),\n        h('section', {},\n            h('h2', {}, 'Initial release'),\n            h('p', {},\n                'The Metaphor prompt compiler, ',\n                h('code', {}, 'm6rc'),\n                ', is being released under an Apache 2.0 open-source software license to encourage you to experiment with ' +\n                'it and to give you the chance to contribute to it.'\n            ),\n            h('p', {},\n                'This is a v0.1 release, so you can expect the language and the tools to evolve quickly over the next few ' +\n                'months.'\n            ),\n            h('p', {},\n                'The software is available on GitHub at: ',\n                h('a', {\n                        href: 'https://github.com/m6r-ai/m6rc',\n                        target: '_blank',\n                        title: 'M6RC git repository on GitHub'\n                    },\n                    'github.com/m6r-ai/m6rc'\n                )\n            ),\n            h('p', {},\n                'There\\'s also a discussion forum over on Google Groups: ',\n                h('a', {\n                        href: 'https://groups.google.com/g/metaphor-language',\n                        target: '_blank',\n                        title: 'metaphor-language discussion group'\n                    },\n                    'groups.google.com/g/metaphor-language'\n                )\n            ),\n            h('p', {},\n                'I look forward to seeing what you can build with Metaphor!'\n            ),\n            h('figure', {},\n                h('img', {\n                    src: '/blog/000003-Introducing-Metaphor/metaphor-whiteboard.webp',\n                    alt: 'A photo of the whiteboard notes for this release of Metaphor.',\n                    width: 3450,\n                    height: 2361\n                }),\n                h('figcaption', {}, 'The whiteboard notes for Metaphor v0.1')\n            )\n        )\n    ];\n}\n\nexport const blogPost_000003 = new BlogPost(\n    'Introducing Metaphor: An AI-First software development language',\n    'Dave Hudson',\n    '2024-11-01',\n    '/blog/000003-Introducing-Metaphor',\n    'Introducing Metaphor: An AI-First software development language.',\n    '/blog/000003-Introducing-Metaphor/metaphor-whiteboard.webp',\n    blogArticle_000003\n);\n",
          "error": null
        }
      ]
    },
    {
      "id": "0f721712-ffee-4719-85fb-6c64125525a3",
      "timestamp": "2025-07-27T12:51:25.928352+00:00",
      "type": "user_message",
      "content": "",
      "completed": true,
      "tool_results": [
        {
          "id": "call_0",
          "name": "filesystem",
          "content": "File: m6r.ai/000003-Introducing-Metaphor/post.ts\nSize: 7,025 bytes\nEncoding: utf-8\n\nimport {h, VElement} from '../../lib/dvdi';\nimport {BlogPost} from '../BlogPost';\n\nfunction blogArticle_000003(): VElement[] {\n    return [\n        h('p', {},\n            'AI is rapidly changing the way we build software.  It offers expert advice tailored to developers\\' needs and can ' +\n            'quickly automate many tasks.  While impressive, these tools are still focused on implementing software in the ' +\n            'programming languages we would use if AI didn\\'t exist.'\n        ),\n        h('p', {},\n            'Throughout the history of software engineering, the most significant productivity improvements have come when we ' +\n            'move to a higher level of design.  So, today, I\\'m announcing the first public version of a simple new language, ' +\n            'Metaphor, that helps make that move to a new higher-level of design.'\n        ),\n        h('section', {},\n            h('h2', {}, 'What problem is it solving?'),\n            h('p', {},\n                'Like people, AI agents cannot do things without clear, detailed instructions.  If we give ambiguous, ' +\n                'incomplete, or conflicting instructions, they become confused and do unexpected things.  Unlike people, ' +\n                'though, they usually won\\'t tell you they\\'re confused unless you ask them.'\n            ),\n            h('p', {},\n                'Metaphor is designed to let you progressively build precise and unambiguous requirements so AI agents ' +\n                'can generate software and documentation.  Instead of you and your team focusing on how you build software, ' +\n                'you can concentrate on what you want and how you want it to behave.'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'How does it work?'),\n            h('p', {},\n                'Metaphor has a very simple structure.  Within this structure, Metaphor uses natural language.'\n            ),\n            h('p', {},\n                'In this v0.1 release, there are just 5 keywords!  These are:'\n            ),\n            h('ul', {},\n                h('li', {},\n                    h('code', {}, 'Action:'),\n                    ' the action we want the agent to perform.'\n                ),\n                h('li', {},\n                    h('code', {}, 'Context:'),\n                    ' information that will be required by the AI agent to do its work.'\n                ),\n                h('li', {},\n                    h('code', {}, 'Embed:'),\n                    ' embed another file into the current metaphor file as part of the context.'\n                ),\n                h('li', {},\n                    h('code', {}, 'Include:'),\n                    ' pull other metaphor files into the current metaphor file.'\n                ),\n                h('li', {},\n                    h('code', {}, 'Role:'),\n                    ' the role to be taken by an AI agent (this is a placeholder for now but will be used later).'\n                )\n            ),\n            h('p', {},\n                'The idea is to gather all the essential elements of a software design in one place.  This includes design ' +\n                'considerations that would typically come from many different disciplines.  For example, it can capture ' +\n                'ideas that usually originate with product managers, software engineers, QA analysts, security experts, and ' +\n                'more.'\n            ),\n            h('p', {},\n                'Once read, this is compiled into a \"large context prompt\" (LCP) for one or more backend AI agents to ' +\n                'process.  An LCP is designed to provide all the information an AI agent needs to perform an action.  ' +\n                'Examples of actions might be reviewing requirements for ambiguity, reviewing some existing software against ' +\n                'a requirement, or building something completely new.'\n            ),\n            h('p', {},\n                'Metaphor is designed to capture everything within the LCP, so there\\'s no need to rely on a continued ' +\n                'dialogue or fine-tuned learning in any AI large language model (LLM).  This also makes it easy to discard ' +\n                'anything that doesn\\'t work as desired and try out new ideas.'\n            ),\n            h('p', {},\n                'Modular designs are vital in software development, so Metaphor descriptions can be broken into modular ' +\n                'components (',\n                h('code', {}, '.m6r'),\n                ' files).  This makes it easy to build library-like elements that can be reused between projects or ' +\n                'leverage a project description for many different actions.'\n            ),\n        ),\n        h('section', {},\n            h('h2', {}, 'Initial release'),\n            h('p', {},\n                'The Metaphor prompt compiler, ',\n                h('code', {}, 'm6rc'),\n                ', is being released under an Apache 2.0 open-source software license to encourage you to experiment with ' +\n                'it and to give you the chance to contribute to it.'\n            ),\n            h('p', {},\n                'This is a v0.1 release, so you can expect the language and the tools to evolve quickly over the next few ' +\n                'months.'\n            ),\n            h('p', {},\n                'The software is available on GitHub at: ',\n                h('a', {\n                        href: 'https://github.com/m6r-ai/m6rc',\n                        target: '_blank',\n                        title: 'M6RC git repository on GitHub'\n                    },\n                    'github.com/m6r-ai/m6rc'\n                )\n            ),\n            h('p', {},\n                'There\\'s also a discussion forum over on Google Groups: ',\n                h('a', {\n                        href: 'https://groups.google.com/g/metaphor-language',\n                        target: '_blank',\n                        title: 'metaphor-language discussion group'\n                    },\n                    'groups.google.com/g/metaphor-language'\n                )\n            ),\n            h('p', {},\n                'I look forward to seeing what you can build with Metaphor!'\n            ),\n            h('figure', {},\n                h('img', {\n                    src: '/blog/000003-Introducing-Metaphor/metaphor-whiteboard.webp',\n                    alt: 'A photo of the whiteboard notes for this release of Metaphor.',\n                    width: 3450,\n                    height: 2361\n                }),\n                h('figcaption', {}, 'The whiteboard notes for Metaphor v0.1')\n            )\n        )\n    ];\n}\n\nexport const blogPost_000003 = new BlogPost(\n    'Introducing Metaphor: An AI-First software development language',\n    'Dave Hudson',\n    '2024-11-01',\n    '/blog/000003-Introducing-Metaphor',\n    'Introducing Metaphor: An AI-First software development language.',\n    '/blog/000003-Introducing-Metaphor/metaphor-whiteboard.webp',\n    blogArticle_000003\n);\n",
          "error": null
        }
      ]
    },
    {
      "id": "36bc8ec3-df7f-483a-8be9-8c8bf0014d63",
      "timestamp": "2025-07-27T12:51:26.733751+00:00",
      "type": "ai_response",
      "content": "",
      "completed": true,
      "model": "gemini-1.5-flash",
      "reasoning_capability": 1,
      "temperature": 0.7,
      "tool_calls": [
        {
          "id": "call_0",
          "name": "filesystem",
          "arguments": {
            "operation": "read_file",
            "path": "m6r.ai/000004-Code-reviews-using-Metaphor/post.ts"
          }
        }
      ]
    },
    {
      "id": "e3e08bc0-bc75-4e69-9959-43c1b6537eaf",
      "timestamp": "2025-07-27T12:51:26.740450+00:00",
      "type": "tool_call",
      "content": "```json\n{\n    \"id\": \"call_0\",\n    \"name\": \"filesystem\",\n    \"arguments\": {\n        \"operation\": \"read_file\",\n        \"path\": \"m6r.ai/000004-Code-reviews-using-Metaphor/post.ts\"\n    }\n}\n```",
      "completed": true,
      "tool_calls": [
        {
          "id": "call_0",
          "name": "filesystem",
          "arguments": {
            "operation": "read_file",
            "path": "m6r.ai/000004-Code-reviews-using-Metaphor/post.ts"
          }
        }
      ]
    },
    {
      "id": "c64676dc-7417-45a7-b17b-b88d391e2fcd",
      "timestamp": "2025-07-27T12:51:26.750400+00:00",
      "type": "tool_result",
      "content": "```json\n{\n    \"id\": \"call_0\",\n    \"name\": \"filesystem\",\n    \"content\": \"File: m6r.ai/000004-Code-reviews-using-Metaphor/post.ts\\nSize: 10,299 bytes\\nEncoding: utf-8\\n\\nimport {h, VElement} from '../../lib/dvdi';\\nimport {BlogPost} from '../BlogPost';\\n\\nfunction blogArticle_000004(): VElement[] {\\n    return [\\n        h('p', {},\\n            'Metaphor is designed to help you build software, but a key part of the software lifecycle is reviewing what ' +\\n            'we\\\\'ve built to make sure it does what we expect it to do. So, how do we get Metaphor to help with this problem?'\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'Creating a code review engine'),\\n            h('p', {},\\n                'Our starting point is to recognize this problem is just another variant on a problem where we want to ask a ' +\\n                'large language model (LLM) AI to take on a role, given some relevant context, and some actions we\\\\'d like it ' +\\n                'to perform. This is exactly the sort of problem Metaphor is designed to solve. It\\\\'s also designed to solve ' +\\n                'it in a way that lets us try ideas quickly, build on ones that work well, and quickly discard ones that don\\\\'t.'\\n            )\\n        ),\\n        h('section', {},\\n            h('h3', {}, 'Define a role'),\\n            h('p', {},\\n                'The Metaphor syntax allows us to specify a role that we\\\\'d like our LLM to fulfil. In this case we\\\\'re looking ' +\\n                'for it to be an expert code reviewer. We can therefore start with something like this:'\\n            ),\\n            h('pre', {},\\n                h('code', {},\\n                    'Role: Code reviewer\\\\n' +\\n                    '    You are an expert software engineer, highly skilled in reviewing code\\\\n' +\\n                    '    written by other engineers.  You are able to provide highly insightful and\\\\n' +\\n                    '    useful feedback on how their software might be improved.'\\n                )\\n            ),\\n            h('p', {},\\n                'We might be able to improve on this in the future, but it sets the scene.'\\n            )\\n        ),\\n        h('section', {},\\n            h('h3', {}, 'Define some code review roles'),\\n            h('p', {},\\n                'The next thing needed is some rules against which to review our code. This is quite subtle because the LLM ' +\\n                'training data invariably contains a lot of information about what makes for good code. There are a few ' +\\n                'problems with this:'\\n            ),\\n            h('ul', {},\\n                h('li', {}, 'Any given LLM probably has too much information and won\\\\'t be consistent about what it looks for.'),\\n                h('li', {}, 'Different LLMs will look for different things.'),\\n                h('li', {}, \\n                    'The things the LLMs might want to look for may not match things that we really care about. For example, ' +\\n                    'they won\\\\'t know about any project or company specific rules.'\\n                )\\n            ),\\n            h('p', {},\\n                'One thing we can do, however, is ask our available AIs what they consider to be important code review rules ' +\\n                'using an interactive session with them.'\\n            ),\\n            h('p', {},\\n                'When I did this with Claude 3.5 Sonnet, here\\\\'s a fragment of what it replied:'\\n            ),\\n            h('ol', {},\\n                h('li', {}, \\n                    h('b', {}, 'Code Style and Readability'),\\n                    h('ul', {},\\n                        h('li', {}, 'Follow PEP 8 style guide consistently'),\\n                        h('li', {}, 'Use meaningful variable and function names (descriptive_name vs x)'),\\n                        h('li', {}, 'Keep functions focused and under 50 lines when possible'),\\n                        h('li', {}, 'Use type hints for function arguments and return values'),\\n                        h('li', {}, 'Break complex expressions into well-named variables'),\\n                        h('li', {}, 'Limit line length to 79-88 characters'),\\n                        h('li', {}, 'Use consistent indentation (4 spaces, not tabs)'),\\n                        h('li', {}, 'Add docstrings for modules, classes, and functions'),\\n                        h('li', {}, 'Include examples in docstrings for complex functionality')\\n                    )\\n                ),\\n                h('li', {}, \\n                    h('b', {}, 'Architecture and Design'),\\n                    h('ul', {},\\n                        h('li', {}, 'Follow SOLID principles'),\\n                        h('li', {}, 'Use composition over inheritance when possible'),\\n                        h('li', {}, 'Keep coupling low between modules'),\\n                        h('li', {}, 'Make dependencies explicit (avoid hidden side effects)'),\\n                        h('li', {}, 'Use dependency injection for better testing and flexibility')\\n                    )\\n                ),\\n                h('li', {}, \\n                    h('b', {}, 'Performance Considerations'),\\n                    h('ul', {},\\n                        h('li', {}, 'Use appropriate data structures (dict for lookups, set for uniqueness)'),\\n                        h('li', {}, 'Avoid unnecessary list/dict comprehensions inside loops'),\\n                        h('li', {}, '...')\\n                    )\\n                )\\n            )\\n        ),\\n        h('section', {},\\n            h('h3', {}, 'Define what we want to review'),\\n            h('p', {},\\n                'Within our top-level Context: block we also need to say what it is we\\\\'d like our LLM to review. We can do ' +\\n                'this with the Metaphor Embed: keyword. As of v0.2, Embed: can also take wildcards, so this is easier to do!'\\n            ),\\n            h('pre', {},\\n                h('code', {},\\n                    'Context: Files\\\\n' +\\n                    '    The following files form the software I would like you to review:\\\\n\\\\n' +\\n                    '    # Replace this next line with the files you would like to review.\\\\n' +\\n                    '    Embed: ../m6rc/src/m6rc/*.py'\\n                )\\n            ),\\n            h('p', {},\\n                'In this instance we\\\\'re going to review all the Python source files in the Metaphor compiler, m6rc.'\\n            )\\n        ),\\n        h('section', {},\\n            h('h3', {}, 'Define the action we\\\\'d like the AI to take'),\\n            h('p', {},\\n                'Our Action: block simply needs to describe what the output should look like:'\\n            ),\\n            h('pre', {},\\n                h('code', {},\\n                    'Action: Review code\\\\n' +\\n                    '    Please review the software described in the files I provided to you.\\\\n\\\\n' +\\n                    '    I would like you to summarise how the software works.\\\\n\\\\n' +\\n                    '    I would also like you to review each file individually and comment on how\\\\n' +\\n                    '    it might be improved.  When you do this, you should tell me the name of the\\\\n' +\\n                    '    file you\\\\'re reviewing, and the modification you  believe should happen. Where\\\\n' +\\n                    '    useful, I would like you to write new software to show me how those\\\\n' +\\n                    '    modifications should look.'\\n                )\\n            ),\\n            h('p', {},\\n                'Strictly, we don\\\\'t need the \\\"summarise\\\" request, but it\\\\'s useful to see if the AI understood the software.'\\n            )\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'Running the code'),\\n            h('p', {},\\n                'To make this easier, I posted the source code on GitHub. You can find it at:'\\n            ),\\n            h('a', {\\n                    href: 'https://github.com:/m6r-ai/demo-code-review',\\n                    target: '_blank',\\n                    title: 'Metaphor code review demo'\\n                }, \\n                'https://github.com:/m6r-ai/demo-code-review'\\n            ),\\n            h('p', {},\\n                'The output is too long to post here, but here\\\\'s a snapshot from the middle of what ChatGPT 4o generated:'\\n            ),\\n            h('figure', {},\\n                h('img', {\\n                    src: '/blog/000004-Code-reviews-using-Metaphor/snapshot.webp',\\n                    alt: 'A snapshot of some of the ChatGPT 4o output.',\\n                    width: 800,\\n                    height: 'auto'\\n                }),\\n                h('figcaption', {}, 'A snapshot of some of the ChatGPT 4o output')\\n            ),\\n            h('p', {},\\n                'It turns out there were quite a lot of really good suggestions to improve this software!'\\n            )\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'What next?'),\\n            h('p', {},\\n                'We\\\\'ve seen how we can use Metaphor to build the core of a code reviewing engine.'\\n            ),\\n            h('p', {},\\n                'Given Metaphor\\\\'s design, we can also evolve the code review capabilities over time. If we want to add new ' +\\n                'review guidelines we can simply update the relevant .m6r files and they\\\\'re available the next time we go ' +\\n                'to review our code.'\\n            ),\\n            h('p', {},\\n                'As an example, after I got the first working reviews I wrote another Metaphor file that passed in the ' +\\n                'code review suggestions from Clause 3.5 Sonnet, and asked ChatGPT o1 to suggest improvements.  I merged ' +\\n                'these into the version you\\\\'ll see in the git repo.'\\n            ),\\n            h('p', {},\\n                'Why don\\\\'t you give this a try?'\\n            ),\\n            h('p', {},\\n                'I\\\\'m planning to keep adding to the review guidelines in the git repo. If you\\\\'ve got suggestions to improve ' +\\n                'the current ones, or new ones you\\\\'d like to add (perhaps for different languages) then please do reach out ' +\\n                'or submit a PR.'\\n            )\\n        )\\n    ];\\n}\\n\\nexport const blogPost_000004 = new BlogPost(\\n    'Code reviews using Metaphor',\\n    'Dave Hudson',\\n    '2024-11-06',\\n    '/blog/000004-Code-reviews-using-Metaphor',\\n    'We take a look at how to use Metaphor to set up a large language model (LLM) AI to conduct detailed code reviews.',\\n    '/blog/000004-Code-reviews-using-Metaphor/snapshot.webp',\\n    blogArticle_000004\\n);\\n\\n\",\n    \"error\": null\n}\n```",
      "completed": true,
      "tool_results": [
        {
          "id": "call_0",
          "name": "filesystem",
          "content": "File: m6r.ai/000004-Code-reviews-using-Metaphor/post.ts\nSize: 10,299 bytes\nEncoding: utf-8\n\nimport {h, VElement} from '../../lib/dvdi';\nimport {BlogPost} from '../BlogPost';\n\nfunction blogArticle_000004(): VElement[] {\n    return [\n        h('p', {},\n            'Metaphor is designed to help you build software, but a key part of the software lifecycle is reviewing what ' +\n            'we\\'ve built to make sure it does what we expect it to do. So, how do we get Metaphor to help with this problem?'\n        ),\n        h('section', {},\n            h('h2', {}, 'Creating a code review engine'),\n            h('p', {},\n                'Our starting point is to recognize this problem is just another variant on a problem where we want to ask a ' +\n                'large language model (LLM) AI to take on a role, given some relevant context, and some actions we\\'d like it ' +\n                'to perform. This is exactly the sort of problem Metaphor is designed to solve. It\\'s also designed to solve ' +\n                'it in a way that lets us try ideas quickly, build on ones that work well, and quickly discard ones that don\\'t.'\n            )\n        ),\n        h('section', {},\n            h('h3', {}, 'Define a role'),\n            h('p', {},\n                'The Metaphor syntax allows us to specify a role that we\\'d like our LLM to fulfil. In this case we\\'re looking ' +\n                'for it to be an expert code reviewer. We can therefore start with something like this:'\n            ),\n            h('pre', {},\n                h('code', {},\n                    'Role: Code reviewer\\n' +\n                    '    You are an expert software engineer, highly skilled in reviewing code\\n' +\n                    '    written by other engineers.  You are able to provide highly insightful and\\n' +\n                    '    useful feedback on how their software might be improved.'\n                )\n            ),\n            h('p', {},\n                'We might be able to improve on this in the future, but it sets the scene.'\n            )\n        ),\n        h('section', {},\n            h('h3', {}, 'Define some code review roles'),\n            h('p', {},\n                'The next thing needed is some rules against which to review our code. This is quite subtle because the LLM ' +\n                'training data invariably contains a lot of information about what makes for good code. There are a few ' +\n                'problems with this:'\n            ),\n            h('ul', {},\n                h('li', {}, 'Any given LLM probably has too much information and won\\'t be consistent about what it looks for.'),\n                h('li', {}, 'Different LLMs will look for different things.'),\n                h('li', {}, \n                    'The things the LLMs might want to look for may not match things that we really care about. For example, ' +\n                    'they won\\'t know about any project or company specific rules.'\n                )\n            ),\n            h('p', {},\n                'One thing we can do, however, is ask our available AIs what they consider to be important code review rules ' +\n                'using an interactive session with them.'\n            ),\n            h('p', {},\n                'When I did this with Claude 3.5 Sonnet, here\\'s a fragment of what it replied:'\n            ),\n            h('ol', {},\n                h('li', {}, \n                    h('b', {}, 'Code Style and Readability'),\n                    h('ul', {},\n                        h('li', {}, 'Follow PEP 8 style guide consistently'),\n                        h('li', {}, 'Use meaningful variable and function names (descriptive_name vs x)'),\n                        h('li', {}, 'Keep functions focused and under 50 lines when possible'),\n                        h('li', {}, 'Use type hints for function arguments and return values'),\n                        h('li', {}, 'Break complex expressions into well-named variables'),\n                        h('li', {}, 'Limit line length to 79-88 characters'),\n                        h('li', {}, 'Use consistent indentation (4 spaces, not tabs)'),\n                        h('li', {}, 'Add docstrings for modules, classes, and functions'),\n                        h('li', {}, 'Include examples in docstrings for complex functionality')\n                    )\n                ),\n                h('li', {}, \n                    h('b', {}, 'Architecture and Design'),\n                    h('ul', {},\n                        h('li', {}, 'Follow SOLID principles'),\n                        h('li', {}, 'Use composition over inheritance when possible'),\n                        h('li', {}, 'Keep coupling low between modules'),\n                        h('li', {}, 'Make dependencies explicit (avoid hidden side effects)'),\n                        h('li', {}, 'Use dependency injection for better testing and flexibility')\n                    )\n                ),\n                h('li', {}, \n                    h('b', {}, 'Performance Considerations'),\n                    h('ul', {},\n                        h('li', {}, 'Use appropriate data structures (dict for lookups, set for uniqueness)'),\n                        h('li', {}, 'Avoid unnecessary list/dict comprehensions inside loops'),\n                        h('li', {}, '...')\n                    )\n                )\n            )\n        ),\n        h('section', {},\n            h('h3', {}, 'Define what we want to review'),\n            h('p', {},\n                'Within our top-level Context: block we also need to say what it is we\\'d like our LLM to review. We can do ' +\n                'this with the Metaphor Embed: keyword. As of v0.2, Embed: can also take wildcards, so this is easier to do!'\n            ),\n            h('pre', {},\n                h('code', {},\n                    'Context: Files\\n' +\n                    '    The following files form the software I would like you to review:\\n\\n' +\n                    '    # Replace this next line with the files you would like to review.\\n' +\n                    '    Embed: ../m6rc/src/m6rc/*.py'\n                )\n            ),\n            h('p', {},\n                'In this instance we\\'re going to review all the Python source files in the Metaphor compiler, m6rc.'\n            )\n        ),\n        h('section', {},\n            h('h3', {}, 'Define the action we\\'d like the AI to take'),\n            h('p', {},\n                'Our Action: block simply needs to describe what the output should look like:'\n            ),\n            h('pre', {},\n                h('code', {},\n                    'Action: Review code\\n' +\n                    '    Please review the software described in the files I provided to you.\\n\\n' +\n                    '    I would like you to summarise how the software works.\\n\\n' +\n                    '    I would also like you to review each file individually and comment on how\\n' +\n                    '    it might be improved.  When you do this, you should tell me the name of the\\n' +\n                    '    file you\\'re reviewing, and the modification you  believe should happen. Where\\n' +\n                    '    useful, I would like you to write new software to show me how those\\n' +\n                    '    modifications should look.'\n                )\n            ),\n            h('p', {},\n                'Strictly, we don\\'t need the \"summarise\" request, but it\\'s useful to see if the AI understood the software.'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'Running the code'),\n            h('p', {},\n                'To make this easier, I posted the source code on GitHub. You can find it at:'\n            ),\n            h('a', {\n                    href: 'https://github.com:/m6r-ai/demo-code-review',\n                    target: '_blank',\n                    title: 'Metaphor code review demo'\n                }, \n                'https://github.com:/m6r-ai/demo-code-review'\n            ),\n            h('p', {},\n                'The output is too long to post here, but here\\'s a snapshot from the middle of what ChatGPT 4o generated:'\n            ),\n            h('figure', {},\n                h('img', {\n                    src: '/blog/000004-Code-reviews-using-Metaphor/snapshot.webp',\n                    alt: 'A snapshot of some of the ChatGPT 4o output.',\n                    width: 800,\n                    height: 'auto'\n                }),\n                h('figcaption', {}, 'A snapshot of some of the ChatGPT 4o output')\n            ),\n            h('p', {},\n                'It turns out there were quite a lot of really good suggestions to improve this software!'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'What next?'),\n            h('p', {},\n                'We\\'ve seen how we can use Metaphor to build the core of a code reviewing engine.'\n            ),\n            h('p', {},\n                'Given Metaphor\\'s design, we can also evolve the code review capabilities over time. If we want to add new ' +\n                'review guidelines we can simply update the relevant .m6r files and they\\'re available the next time we go ' +\n                'to review our code.'\n            ),\n            h('p', {},\n                'As an example, after I got the first working reviews I wrote another Metaphor file that passed in the ' +\n                'code review suggestions from Clause 3.5 Sonnet, and asked ChatGPT o1 to suggest improvements.  I merged ' +\n                'these into the version you\\'ll see in the git repo.'\n            ),\n            h('p', {},\n                'Why don\\'t you give this a try?'\n            ),\n            h('p', {},\n                'I\\'m planning to keep adding to the review guidelines in the git repo. If you\\'ve got suggestions to improve ' +\n                'the current ones, or new ones you\\'d like to add (perhaps for different languages) then please do reach out ' +\n                'or submit a PR.'\n            )\n        )\n    ];\n}\n\nexport const blogPost_000004 = new BlogPost(\n    'Code reviews using Metaphor',\n    'Dave Hudson',\n    '2024-11-06',\n    '/blog/000004-Code-reviews-using-Metaphor',\n    'We take a look at how to use Metaphor to set up a large language model (LLM) AI to conduct detailed code reviews.',\n    '/blog/000004-Code-reviews-using-Metaphor/snapshot.webp',\n    blogArticle_000004\n);\n\n",
          "error": null
        }
      ]
    },
    {
      "id": "0ce077c1-2e1e-4076-ba32-031bb5e78150",
      "timestamp": "2025-07-27T12:51:26.760993+00:00",
      "type": "user_message",
      "content": "",
      "completed": true,
      "tool_results": [
        {
          "id": "call_0",
          "name": "filesystem",
          "content": "File: m6r.ai/000004-Code-reviews-using-Metaphor/post.ts\nSize: 10,299 bytes\nEncoding: utf-8\n\nimport {h, VElement} from '../../lib/dvdi';\nimport {BlogPost} from '../BlogPost';\n\nfunction blogArticle_000004(): VElement[] {\n    return [\n        h('p', {},\n            'Metaphor is designed to help you build software, but a key part of the software lifecycle is reviewing what ' +\n            'we\\'ve built to make sure it does what we expect it to do. So, how do we get Metaphor to help with this problem?'\n        ),\n        h('section', {},\n            h('h2', {}, 'Creating a code review engine'),\n            h('p', {},\n                'Our starting point is to recognize this problem is just another variant on a problem where we want to ask a ' +\n                'large language model (LLM) AI to take on a role, given some relevant context, and some actions we\\'d like it ' +\n                'to perform. This is exactly the sort of problem Metaphor is designed to solve. It\\'s also designed to solve ' +\n                'it in a way that lets us try ideas quickly, build on ones that work well, and quickly discard ones that don\\'t.'\n            )\n        ),\n        h('section', {},\n            h('h3', {}, 'Define a role'),\n            h('p', {},\n                'The Metaphor syntax allows us to specify a role that we\\'d like our LLM to fulfil. In this case we\\'re looking ' +\n                'for it to be an expert code reviewer. We can therefore start with something like this:'\n            ),\n            h('pre', {},\n                h('code', {},\n                    'Role: Code reviewer\\n' +\n                    '    You are an expert software engineer, highly skilled in reviewing code\\n' +\n                    '    written by other engineers.  You are able to provide highly insightful and\\n' +\n                    '    useful feedback on how their software might be improved.'\n                )\n            ),\n            h('p', {},\n                'We might be able to improve on this in the future, but it sets the scene.'\n            )\n        ),\n        h('section', {},\n            h('h3', {}, 'Define some code review roles'),\n            h('p', {},\n                'The next thing needed is some rules against which to review our code. This is quite subtle because the LLM ' +\n                'training data invariably contains a lot of information about what makes for good code. There are a few ' +\n                'problems with this:'\n            ),\n            h('ul', {},\n                h('li', {}, 'Any given LLM probably has too much information and won\\'t be consistent about what it looks for.'),\n                h('li', {}, 'Different LLMs will look for different things.'),\n                h('li', {}, \n                    'The things the LLMs might want to look for may not match things that we really care about. For example, ' +\n                    'they won\\'t know about any project or company specific rules.'\n                )\n            ),\n            h('p', {},\n                'One thing we can do, however, is ask our available AIs what they consider to be important code review rules ' +\n                'using an interactive session with them.'\n            ),\n            h('p', {},\n                'When I did this with Claude 3.5 Sonnet, here\\'s a fragment of what it replied:'\n            ),\n            h('ol', {},\n                h('li', {}, \n                    h('b', {}, 'Code Style and Readability'),\n                    h('ul', {},\n                        h('li', {}, 'Follow PEP 8 style guide consistently'),\n                        h('li', {}, 'Use meaningful variable and function names (descriptive_name vs x)'),\n                        h('li', {}, 'Keep functions focused and under 50 lines when possible'),\n                        h('li', {}, 'Use type hints for function arguments and return values'),\n                        h('li', {}, 'Break complex expressions into well-named variables'),\n                        h('li', {}, 'Limit line length to 79-88 characters'),\n                        h('li', {}, 'Use consistent indentation (4 spaces, not tabs)'),\n                        h('li', {}, 'Add docstrings for modules, classes, and functions'),\n                        h('li', {}, 'Include examples in docstrings for complex functionality')\n                    )\n                ),\n                h('li', {}, \n                    h('b', {}, 'Architecture and Design'),\n                    h('ul', {},\n                        h('li', {}, 'Follow SOLID principles'),\n                        h('li', {}, 'Use composition over inheritance when possible'),\n                        h('li', {}, 'Keep coupling low between modules'),\n                        h('li', {}, 'Make dependencies explicit (avoid hidden side effects)'),\n                        h('li', {}, 'Use dependency injection for better testing and flexibility')\n                    )\n                ),\n                h('li', {}, \n                    h('b', {}, 'Performance Considerations'),\n                    h('ul', {},\n                        h('li', {}, 'Use appropriate data structures (dict for lookups, set for uniqueness)'),\n                        h('li', {}, 'Avoid unnecessary list/dict comprehensions inside loops'),\n                        h('li', {}, '...')\n                    )\n                )\n            )\n        ),\n        h('section', {},\n            h('h3', {}, 'Define what we want to review'),\n            h('p', {},\n                'Within our top-level Context: block we also need to say what it is we\\'d like our LLM to review. We can do ' +\n                'this with the Metaphor Embed: keyword. As of v0.2, Embed: can also take wildcards, so this is easier to do!'\n            ),\n            h('pre', {},\n                h('code', {},\n                    'Context: Files\\n' +\n                    '    The following files form the software I would like you to review:\\n\\n' +\n                    '    # Replace this next line with the files you would like to review.\\n' +\n                    '    Embed: ../m6rc/src/m6rc/*.py'\n                )\n            ),\n            h('p', {},\n                'In this instance we\\'re going to review all the Python source files in the Metaphor compiler, m6rc.'\n            )\n        ),\n        h('section', {},\n            h('h3', {}, 'Define the action we\\'d like the AI to take'),\n            h('p', {},\n                'Our Action: block simply needs to describe what the output should look like:'\n            ),\n            h('pre', {},\n                h('code', {},\n                    'Action: Review code\\n' +\n                    '    Please review the software described in the files I provided to you.\\n\\n' +\n                    '    I would like you to summarise how the software works.\\n\\n' +\n                    '    I would also like you to review each file individually and comment on how\\n' +\n                    '    it might be improved.  When you do this, you should tell me the name of the\\n' +\n                    '    file you\\'re reviewing, and the modification you  believe should happen. Where\\n' +\n                    '    useful, I would like you to write new software to show me how those\\n' +\n                    '    modifications should look.'\n                )\n            ),\n            h('p', {},\n                'Strictly, we don\\'t need the \"summarise\" request, but it\\'s useful to see if the AI understood the software.'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'Running the code'),\n            h('p', {},\n                'To make this easier, I posted the source code on GitHub. You can find it at:'\n            ),\n            h('a', {\n                    href: 'https://github.com:/m6r-ai/demo-code-review',\n                    target: '_blank',\n                    title: 'Metaphor code review demo'\n                }, \n                'https://github.com:/m6r-ai/demo-code-review'\n            ),\n            h('p', {},\n                'The output is too long to post here, but here\\'s a snapshot from the middle of what ChatGPT 4o generated:'\n            ),\n            h('figure', {},\n                h('img', {\n                    src: '/blog/000004-Code-reviews-using-Metaphor/snapshot.webp',\n                    alt: 'A snapshot of some of the ChatGPT 4o output.',\n                    width: 800,\n                    height: 'auto'\n                }),\n                h('figcaption', {}, 'A snapshot of some of the ChatGPT 4o output')\n            ),\n            h('p', {},\n                'It turns out there were quite a lot of really good suggestions to improve this software!'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'What next?'),\n            h('p', {},\n                'We\\'ve seen how we can use Metaphor to build the core of a code reviewing engine.'\n            ),\n            h('p', {},\n                'Given Metaphor\\'s design, we can also evolve the code review capabilities over time. If we want to add new ' +\n                'review guidelines we can simply update the relevant .m6r files and they\\'re available the next time we go ' +\n                'to review our code.'\n            ),\n            h('p', {},\n                'As an example, after I got the first working reviews I wrote another Metaphor file that passed in the ' +\n                'code review suggestions from Clause 3.5 Sonnet, and asked ChatGPT o1 to suggest improvements.  I merged ' +\n                'these into the version you\\'ll see in the git repo.'\n            ),\n            h('p', {},\n                'Why don\\'t you give this a try?'\n            ),\n            h('p', {},\n                'I\\'m planning to keep adding to the review guidelines in the git repo. If you\\'ve got suggestions to improve ' +\n                'the current ones, or new ones you\\'d like to add (perhaps for different languages) then please do reach out ' +\n                'or submit a PR.'\n            )\n        )\n    ];\n}\n\nexport const blogPost_000004 = new BlogPost(\n    'Code reviews using Metaphor',\n    'Dave Hudson',\n    '2024-11-06',\n    '/blog/000004-Code-reviews-using-Metaphor',\n    'We take a look at how to use Metaphor to set up a large language model (LLM) AI to conduct detailed code reviews.',\n    '/blog/000004-Code-reviews-using-Metaphor/snapshot.webp',\n    blogArticle_000004\n);\n\n",
          "error": null
        }
      ]
    },
    {
      "id": "ebc354ea-7a09-4bc9-8ccc-69a26e97f40b",
      "timestamp": "2025-07-27T12:51:27.718264+00:00",
      "type": "ai_response",
      "content": "",
      "completed": true,
      "model": "gemini-1.5-flash",
      "reasoning_capability": 1,
      "temperature": 0.7,
      "tool_calls": [
        {
          "id": "call_0",
          "name": "filesystem",
          "arguments": {
            "operation": "read_file",
            "path": "m6r.ai/000005-commit-critic/post.ts"
          }
        }
      ]
    },
    {
      "id": "4ce8c610-2e50-44f2-875b-279d75b9dc09",
      "timestamp": "2025-07-27T12:51:27.723008+00:00",
      "type": "tool_call",
      "content": "```json\n{\n    \"id\": \"call_0\",\n    \"name\": \"filesystem\",\n    \"arguments\": {\n        \"operation\": \"read_file\",\n        \"path\": \"m6r.ai/000005-commit-critic/post.ts\"\n    }\n}\n```",
      "completed": true,
      "tool_calls": [
        {
          "id": "call_0",
          "name": "filesystem",
          "arguments": {
            "operation": "read_file",
            "path": "m6r.ai/000005-commit-critic/post.ts"
          }
        }
      ]
    },
    {
      "id": "5f19262a-526b-480f-aad6-8c5b89c6b0b3",
      "timestamp": "2025-07-27T12:51:27.727871+00:00",
      "type": "tool_result",
      "content": "```json\n{\n    \"id\": \"call_0\",\n    \"name\": \"filesystem\",\n    \"content\": \"File: m6r.ai/000005-commit-critic/post.ts\\nSize: 18,024 bytes\\nEncoding: utf-8\\n\\nimport {assertIsVElement, h, updateElement, VNode, VElement} from '../../lib/dvdi';\\nimport {BlogPost} from '../BlogPost';\\nimport {MetaphorParser, PythonParser} from '../../lib/syntax';\\nimport {highlight} from '../../lib/highlight'\\nimport {cloneObject} from '../../lib/cloneObject';\\nimport {navigateEvent} from '../../app';\\n\\nconst code: VNode[][] = [[], [], []];\\nlet codeVElement: (VElement | null)[] = [null, null, null];\\nconst codeFunction: (() => VElement)[] = [\\n    blogArticle_000005_Prompt,\\n    blogArticle_000005_Guidelines,\\n    blogArticle_000005_Code\\n];\\n\\n/**\\n * Callback to write the contents of the file load for the first code fragment.\\n * @param content\\n */\\nfunction writeCode(segment: number, content: VNode[]) {\\n    code[segment].push(...content);\\n    if (codeVElement[segment] === null) {\\n        return;\\n    }\\n\\n    assertIsVElement(codeVElement[segment]);\\n    if (codeVElement[segment].parentVNode === null) {\\n        return;\\n    }\\n\\n    const parentElem = (codeVElement[segment].parentVNode as VElement).domElement;\\n    if (parentElem === null) {\\n        return;\\n    }\\n\\n    if (codeVElement[segment].domElement === null) {\\n        return;\\n    }\\n\\n    const index = Array.from(parentElem.childNodes).indexOf(codeVElement[segment].domElement);\\n    const newVElement = codeFunction[segment]();\\n    newVElement.parentVNode = codeVElement[segment].parentVNode;\\n    updateElement(parentElem,\\n        parentElem.childNodes[index],\\n        codeVElement[segment].parentVNode as VElement,\\n        codeVElement[segment],\\n        newVElement\\n    );\\n    codeVElement[segment] = newVElement;\\n}\\n\\nasync function loadFile(segment: number, filePath: string, storeFunction: (segment: number, content: VNode[]) => void) {\\n    try {\\n        const response = await fetch(filePath);\\n        if (!response.ok) {\\n            throw new Error(`Failed to fetch file: ${response.statusText}`);\\n        }\\n\\n        const content = await response.text();\\n        let formattedContent: VNode[];\\n        if (filePath.endsWith('.py')) {\\n            formattedContent = highlight(content, PythonParser);\\n        } else {\\n            formattedContent = highlight(content, MetaphorParser);\\n        }\\n\\n        storeFunction(segment, formattedContent);\\n    } catch (error) {\\n        console.error('Error loading file:', error);\\n    }\\n}\\n\\nfunction blogArticle_000005_Prompt(): VElement {\\n    let contents: VElement;\\n    if (code[0].length === 0) {\\n        contents = h('pre', {});\\n    } else {\\n        contents = h('pre', {}, h('code', {}, h('span', {className: 'blocktext'}, ...cloneObject(code[0]))));\\n    }\\n\\n    contents.mountCallback = () => {\\n        codeVElement[0] = contents;\\n        if (code[0].length === 0) {\\n            loadFile(0, '/blog/000005-commit-critic/commit-critic.m6r', writeCode);\\n        }\\n    }\\n\\n    contents.unmountCallback = () => {\\n        codeVElement[0] = null;\\n    }\\n\\n    return contents;\\n}\\n\\nfunction blogArticle_000005_Guidelines(): VElement {\\n    let contents: VElement;\\n    if (code[1].length === 0) {\\n        contents = h('pre', {});\\n    } else {\\n        contents = h('pre', {}, h('code', {}, ...cloneObject(code[1])));\\n    }\\n\\n    contents.mountCallback = () => {\\n        codeVElement[1] = contents;\\n        if (code[1].length === 0) {\\n            loadFile(1, '/blog/000005-commit-critic/sample-guideline.m6r', writeCode);\\n        }\\n    }\\n\\n    contents.unmountCallback = () => {\\n        codeVElement[1] = null;\\n    }\\n\\n    return contents;\\n}\\n\\nfunction blogArticle_000005_Code(): VElement {\\n    let contents: VElement;\\n    if (code[2].length === 0) {\\n        contents = h('pre', {});\\n    } else {\\n        contents = h('pre', {}, h('code', {}, ...cloneObject(code[2])));\\n    }\\n\\n    contents.mountCallback = () => {\\n        codeVElement[2] = contents;\\n        if (code[2].length === 0) {\\n            loadFile(2, '/blog/000005-commit-critic/commit_critic.py', writeCode);\\n        }\\n    }\\n\\n    contents.unmountCallback = () => {\\n        codeVElement[2] = null;\\n    }\\n\\n    return contents;\\n}\\n\\nfunction blogArticle_000005(): VElement[] {\\n    return [\\n        h('p', {},\\n            'Code reviews are one of the most important elements of software development.  They\\\\'re where we seek feedback on ' +\\n            'what we\\\\'ve built, looking to ensure it\\\\'s understandable, elegant, and free from defects.'\\n        ),\\n        h('p', {},\\n            'A problem with code reviews is that we often need to wait for someone else to have time to look at what we\\\\'ve ' +\\n            'done.  Ideally, we want instant feedback before we submit a PR.'\\n        ),\\n        h('p', {},\\n            'In a previous article (see: ',\\n            h('a', {\\n                    href: '/blog/000004-Code-reviews-using-Metaphor',\\n                    onclick: (e: MouseEvent) => navigateEvent(\\n                        e, '/blog/000004-Code-reviews-using-Metaphor'\\n                    )\\n                },\\n                'Code reviews using Metaphor'\\n            ),\\n            '), I looked at how to build something that could leverage AI to help, but that required a lot of manual steps.  ' +\\n            'We really need a tool for this.'\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'Anatomy of a code review tool'),\\n            h('p', {},\\n                'If we want to build an AI-based code reviewer, we should start with some features we\\\\'d like it to have.'\\n            ),\\n            h('p', {},\\n                'Ideally, we want something we can integrate with other tools.  That implies we want it to run from a command ' +\\n                'line.  Command-line apps need argument flags.  We also want to provide a list of files to review.'\\n            ),\\n            h('p', {},\\n                'We also want it to run everywhere, so let\\\\'s build it in Python.'\\n            ),\\n            h('p', {},\\n                'Every language, project, company, etc., has different approaches to coding conventions, so we want our code ' +\\n                'review guidelines to be customizable.  As we may have code in multiple languages, let\\\\'s allow for multiple ' +\\n                'guidelines, too.'\\n            ),\\n            h('p', {},\\n                'We\\\\'ll take a Unix-like approach and design our code review tool to generate a large language model (LLM) ' +\\n                'prompt as a file but not provide integration with any specific LLM.  That can be done manually by the user ' +\\n                'or via a separate prompt upload or interaction tool, which means it can also work with local LLMs, not just ' +\\n                'cloud-based ones.'\\n            )\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'Building the prompt'),\\n            h('p', {},\\n                'The trickiest part of this is planning to build a prompt.  Our AI isn\\\\'t psychic, and we don\\\\'t want it ' +\\n                'to get creative and come up with new ideas for reviewing code each time.  We solve this by constructing a ' +\\n                'large context prompt (LCP) that contains all the information it needs to do the task.'\\n            ),\\n            h('p', {},\\n                'This means the prompt needs:'\\n            ),\\n            h('ul', {},\\n                h('li', {}, 'All the files to review'),\\n                h('li', {}, 'All the coding guidelines we want to apply to those files'),\\n                h('li', {}, 'Some instructions on what we want it to do'),\\n                h('li', {}, 'Some instructions on how we want it to generate its output')\\n            ),\\n            h('p', {},\\n                'There\\\\'s a library available that makes this very simple, m6rclib.  This is an embedded parser for a ' +\\n                'structured document language, Metaphor (see ',\\n                h('a', {\\n                        href: 'https://github.com/m6r-ai/m6rclib',\\n                        target: '_blank',\\n                        title: 'm6rclib project on GitHub'\\n                    },\\n                    'https://github.com/m6r-ai/m6rclib'\\n                ),\\n                ').  m6rclib is well suited to this problem:'\\n            ),\\n            h('ul', {},\\n                h('li', {}, 'Metaphor files are largely natural language and so fit nicely with describing coding guidelines'),\\n                h('li', {}, 'It has an `Include:` keyword that lets us compose a series of files into one prompt'),\\n                h('li', {}, 'It has an `Embed:` keyword that lets us embed files into a prompt'),\\n                h('li', {},\\n                    'It has `Role:`, `Context:` and `Action:` keywords that let us describe the role of the LLM, the context ' +\\n                    'we want it to use, and the action we want it to take.'\\n                )\\n            ),\\n            h('p', {},\\n                'We stitch together all the elements we want into an overall Metaphor description and let the prompt ' +\\n                'compiler do the rest!'\\n            )\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'Coding guidelines'),\\n            h('p', {},\\n                'Let\\\\'s look at a fragment of a coding guideline.  This one is a generic guide in Metaphor form.  Some ' +\\n                'sub-points probably want to be expanded, which will likely give us a better review, but these are pretty ' +\\n                'workable.  Some of these may also be too language-specific and want refactoring, but that\\\\'s easy to do in ' +\\n                'the future. Similarly, some of these may not be universally accepted.  I\\\\'m hoping the tool\\\\'s users will ' +\\n                'help with this!'\\n            ),\\n            h('figure', {},\\n                blogArticle_000005_Guidelines(),\\n                h('figcaption', {}, 'Fragment of a guideline file')\\n            )\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'Building commit-critic'),\\n            h('p', {},\\n                'At this point, we\\\\'ve got a design, so now we want to build the tool.  We could dive in and start coding, ' +\\n                'but wouldn\\\\'t it be better to have an AI do that part, too?  Having it AI-built has a lot of benefits:'\\n            ),\\n            h('ul', {},\\n                h('li', {}, 'It\\\\'s much quicker to build the code (LLMs \\\"type\\\" much faster than people!)'),\\n                h('li', {}, 'It will do all the boring stuff (exception handling, etc.) without complaining'),\\n                h('li', {}, 'If it knows enough to build the tool, then it can write the user manual'),\\n                h('li', {}, 'If we want tests, it can build them'),\\n                h('li', {}, 'We can rapidly try new ideas and discard them if they aren\\\\'t useful'),\\n                h('li', {}, 'It can do all the future maintenance')\\n            ),\\n            h('p', {},\\n                'Some of these might sound far-fetched.  Hold that thought, and we\\\\'ll come back to it later.'\\n            )\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'More Metaphor'),\\n            h('p', {},\\n                'commit-critic leverages Metaphor to create LLM prompts at runtime, but Metaphor was initially designed to ' +\\n                'help me build software using AI.  To support this, I wrote a stand-alone Metaphor compiler, m6rc (see ',\\n                h('a', {\\n                        href: 'https://github.com/m6r-ai/m6rc',\\n                        target: '_blank',\\n                        title: 'm6rc project on GitHub'\\n                    },\\n                    'https://github.com/m6r-ai/m6rc'\\n                ),\\n                ').  Aside: m6rc used to be quite heavyweight but is now a very light wrapper around m6rclib, too.'\\n            ),\\n            h('p', {},\\n                'If we take and expand on what we have already looked at, we can describe commit-critic in Metaphor.  ' +\\n                'Importantly, we\\\\'re describing what we want the tool to do - i.e. the business logic.  We\\\\'re not ' +\\n                'describing the code!'\\n            ),\\n            h('figure', {},\\n                blogArticle_000005_Prompt(),\\n                h('figcaption', {}, 'The v0.1 commit-critic \\\"source\\\" file')\\n            )\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'Generating the executable code'),\\n            h('p', {},\\n                'We can compile this into a prompt ready to hand to our LLM:'\\n            ),\\n            h('pre', {},\\n                h('code', {},\\n                    'm6rc commit-critic.m6r -o out.lcp'\\n                )\\n            ),\\n            h('p', {},\\n                'In this instance I handed the task to Claude 3.5 Sonnet:'\\n            ),\\n            h('figure', {},\\n                blogArticle_000005_Code(),\\n                h('figcaption', {}, 'The v0.1 commit-critic application code')\\n            )\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'Testing the output'),\\n            h('p', {},\\n                'commit-critic needs a little extra python packaging to run as a stand-along application, but we can test it:'\\n            ),\\n            h('pre', {},\\n                h('code', {},\\n                    'python3 commit-critic.py -g <review-dir-path> -o out.lcp <file-to-test>'\\n                )\\n            ),\\n            h('p', {},\\n                'The following is a fragment of the output from ChatGPT 4o when I asked it to review part of a virtual DOM ' +\\n                'implementation I build a few months ago.  As you can see, it produces a series of recommendations, and ' +\\n                'tells you which guideline applies.  This makes it much easier to understand why it believes a change ' +\\n                'might be needed, so you can use your own judgement about whether to take the advice or not.'\\n            ),\\n            h('figure', {},\\n                h('img', {\\n                    src: '/blog/000005-commit-critic/chatgpt-output.webp',\\n                    alt: 'A snapshot of some of the ChatGPT 4o review output.',\\n                    width: 800,\\n                    height: 'auto'\\n                }),\\n                h('figcaption', {}, 'A snapshot of some of the ChatGPT 4o review output')\\n            ),\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'Revisiting the potential benefits of AI-built software'),\\n            h('p', {},\\n                'Earlier in this article, I mentioned some potential benefits of AI-built software.  commit-critic isn\\\\'t ' +\\n                'the only software I\\\\'ve been designing in the last few weeks, but it demonstrates many of these benefits:'\\n            ),\\n            h('ul', {},\\n                h('li', {}, 'It\\\\'s much quicker to build the code (LLMs \\\"type\\\" much faster than people!): you can try this now!'),\\n                h('li', {},\\n                    'It will do all the boring stuff (exception handling, etc.) without complaining: you\\\\'ll see this is all ' +\\n                    'there in the committed code.'\\n                ),\\n                h('li', {},\\n                    'If it knows enough to build the tool, then it can write the user manual: Claude wrote the README.md file ' +\\n                    'on the GitHub repo using a slightly modified version of the Metaphor description'\\n                ),\\n                h('li', {},\\n                    'We can rapidly try new ideas and discard them if they aren\\\\'t useful: if you poke at the git history, ' +\\n                    'you\\\\'ll see earlier iterations of commit-critic.  Some ideas got dropped, some new ones were added, and ' +\\n                    'the AI coded all the modifications.'\\n                ),\\n                h('li', {},\\n                    'It can do all the future maintenance: you can try this yourself too by changing any of the requirements ' +\\n                    'or by editing the coding guidelines used by commit-critic'\\n                )\\n            ),\\n            h('p', {},\\n                'The one I didn\\\\'t mention yet is \\\"If we want tests, it can build them\\\".  I didn\\\\'t build tests for ' +\\n                'commit-critic yet.  However, I did need tests for m6rclib.  To give 100% test coverage over statements and ' +\\n                'branches currently requires just over 1300 lines of unit tests.  Claude 3.5 Sonnet wrote and debugged all ' +\\n                'those in about about 5-6 hours, starting from another Metaphor description.'\\n            ),\\n            h('p', {},\\n                'Sometimes, the future is here already!'\\n            )\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'The sources are on GitHub'),\\n            h('p', {},\\n                'All the code you see here and my initial code guidelines are available on GitHub.  The software is ' +\\n                'open-source under an Apache 2.0 license.'\\n            ),\\n            h('p', {},\\n                'Please see: ',\\n                h('a', {\\n                        href: 'https://github.com/m6r-ai/commit-critic',\\n                        target: '_blank',\\n                        title: 'commit-critic project on GitHub'\\n                    },\\n                    'https://github.com/m6r-ai/commit-critic'\\n                )\\n            )\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'Postscript'),\\n            h('p', {},\\n              'This is a story about AI, so it wouldn\\\\'t be complete without telling you the name for the tool came ' +\\n              'from Claude 3.5 Sonnet after I asked it to come up with some ideas!  That conversation wandered down a ' +\\n              'very entertaining rabbit hole for 5 minutes, and I\\\\'m still wondering when I\\\\'ll get around to designing ' +\\n              'something called \\\"Debugsy Malone\\\".  Who says AIs can\\\\'t have a sense of humour too?'\\n            )\\n        )\\n    ]\\n}\\n\\nexport const blogPost_000005 = new BlogPost(\\n    'commit-critic: An AI-powered, AI-built code review tool',\\n    'Dave Hudson',\\n    '2024-11-15',\\n    '/blog/000005-commit-critic',\\n    'commit-critic: Designing and building an AI-powered, AI-built code review tool.  We look at the design and the' +\\n    'implications of using AI to manage the whole process',\\n    null,\\n    blogArticle_000005\\n);\\n\",\n    \"error\": null\n}\n```",
      "completed": true,
      "tool_results": [
        {
          "id": "call_0",
          "name": "filesystem",
          "content": "File: m6r.ai/000005-commit-critic/post.ts\nSize: 18,024 bytes\nEncoding: utf-8\n\nimport {assertIsVElement, h, updateElement, VNode, VElement} from '../../lib/dvdi';\nimport {BlogPost} from '../BlogPost';\nimport {MetaphorParser, PythonParser} from '../../lib/syntax';\nimport {highlight} from '../../lib/highlight'\nimport {cloneObject} from '../../lib/cloneObject';\nimport {navigateEvent} from '../../app';\n\nconst code: VNode[][] = [[], [], []];\nlet codeVElement: (VElement | null)[] = [null, null, null];\nconst codeFunction: (() => VElement)[] = [\n    blogArticle_000005_Prompt,\n    blogArticle_000005_Guidelines,\n    blogArticle_000005_Code\n];\n\n/**\n * Callback to write the contents of the file load for the first code fragment.\n * @param content\n */\nfunction writeCode(segment: number, content: VNode[]) {\n    code[segment].push(...content);\n    if (codeVElement[segment] === null) {\n        return;\n    }\n\n    assertIsVElement(codeVElement[segment]);\n    if (codeVElement[segment].parentVNode === null) {\n        return;\n    }\n\n    const parentElem = (codeVElement[segment].parentVNode as VElement).domElement;\n    if (parentElem === null) {\n        return;\n    }\n\n    if (codeVElement[segment].domElement === null) {\n        return;\n    }\n\n    const index = Array.from(parentElem.childNodes).indexOf(codeVElement[segment].domElement);\n    const newVElement = codeFunction[segment]();\n    newVElement.parentVNode = codeVElement[segment].parentVNode;\n    updateElement(parentElem,\n        parentElem.childNodes[index],\n        codeVElement[segment].parentVNode as VElement,\n        codeVElement[segment],\n        newVElement\n    );\n    codeVElement[segment] = newVElement;\n}\n\nasync function loadFile(segment: number, filePath: string, storeFunction: (segment: number, content: VNode[]) => void) {\n    try {\n        const response = await fetch(filePath);\n        if (!response.ok) {\n            throw new Error(`Failed to fetch file: ${response.statusText}`);\n        }\n\n        const content = await response.text();\n        let formattedContent: VNode[];\n        if (filePath.endsWith('.py')) {\n            formattedContent = highlight(content, PythonParser);\n        } else {\n            formattedContent = highlight(content, MetaphorParser);\n        }\n\n        storeFunction(segment, formattedContent);\n    } catch (error) {\n        console.error('Error loading file:', error);\n    }\n}\n\nfunction blogArticle_000005_Prompt(): VElement {\n    let contents: VElement;\n    if (code[0].length === 0) {\n        contents = h('pre', {});\n    } else {\n        contents = h('pre', {}, h('code', {}, h('span', {className: 'blocktext'}, ...cloneObject(code[0]))));\n    }\n\n    contents.mountCallback = () => {\n        codeVElement[0] = contents;\n        if (code[0].length === 0) {\n            loadFile(0, '/blog/000005-commit-critic/commit-critic.m6r', writeCode);\n        }\n    }\n\n    contents.unmountCallback = () => {\n        codeVElement[0] = null;\n    }\n\n    return contents;\n}\n\nfunction blogArticle_000005_Guidelines(): VElement {\n    let contents: VElement;\n    if (code[1].length === 0) {\n        contents = h('pre', {});\n    } else {\n        contents = h('pre', {}, h('code', {}, ...cloneObject(code[1])));\n    }\n\n    contents.mountCallback = () => {\n        codeVElement[1] = contents;\n        if (code[1].length === 0) {\n            loadFile(1, '/blog/000005-commit-critic/sample-guideline.m6r', writeCode);\n        }\n    }\n\n    contents.unmountCallback = () => {\n        codeVElement[1] = null;\n    }\n\n    return contents;\n}\n\nfunction blogArticle_000005_Code(): VElement {\n    let contents: VElement;\n    if (code[2].length === 0) {\n        contents = h('pre', {});\n    } else {\n        contents = h('pre', {}, h('code', {}, ...cloneObject(code[2])));\n    }\n\n    contents.mountCallback = () => {\n        codeVElement[2] = contents;\n        if (code[2].length === 0) {\n            loadFile(2, '/blog/000005-commit-critic/commit_critic.py', writeCode);\n        }\n    }\n\n    contents.unmountCallback = () => {\n        codeVElement[2] = null;\n    }\n\n    return contents;\n}\n\nfunction blogArticle_000005(): VElement[] {\n    return [\n        h('p', {},\n            'Code reviews are one of the most important elements of software development.  They\\'re where we seek feedback on ' +\n            'what we\\'ve built, looking to ensure it\\'s understandable, elegant, and free from defects.'\n        ),\n        h('p', {},\n            'A problem with code reviews is that we often need to wait for someone else to have time to look at what we\\'ve ' +\n            'done.  Ideally, we want instant feedback before we submit a PR.'\n        ),\n        h('p', {},\n            'In a previous article (see: ',\n            h('a', {\n                    href: '/blog/000004-Code-reviews-using-Metaphor',\n                    onclick: (e: MouseEvent) => navigateEvent(\n                        e, '/blog/000004-Code-reviews-using-Metaphor'\n                    )\n                },\n                'Code reviews using Metaphor'\n            ),\n            '), I looked at how to build something that could leverage AI to help, but that required a lot of manual steps.  ' +\n            'We really need a tool for this.'\n        ),\n        h('section', {},\n            h('h2', {}, 'Anatomy of a code review tool'),\n            h('p', {},\n                'If we want to build an AI-based code reviewer, we should start with some features we\\'d like it to have.'\n            ),\n            h('p', {},\n                'Ideally, we want something we can integrate with other tools.  That implies we want it to run from a command ' +\n                'line.  Command-line apps need argument flags.  We also want to provide a list of files to review.'\n            ),\n            h('p', {},\n                'We also want it to run everywhere, so let\\'s build it in Python.'\n            ),\n            h('p', {},\n                'Every language, project, company, etc., has different approaches to coding conventions, so we want our code ' +\n                'review guidelines to be customizable.  As we may have code in multiple languages, let\\'s allow for multiple ' +\n                'guidelines, too.'\n            ),\n            h('p', {},\n                'We\\'ll take a Unix-like approach and design our code review tool to generate a large language model (LLM) ' +\n                'prompt as a file but not provide integration with any specific LLM.  That can be done manually by the user ' +\n                'or via a separate prompt upload or interaction tool, which means it can also work with local LLMs, not just ' +\n                'cloud-based ones.'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'Building the prompt'),\n            h('p', {},\n                'The trickiest part of this is planning to build a prompt.  Our AI isn\\'t psychic, and we don\\'t want it ' +\n                'to get creative and come up with new ideas for reviewing code each time.  We solve this by constructing a ' +\n                'large context prompt (LCP) that contains all the information it needs to do the task.'\n            ),\n            h('p', {},\n                'This means the prompt needs:'\n            ),\n            h('ul', {},\n                h('li', {}, 'All the files to review'),\n                h('li', {}, 'All the coding guidelines we want to apply to those files'),\n                h('li', {}, 'Some instructions on what we want it to do'),\n                h('li', {}, 'Some instructions on how we want it to generate its output')\n            ),\n            h('p', {},\n                'There\\'s a library available that makes this very simple, m6rclib.  This is an embedded parser for a ' +\n                'structured document language, Metaphor (see ',\n                h('a', {\n                        href: 'https://github.com/m6r-ai/m6rclib',\n                        target: '_blank',\n                        title: 'm6rclib project on GitHub'\n                    },\n                    'https://github.com/m6r-ai/m6rclib'\n                ),\n                ').  m6rclib is well suited to this problem:'\n            ),\n            h('ul', {},\n                h('li', {}, 'Metaphor files are largely natural language and so fit nicely with describing coding guidelines'),\n                h('li', {}, 'It has an `Include:` keyword that lets us compose a series of files into one prompt'),\n                h('li', {}, 'It has an `Embed:` keyword that lets us embed files into a prompt'),\n                h('li', {},\n                    'It has `Role:`, `Context:` and `Action:` keywords that let us describe the role of the LLM, the context ' +\n                    'we want it to use, and the action we want it to take.'\n                )\n            ),\n            h('p', {},\n                'We stitch together all the elements we want into an overall Metaphor description and let the prompt ' +\n                'compiler do the rest!'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'Coding guidelines'),\n            h('p', {},\n                'Let\\'s look at a fragment of a coding guideline.  This one is a generic guide in Metaphor form.  Some ' +\n                'sub-points probably want to be expanded, which will likely give us a better review, but these are pretty ' +\n                'workable.  Some of these may also be too language-specific and want refactoring, but that\\'s easy to do in ' +\n                'the future. Similarly, some of these may not be universally accepted.  I\\'m hoping the tool\\'s users will ' +\n                'help with this!'\n            ),\n            h('figure', {},\n                blogArticle_000005_Guidelines(),\n                h('figcaption', {}, 'Fragment of a guideline file')\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'Building commit-critic'),\n            h('p', {},\n                'At this point, we\\'ve got a design, so now we want to build the tool.  We could dive in and start coding, ' +\n                'but wouldn\\'t it be better to have an AI do that part, too?  Having it AI-built has a lot of benefits:'\n            ),\n            h('ul', {},\n                h('li', {}, 'It\\'s much quicker to build the code (LLMs \"type\" much faster than people!)'),\n                h('li', {}, 'It will do all the boring stuff (exception handling, etc.) without complaining'),\n                h('li', {}, 'If it knows enough to build the tool, then it can write the user manual'),\n                h('li', {}, 'If we want tests, it can build them'),\n                h('li', {}, 'We can rapidly try new ideas and discard them if they aren\\'t useful'),\n                h('li', {}, 'It can do all the future maintenance')\n            ),\n            h('p', {},\n                'Some of these might sound far-fetched.  Hold that thought, and we\\'ll come back to it later.'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'More Metaphor'),\n            h('p', {},\n                'commit-critic leverages Metaphor to create LLM prompts at runtime, but Metaphor was initially designed to ' +\n                'help me build software using AI.  To support this, I wrote a stand-alone Metaphor compiler, m6rc (see ',\n                h('a', {\n                        href: 'https://github.com/m6r-ai/m6rc',\n                        target: '_blank',\n                        title: 'm6rc project on GitHub'\n                    },\n                    'https://github.com/m6r-ai/m6rc'\n                ),\n                ').  Aside: m6rc used to be quite heavyweight but is now a very light wrapper around m6rclib, too.'\n            ),\n            h('p', {},\n                'If we take and expand on what we have already looked at, we can describe commit-critic in Metaphor.  ' +\n                'Importantly, we\\'re describing what we want the tool to do - i.e. the business logic.  We\\'re not ' +\n                'describing the code!'\n            ),\n            h('figure', {},\n                blogArticle_000005_Prompt(),\n                h('figcaption', {}, 'The v0.1 commit-critic \"source\" file')\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'Generating the executable code'),\n            h('p', {},\n                'We can compile this into a prompt ready to hand to our LLM:'\n            ),\n            h('pre', {},\n                h('code', {},\n                    'm6rc commit-critic.m6r -o out.lcp'\n                )\n            ),\n            h('p', {},\n                'In this instance I handed the task to Claude 3.5 Sonnet:'\n            ),\n            h('figure', {},\n                blogArticle_000005_Code(),\n                h('figcaption', {}, 'The v0.1 commit-critic application code')\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'Testing the output'),\n            h('p', {},\n                'commit-critic needs a little extra python packaging to run as a stand-along application, but we can test it:'\n            ),\n            h('pre', {},\n                h('code', {},\n                    'python3 commit-critic.py -g <review-dir-path> -o out.lcp <file-to-test>'\n                )\n            ),\n            h('p', {},\n                'The following is a fragment of the output from ChatGPT 4o when I asked it to review part of a virtual DOM ' +\n                'implementation I build a few months ago.  As you can see, it produces a series of recommendations, and ' +\n                'tells you which guideline applies.  This makes it much easier to understand why it believes a change ' +\n                'might be needed, so you can use your own judgement about whether to take the advice or not.'\n            ),\n            h('figure', {},\n                h('img', {\n                    src: '/blog/000005-commit-critic/chatgpt-output.webp',\n                    alt: 'A snapshot of some of the ChatGPT 4o review output.',\n                    width: 800,\n                    height: 'auto'\n                }),\n                h('figcaption', {}, 'A snapshot of some of the ChatGPT 4o review output')\n            ),\n        ),\n        h('section', {},\n            h('h2', {}, 'Revisiting the potential benefits of AI-built software'),\n            h('p', {},\n                'Earlier in this article, I mentioned some potential benefits of AI-built software.  commit-critic isn\\'t ' +\n                'the only software I\\'ve been designing in the last few weeks, but it demonstrates many of these benefits:'\n            ),\n            h('ul', {},\n                h('li', {}, 'It\\'s much quicker to build the code (LLMs \"type\" much faster than people!): you can try this now!'),\n                h('li', {},\n                    'It will do all the boring stuff (exception handling, etc.) without complaining: you\\'ll see this is all ' +\n                    'there in the committed code.'\n                ),\n                h('li', {},\n                    'If it knows enough to build the tool, then it can write the user manual: Claude wrote the README.md file ' +\n                    'on the GitHub repo using a slightly modified version of the Metaphor description'\n                ),\n                h('li', {},\n                    'We can rapidly try new ideas and discard them if they aren\\'t useful: if you poke at the git history, ' +\n                    'you\\'ll see earlier iterations of commit-critic.  Some ideas got dropped, some new ones were added, and ' +\n                    'the AI coded all the modifications.'\n                ),\n                h('li', {},\n                    'It can do all the future maintenance: you can try this yourself too by changing any of the requirements ' +\n                    'or by editing the coding guidelines used by commit-critic'\n                )\n            ),\n            h('p', {},\n                'The one I didn\\'t mention yet is \"If we want tests, it can build them\".  I didn\\'t build tests for ' +\n                'commit-critic yet.  However, I did need tests for m6rclib.  To give 100% test coverage over statements and ' +\n                'branches currently requires just over 1300 lines of unit tests.  Claude 3.5 Sonnet wrote and debugged all ' +\n                'those in about about 5-6 hours, starting from another Metaphor description.'\n            ),\n            h('p', {},\n                'Sometimes, the future is here already!'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'The sources are on GitHub'),\n            h('p', {},\n                'All the code you see here and my initial code guidelines are available on GitHub.  The software is ' +\n                'open-source under an Apache 2.0 license.'\n            ),\n            h('p', {},\n                'Please see: ',\n                h('a', {\n                        href: 'https://github.com/m6r-ai/commit-critic',\n                        target: '_blank',\n                        title: 'commit-critic project on GitHub'\n                    },\n                    'https://github.com/m6r-ai/commit-critic'\n                )\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'Postscript'),\n            h('p', {},\n              'This is a story about AI, so it wouldn\\'t be complete without telling you the name for the tool came ' +\n              'from Claude 3.5 Sonnet after I asked it to come up with some ideas!  That conversation wandered down a ' +\n              'very entertaining rabbit hole for 5 minutes, and I\\'m still wondering when I\\'ll get around to designing ' +\n              'something called \"Debugsy Malone\".  Who says AIs can\\'t have a sense of humour too?'\n            )\n        )\n    ]\n}\n\nexport const blogPost_000005 = new BlogPost(\n    'commit-critic: An AI-powered, AI-built code review tool',\n    'Dave Hudson',\n    '2024-11-15',\n    '/blog/000005-commit-critic',\n    'commit-critic: Designing and building an AI-powered, AI-built code review tool.  We look at the design and the' +\n    'implications of using AI to manage the whole process',\n    null,\n    blogArticle_000005\n);\n",
          "error": null
        }
      ]
    },
    {
      "id": "33622a3e-fb69-457a-8ca8-978d0735a08c",
      "timestamp": "2025-07-27T12:51:27.738569+00:00",
      "type": "user_message",
      "content": "",
      "completed": true,
      "tool_results": [
        {
          "id": "call_0",
          "name": "filesystem",
          "content": "File: m6r.ai/000005-commit-critic/post.ts\nSize: 18,024 bytes\nEncoding: utf-8\n\nimport {assertIsVElement, h, updateElement, VNode, VElement} from '../../lib/dvdi';\nimport {BlogPost} from '../BlogPost';\nimport {MetaphorParser, PythonParser} from '../../lib/syntax';\nimport {highlight} from '../../lib/highlight'\nimport {cloneObject} from '../../lib/cloneObject';\nimport {navigateEvent} from '../../app';\n\nconst code: VNode[][] = [[], [], []];\nlet codeVElement: (VElement | null)[] = [null, null, null];\nconst codeFunction: (() => VElement)[] = [\n    blogArticle_000005_Prompt,\n    blogArticle_000005_Guidelines,\n    blogArticle_000005_Code\n];\n\n/**\n * Callback to write the contents of the file load for the first code fragment.\n * @param content\n */\nfunction writeCode(segment: number, content: VNode[]) {\n    code[segment].push(...content);\n    if (codeVElement[segment] === null) {\n        return;\n    }\n\n    assertIsVElement(codeVElement[segment]);\n    if (codeVElement[segment].parentVNode === null) {\n        return;\n    }\n\n    const parentElem = (codeVElement[segment].parentVNode as VElement).domElement;\n    if (parentElem === null) {\n        return;\n    }\n\n    if (codeVElement[segment].domElement === null) {\n        return;\n    }\n\n    const index = Array.from(parentElem.childNodes).indexOf(codeVElement[segment].domElement);\n    const newVElement = codeFunction[segment]();\n    newVElement.parentVNode = codeVElement[segment].parentVNode;\n    updateElement(parentElem,\n        parentElem.childNodes[index],\n        codeVElement[segment].parentVNode as VElement,\n        codeVElement[segment],\n        newVElement\n    );\n    codeVElement[segment] = newVElement;\n}\n\nasync function loadFile(segment: number, filePath: string, storeFunction: (segment: number, content: VNode[]) => void) {\n    try {\n        const response = await fetch(filePath);\n        if (!response.ok) {\n            throw new Error(`Failed to fetch file: ${response.statusText}`);\n        }\n\n        const content = await response.text();\n        let formattedContent: VNode[];\n        if (filePath.endsWith('.py')) {\n            formattedContent = highlight(content, PythonParser);\n        } else {\n            formattedContent = highlight(content, MetaphorParser);\n        }\n\n        storeFunction(segment, formattedContent);\n    } catch (error) {\n        console.error('Error loading file:', error);\n    }\n}\n\nfunction blogArticle_000005_Prompt(): VElement {\n    let contents: VElement;\n    if (code[0].length === 0) {\n        contents = h('pre', {});\n    } else {\n        contents = h('pre', {}, h('code', {}, h('span', {className: 'blocktext'}, ...cloneObject(code[0]))));\n    }\n\n    contents.mountCallback = () => {\n        codeVElement[0] = contents;\n        if (code[0].length === 0) {\n            loadFile(0, '/blog/000005-commit-critic/commit-critic.m6r', writeCode);\n        }\n    }\n\n    contents.unmountCallback = () => {\n        codeVElement[0] = null;\n    }\n\n    return contents;\n}\n\nfunction blogArticle_000005_Guidelines(): VElement {\n    let contents: VElement;\n    if (code[1].length === 0) {\n        contents = h('pre', {});\n    } else {\n        contents = h('pre', {}, h('code', {}, ...cloneObject(code[1])));\n    }\n\n    contents.mountCallback = () => {\n        codeVElement[1] = contents;\n        if (code[1].length === 0) {\n            loadFile(1, '/blog/000005-commit-critic/sample-guideline.m6r', writeCode);\n        }\n    }\n\n    contents.unmountCallback = () => {\n        codeVElement[1] = null;\n    }\n\n    return contents;\n}\n\nfunction blogArticle_000005_Code(): VElement {\n    let contents: VElement;\n    if (code[2].length === 0) {\n        contents = h('pre', {});\n    } else {\n        contents = h('pre', {}, h('code', {}, ...cloneObject(code[2])));\n    }\n\n    contents.mountCallback = () => {\n        codeVElement[2] = contents;\n        if (code[2].length === 0) {\n            loadFile(2, '/blog/000005-commit-critic/commit_critic.py', writeCode);\n        }\n    }\n\n    contents.unmountCallback = () => {\n        codeVElement[2] = null;\n    }\n\n    return contents;\n}\n\nfunction blogArticle_000005(): VElement[] {\n    return [\n        h('p', {},\n            'Code reviews are one of the most important elements of software development.  They\\'re where we seek feedback on ' +\n            'what we\\'ve built, looking to ensure it\\'s understandable, elegant, and free from defects.'\n        ),\n        h('p', {},\n            'A problem with code reviews is that we often need to wait for someone else to have time to look at what we\\'ve ' +\n            'done.  Ideally, we want instant feedback before we submit a PR.'\n        ),\n        h('p', {},\n            'In a previous article (see: ',\n            h('a', {\n                    href: '/blog/000004-Code-reviews-using-Metaphor',\n                    onclick: (e: MouseEvent) => navigateEvent(\n                        e, '/blog/000004-Code-reviews-using-Metaphor'\n                    )\n                },\n                'Code reviews using Metaphor'\n            ),\n            '), I looked at how to build something that could leverage AI to help, but that required a lot of manual steps.  ' +\n            'We really need a tool for this.'\n        ),\n        h('section', {},\n            h('h2', {}, 'Anatomy of a code review tool'),\n            h('p', {},\n                'If we want to build an AI-based code reviewer, we should start with some features we\\'d like it to have.'\n            ),\n            h('p', {},\n                'Ideally, we want something we can integrate with other tools.  That implies we want it to run from a command ' +\n                'line.  Command-line apps need argument flags.  We also want to provide a list of files to review.'\n            ),\n            h('p', {},\n                'We also want it to run everywhere, so let\\'s build it in Python.'\n            ),\n            h('p', {},\n                'Every language, project, company, etc., has different approaches to coding conventions, so we want our code ' +\n                'review guidelines to be customizable.  As we may have code in multiple languages, let\\'s allow for multiple ' +\n                'guidelines, too.'\n            ),\n            h('p', {},\n                'We\\'ll take a Unix-like approach and design our code review tool to generate a large language model (LLM) ' +\n                'prompt as a file but not provide integration with any specific LLM.  That can be done manually by the user ' +\n                'or via a separate prompt upload or interaction tool, which means it can also work with local LLMs, not just ' +\n                'cloud-based ones.'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'Building the prompt'),\n            h('p', {},\n                'The trickiest part of this is planning to build a prompt.  Our AI isn\\'t psychic, and we don\\'t want it ' +\n                'to get creative and come up with new ideas for reviewing code each time.  We solve this by constructing a ' +\n                'large context prompt (LCP) that contains all the information it needs to do the task.'\n            ),\n            h('p', {},\n                'This means the prompt needs:'\n            ),\n            h('ul', {},\n                h('li', {}, 'All the files to review'),\n                h('li', {}, 'All the coding guidelines we want to apply to those files'),\n                h('li', {}, 'Some instructions on what we want it to do'),\n                h('li', {}, 'Some instructions on how we want it to generate its output')\n            ),\n            h('p', {},\n                'There\\'s a library available that makes this very simple, m6rclib.  This is an embedded parser for a ' +\n                'structured document language, Metaphor (see ',\n                h('a', {\n                        href: 'https://github.com/m6r-ai/m6rclib',\n                        target: '_blank',\n                        title: 'm6rclib project on GitHub'\n                    },\n                    'https://github.com/m6r-ai/m6rclib'\n                ),\n                ').  m6rclib is well suited to this problem:'\n            ),\n            h('ul', {},\n                h('li', {}, 'Metaphor files are largely natural language and so fit nicely with describing coding guidelines'),\n                h('li', {}, 'It has an `Include:` keyword that lets us compose a series of files into one prompt'),\n                h('li', {}, 'It has an `Embed:` keyword that lets us embed files into a prompt'),\n                h('li', {},\n                    'It has `Role:`, `Context:` and `Action:` keywords that let us describe the role of the LLM, the context ' +\n                    'we want it to use, and the action we want it to take.'\n                )\n            ),\n            h('p', {},\n                'We stitch together all the elements we want into an overall Metaphor description and let the prompt ' +\n                'compiler do the rest!'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'Coding guidelines'),\n            h('p', {},\n                'Let\\'s look at a fragment of a coding guideline.  This one is a generic guide in Metaphor form.  Some ' +\n                'sub-points probably want to be expanded, which will likely give us a better review, but these are pretty ' +\n                'workable.  Some of these may also be too language-specific and want refactoring, but that\\'s easy to do in ' +\n                'the future. Similarly, some of these may not be universally accepted.  I\\'m hoping the tool\\'s users will ' +\n                'help with this!'\n            ),\n            h('figure', {},\n                blogArticle_000005_Guidelines(),\n                h('figcaption', {}, 'Fragment of a guideline file')\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'Building commit-critic'),\n            h('p', {},\n                'At this point, we\\'ve got a design, so now we want to build the tool.  We could dive in and start coding, ' +\n                'but wouldn\\'t it be better to have an AI do that part, too?  Having it AI-built has a lot of benefits:'\n            ),\n            h('ul', {},\n                h('li', {}, 'It\\'s much quicker to build the code (LLMs \"type\" much faster than people!)'),\n                h('li', {}, 'It will do all the boring stuff (exception handling, etc.) without complaining'),\n                h('li', {}, 'If it knows enough to build the tool, then it can write the user manual'),\n                h('li', {}, 'If we want tests, it can build them'),\n                h('li', {}, 'We can rapidly try new ideas and discard them if they aren\\'t useful'),\n                h('li', {}, 'It can do all the future maintenance')\n            ),\n            h('p', {},\n                'Some of these might sound far-fetched.  Hold that thought, and we\\'ll come back to it later.'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'More Metaphor'),\n            h('p', {},\n                'commit-critic leverages Metaphor to create LLM prompts at runtime, but Metaphor was initially designed to ' +\n                'help me build software using AI.  To support this, I wrote a stand-alone Metaphor compiler, m6rc (see ',\n                h('a', {\n                        href: 'https://github.com/m6r-ai/m6rc',\n                        target: '_blank',\n                        title: 'm6rc project on GitHub'\n                    },\n                    'https://github.com/m6r-ai/m6rc'\n                ),\n                ').  Aside: m6rc used to be quite heavyweight but is now a very light wrapper around m6rclib, too.'\n            ),\n            h('p', {},\n                'If we take and expand on what we have already looked at, we can describe commit-critic in Metaphor.  ' +\n                'Importantly, we\\'re describing what we want the tool to do - i.e. the business logic.  We\\'re not ' +\n                'describing the code!'\n            ),\n            h('figure', {},\n                blogArticle_000005_Prompt(),\n                h('figcaption', {}, 'The v0.1 commit-critic \"source\" file')\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'Generating the executable code'),\n            h('p', {},\n                'We can compile this into a prompt ready to hand to our LLM:'\n            ),\n            h('pre', {},\n                h('code', {},\n                    'm6rc commit-critic.m6r -o out.lcp'\n                )\n            ),\n            h('p', {},\n                'In this instance I handed the task to Claude 3.5 Sonnet:'\n            ),\n            h('figure', {},\n                blogArticle_000005_Code(),\n                h('figcaption', {}, 'The v0.1 commit-critic application code')\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'Testing the output'),\n            h('p', {},\n                'commit-critic needs a little extra python packaging to run as a stand-along application, but we can test it:'\n            ),\n            h('pre', {},\n                h('code', {},\n                    'python3 commit-critic.py -g <review-dir-path> -o out.lcp <file-to-test>'\n                )\n            ),\n            h('p', {},\n                'The following is a fragment of the output from ChatGPT 4o when I asked it to review part of a virtual DOM ' +\n                'implementation I build a few months ago.  As you can see, it produces a series of recommendations, and ' +\n                'tells you which guideline applies.  This makes it much easier to understand why it believes a change ' +\n                'might be needed, so you can use your own judgement about whether to take the advice or not.'\n            ),\n            h('figure', {},\n                h('img', {\n                    src: '/blog/000005-commit-critic/chatgpt-output.webp',\n                    alt: 'A snapshot of some of the ChatGPT 4o review output.',\n                    width: 800,\n                    height: 'auto'\n                }),\n                h('figcaption', {}, 'A snapshot of some of the ChatGPT 4o review output')\n            ),\n        ),\n        h('section', {},\n            h('h2', {}, 'Revisiting the potential benefits of AI-built software'),\n            h('p', {},\n                'Earlier in this article, I mentioned some potential benefits of AI-built software.  commit-critic isn\\'t ' +\n                'the only software I\\'ve been designing in the last few weeks, but it demonstrates many of these benefits:'\n            ),\n            h('ul', {},\n                h('li', {}, 'It\\'s much quicker to build the code (LLMs \"type\" much faster than people!): you can try this now!'),\n                h('li', {},\n                    'It will do all the boring stuff (exception handling, etc.) without complaining: you\\'ll see this is all ' +\n                    'there in the committed code.'\n                ),\n                h('li', {},\n                    'If it knows enough to build the tool, then it can write the user manual: Claude wrote the README.md file ' +\n                    'on the GitHub repo using a slightly modified version of the Metaphor description'\n                ),\n                h('li', {},\n                    'We can rapidly try new ideas and discard them if they aren\\'t useful: if you poke at the git history, ' +\n                    'you\\'ll see earlier iterations of commit-critic.  Some ideas got dropped, some new ones were added, and ' +\n                    'the AI coded all the modifications.'\n                ),\n                h('li', {},\n                    'It can do all the future maintenance: you can try this yourself too by changing any of the requirements ' +\n                    'or by editing the coding guidelines used by commit-critic'\n                )\n            ),\n            h('p', {},\n                'The one I didn\\'t mention yet is \"If we want tests, it can build them\".  I didn\\'t build tests for ' +\n                'commit-critic yet.  However, I did need tests for m6rclib.  To give 100% test coverage over statements and ' +\n                'branches currently requires just over 1300 lines of unit tests.  Claude 3.5 Sonnet wrote and debugged all ' +\n                'those in about about 5-6 hours, starting from another Metaphor description.'\n            ),\n            h('p', {},\n                'Sometimes, the future is here already!'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'The sources are on GitHub'),\n            h('p', {},\n                'All the code you see here and my initial code guidelines are available on GitHub.  The software is ' +\n                'open-source under an Apache 2.0 license.'\n            ),\n            h('p', {},\n                'Please see: ',\n                h('a', {\n                        href: 'https://github.com/m6r-ai/commit-critic',\n                        target: '_blank',\n                        title: 'commit-critic project on GitHub'\n                    },\n                    'https://github.com/m6r-ai/commit-critic'\n                )\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'Postscript'),\n            h('p', {},\n              'This is a story about AI, so it wouldn\\'t be complete without telling you the name for the tool came ' +\n              'from Claude 3.5 Sonnet after I asked it to come up with some ideas!  That conversation wandered down a ' +\n              'very entertaining rabbit hole for 5 minutes, and I\\'m still wondering when I\\'ll get around to designing ' +\n              'something called \"Debugsy Malone\".  Who says AIs can\\'t have a sense of humour too?'\n            )\n        )\n    ]\n}\n\nexport const blogPost_000005 = new BlogPost(\n    'commit-critic: An AI-powered, AI-built code review tool',\n    'Dave Hudson',\n    '2024-11-15',\n    '/blog/000005-commit-critic',\n    'commit-critic: Designing and building an AI-powered, AI-built code review tool.  We look at the design and the' +\n    'implications of using AI to manage the whole process',\n    null,\n    blogArticle_000005\n);\n",
          "error": null
        }
      ]
    },
    {
      "id": "61f2c732-adc7-4dfe-9e5f-fc6fd71983e5",
      "timestamp": "2025-07-27T12:51:28.845290+00:00",
      "type": "ai_response",
      "content": "",
      "completed": true,
      "model": "gemini-1.5-flash",
      "reasoning_capability": 1,
      "temperature": 0.7,
      "tool_calls": [
        {
          "id": "call_0",
          "name": "filesystem",
          "arguments": {
            "path": "m6r.ai/000008-Vibe-coding/post.ts",
            "operation": "read_file"
          }
        }
      ]
    },
    {
      "id": "b179842b-cf11-40c5-9cea-181b5694329c",
      "timestamp": "2025-07-27T12:51:28.852149+00:00",
      "type": "tool_call",
      "content": "```json\n{\n    \"id\": \"call_0\",\n    \"name\": \"filesystem\",\n    \"arguments\": {\n        \"path\": \"m6r.ai/000008-Vibe-coding/post.ts\",\n        \"operation\": \"read_file\"\n    }\n}\n```",
      "completed": true,
      "tool_calls": [
        {
          "id": "call_0",
          "name": "filesystem",
          "arguments": {
            "path": "m6r.ai/000008-Vibe-coding/post.ts",
            "operation": "read_file"
          }
        }
      ]
    },
    {
      "id": "72782b47-5932-44e4-bb43-fe7ea8d0601e",
      "timestamp": "2025-07-27T12:51:28.862756+00:00",
      "type": "tool_result",
      "content": "```json\n{\n    \"id\": \"call_0\",\n    \"name\": \"filesystem\",\n    \"content\": \"File: m6r.ai/000008-Vibe-coding/post.ts\\nSize: 2,915 bytes\\nEncoding: utf-8\\n\\nimport {h, VElement} from '../../lib/dvdi';\\nimport {BlogPost} from '../BlogPost';\\n\\nfunction blogArticle_000008(): VElement[] {\\n    return [\\n        h('p', {},\\n            'It seems lots of people are losing their minds over the pros and cons of \\\"vibe coding\\\", so I\\\\'ve been ' +\\n            'reflecting on my experiences over the last year.'\\n        ),\\n        h('p', {},\\n            'Most of the great software engineers I\\\\'ve worked have built \\\"rapid prototypes\\\" to try out ideas and ' +\\n            'learn from them. These were almost always intended to be thrown away (although the occasional prototype ' +\\n            'turned out to be awesome). Vibe coding offers a great way to experiment, and learn from, throw-away ' +\\n            'prototypes! There has never been a time before where it was so easy to try several different approaches ' +\\n            'to a problem to see what works better.'\\n        ),\\n        h('p', {},\\n            'The problem comes with the \\\"learn from them\\\" part. Our current LLM AI models don\\\\'t learn from these ' +\\n            'experiments. They don\\\\'t accumulate the knowledge of the paths that didn\\\\'t work out unless we capture ' +\\n            'them in some way that they can read when we ask them to do something new. Importantly, the next ' +\\n            'generations of LLMs are trained on what made it into our software, not all the rejected prototypes. ' +\\n            'This means our future LLMs don\\\\'t get to learn what didn\\\\'t work because they rarely see that side.'\\n        ),\\n        h('p', {},\\n            'With human teams, we try to have our engineers talk about the things that didn\\\\'t work as much as the ' +\\n            'things that did. This lets other people on the team, or future joiners to them team, understand what ' +\\n            'was learned. We get reports, presentations, workshops, etc. Engineering is as much about handling and ' +\\n            'learning from failures as successes. It\\\\'s all about the details, and the details are unique to each problem.'\\n        ),\\n        h('p', {},\\n            'We can do the same for our AI assistants too. We can give them context such as design docs, product ' +\\n            'specs, or even just really great comments explaining *why* our software behaves in particular ways. ' +\\n            'Just like with human engineers we can discuss new software designs with our AIs to ensure they actually ' +\\n            'make sense. This is how we enable our AIs to be engineers, and it\\\\'s this attention to detail that is ' +\\n            'why \\\"vibe engineering\\\" will never be a thing!'\\n        )\\n    ];\\n}\\n\\nexport const blogPost_000008 = new BlogPost(\\n    'Vibe coding',\\n    'Dave Hudson',\\n    '2025-03-20',\\n    '/blog/000008-Vibe-coding',\\n    'Reflections on the \\\"vibe coding\\\" trend and how we can learn from experimental approaches while still maintaining engineering rigor.',\\n    null,\\n    blogArticle_000008\\n);\\n\",\n    \"error\": null\n}\n```",
      "completed": true,
      "tool_results": [
        {
          "id": "call_0",
          "name": "filesystem",
          "content": "File: m6r.ai/000008-Vibe-coding/post.ts\nSize: 2,915 bytes\nEncoding: utf-8\n\nimport {h, VElement} from '../../lib/dvdi';\nimport {BlogPost} from '../BlogPost';\n\nfunction blogArticle_000008(): VElement[] {\n    return [\n        h('p', {},\n            'It seems lots of people are losing their minds over the pros and cons of \"vibe coding\", so I\\'ve been ' +\n            'reflecting on my experiences over the last year.'\n        ),\n        h('p', {},\n            'Most of the great software engineers I\\'ve worked have built \"rapid prototypes\" to try out ideas and ' +\n            'learn from them. These were almost always intended to be thrown away (although the occasional prototype ' +\n            'turned out to be awesome). Vibe coding offers a great way to experiment, and learn from, throw-away ' +\n            'prototypes! There has never been a time before where it was so easy to try several different approaches ' +\n            'to a problem to see what works better.'\n        ),\n        h('p', {},\n            'The problem comes with the \"learn from them\" part. Our current LLM AI models don\\'t learn from these ' +\n            'experiments. They don\\'t accumulate the knowledge of the paths that didn\\'t work out unless we capture ' +\n            'them in some way that they can read when we ask them to do something new. Importantly, the next ' +\n            'generations of LLMs are trained on what made it into our software, not all the rejected prototypes. ' +\n            'This means our future LLMs don\\'t get to learn what didn\\'t work because they rarely see that side.'\n        ),\n        h('p', {},\n            'With human teams, we try to have our engineers talk about the things that didn\\'t work as much as the ' +\n            'things that did. This lets other people on the team, or future joiners to them team, understand what ' +\n            'was learned. We get reports, presentations, workshops, etc. Engineering is as much about handling and ' +\n            'learning from failures as successes. It\\'s all about the details, and the details are unique to each problem.'\n        ),\n        h('p', {},\n            'We can do the same for our AI assistants too. We can give them context such as design docs, product ' +\n            'specs, or even just really great comments explaining *why* our software behaves in particular ways. ' +\n            'Just like with human engineers we can discuss new software designs with our AIs to ensure they actually ' +\n            'make sense. This is how we enable our AIs to be engineers, and it\\'s this attention to detail that is ' +\n            'why \"vibe engineering\" will never be a thing!'\n        )\n    ];\n}\n\nexport const blogPost_000008 = new BlogPost(\n    'Vibe coding',\n    'Dave Hudson',\n    '2025-03-20',\n    '/blog/000008-Vibe-coding',\n    'Reflections on the \"vibe coding\" trend and how we can learn from experimental approaches while still maintaining engineering rigor.',\n    null,\n    blogArticle_000008\n);\n",
          "error": null
        }
      ]
    },
    {
      "id": "41a113bc-2a8e-46c7-b0fe-47fc4dc86ce5",
      "timestamp": "2025-07-27T12:51:28.871291+00:00",
      "type": "user_message",
      "content": "",
      "completed": true,
      "tool_results": [
        {
          "id": "call_0",
          "name": "filesystem",
          "content": "File: m6r.ai/000008-Vibe-coding/post.ts\nSize: 2,915 bytes\nEncoding: utf-8\n\nimport {h, VElement} from '../../lib/dvdi';\nimport {BlogPost} from '../BlogPost';\n\nfunction blogArticle_000008(): VElement[] {\n    return [\n        h('p', {},\n            'It seems lots of people are losing their minds over the pros and cons of \"vibe coding\", so I\\'ve been ' +\n            'reflecting on my experiences over the last year.'\n        ),\n        h('p', {},\n            'Most of the great software engineers I\\'ve worked have built \"rapid prototypes\" to try out ideas and ' +\n            'learn from them. These were almost always intended to be thrown away (although the occasional prototype ' +\n            'turned out to be awesome). Vibe coding offers a great way to experiment, and learn from, throw-away ' +\n            'prototypes! There has never been a time before where it was so easy to try several different approaches ' +\n            'to a problem to see what works better.'\n        ),\n        h('p', {},\n            'The problem comes with the \"learn from them\" part. Our current LLM AI models don\\'t learn from these ' +\n            'experiments. They don\\'t accumulate the knowledge of the paths that didn\\'t work out unless we capture ' +\n            'them in some way that they can read when we ask them to do something new. Importantly, the next ' +\n            'generations of LLMs are trained on what made it into our software, not all the rejected prototypes. ' +\n            'This means our future LLMs don\\'t get to learn what didn\\'t work because they rarely see that side.'\n        ),\n        h('p', {},\n            'With human teams, we try to have our engineers talk about the things that didn\\'t work as much as the ' +\n            'things that did. This lets other people on the team, or future joiners to them team, understand what ' +\n            'was learned. We get reports, presentations, workshops, etc. Engineering is as much about handling and ' +\n            'learning from failures as successes. It\\'s all about the details, and the details are unique to each problem.'\n        ),\n        h('p', {},\n            'We can do the same for our AI assistants too. We can give them context such as design docs, product ' +\n            'specs, or even just really great comments explaining *why* our software behaves in particular ways. ' +\n            'Just like with human engineers we can discuss new software designs with our AIs to ensure they actually ' +\n            'make sense. This is how we enable our AIs to be engineers, and it\\'s this attention to detail that is ' +\n            'why \"vibe engineering\" will never be a thing!'\n        )\n    ];\n}\n\nexport const blogPost_000008 = new BlogPost(\n    'Vibe coding',\n    'Dave Hudson',\n    '2025-03-20',\n    '/blog/000008-Vibe-coding',\n    'Reflections on the \"vibe coding\" trend and how we can learn from experimental approaches while still maintaining engineering rigor.',\n    null,\n    blogArticle_000008\n);\n",
          "error": null
        }
      ]
    },
    {
      "id": "0ddc8304-6d53-472b-89d6-d2c4880f8212",
      "timestamp": "2025-07-27T12:51:29.970906+00:00",
      "type": "ai_response",
      "content": "",
      "completed": true,
      "model": "gemini-1.5-flash",
      "reasoning_capability": 1,
      "temperature": 0.7,
      "tool_calls": [
        {
          "id": "call_0",
          "name": "filesystem",
          "arguments": {
            "path": "m6r.ai/000009-Initial-thoughts-on-Google-Gemini-25/post.ts",
            "operation": "read_file"
          }
        }
      ]
    },
    {
      "id": "f5f9b6e5-6be2-45bf-8fa3-9373f9f2a58c",
      "timestamp": "2025-07-27T12:51:29.980380+00:00",
      "type": "tool_call",
      "content": "```json\n{\n    \"id\": \"call_0\",\n    \"name\": \"filesystem\",\n    \"arguments\": {\n        \"path\": \"m6r.ai/000009-Initial-thoughts-on-Google-Gemini-25/post.ts\",\n        \"operation\": \"read_file\"\n    }\n}\n```",
      "completed": true,
      "tool_calls": [
        {
          "id": "call_0",
          "name": "filesystem",
          "arguments": {
            "path": "m6r.ai/000009-Initial-thoughts-on-Google-Gemini-25/post.ts",
            "operation": "read_file"
          }
        }
      ]
    },
    {
      "id": "4e496d1c-ba04-44af-8fe9-929a54a0a202",
      "timestamp": "2025-07-27T12:51:29.992761+00:00",
      "type": "tool_result",
      "content": "```json\n{\n    \"id\": \"call_0\",\n    \"name\": \"filesystem\",\n    \"content\": \"File: m6r.ai/000009-Initial-thoughts-on-Google-Gemini-25/post.ts\\nSize: 4,054 bytes\\nEncoding: utf-8\\n\\nimport {h, VElement} from '../../lib/dvdi';\\nimport {BlogPost} from '../BlogPost';\\n\\nfunction blogArticle_000009(): VElement[] {\\n    return [\\n        h('p', {},\\n            'I was interested to see what Google Gemini 2.5 pro could do, compared with Claude Sonnet 3.7. ' +\\n            'Claude has been my go-to model for months now.'\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'The good'),\\n            h('ul', {},\\n                h('li', {},\\n                    'Gemini can handle a very large context - my 35k lines of python required less than 35% of the ' +\\n                    'available context window. Google continue to win hands down on this as Claude can only get to ' +\\n                    'just over 20k lines of code before it hits its limits.'\\n                ),\\n                h('li', {},\\n                    'I asked it to find opportunities to refactor my code and it found quite a few (I knew about most ' +\\n                    'of them already). Its suggestions all looked architecturally sound.'\\n                ),\\n                h('li', {},\\n                    'It can clearly generate very large amounts of software (and it seems to be high quality), including ' +\\n                    'breaking things into file-sized chunks to make things easy to work with.'\\n                ),\\n                h('li', {}, 'Gemini is very fast at generating code.'),\\n                h('li', {}, 'You can try it for free as Google offer a free API tier!')\\n            )\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'The not-so-good'),\\n            h('ul', {},\\n                h('li', {},\\n                    'Despite quite a lot of discussion it was very hard to get Gemini to not try and do other things ' +\\n                    'while it was doing the refactoring problem I asked it to try.'\\n                ),\\n                h('li', {},\\n                    'Even after I got it to stop adding pointless comments it insisted on \\\"helpfully\\\" doing unrelated ' +\\n                    'things. To be fair, it picked up and fixed a couple of bugs, corrected some type hinting issues, ' +\\n                    'and fixed some comments that were incorrect, but I\\\\'d asked it not to touch anything that wasn\\\\'t ' +\\n                    'directly related to my change. A big part of engineering process is to change one thing at a time, ' +\\n                    'so I\\\\'d be happy if it told me about issues it found, but silently changing code is frustrating.'\\n                ),\\n                h('li', {}, 'I fairly quickly hit the \\\"requests-per-day\\\" limit.')\\n            )\\n        ),\\n        h('section', {},\\n            h('p', {},\\n                'On balance I\\\\'m pretty impressed. It\\\\'s dramatically better than earlier Google models, but I\\\\'m not ' +\\n                'trading in Claude for doing implementation work just yet. Claude is just that bit better at doing what it\\\\'s asked.'\\n            ),\\n            h('p', {},\\n                'With that said, I can now see me regularly using Gemini 2.5 to help me plan work for Claude. No matter ' +\\n                'how much I do this, there is still something enormously impressive about watching an AI review 35,000 lines ' +\\n                'of code and then make high quality suggestions about how to improve it within 15 seconds!'\\n            ),\\n            h('figure', {},\\n                h('img', {\\n                    src: '/blog/000009-Initial-thoughts-on-Google-Gemini-25/gemini.webp',\\n                    alt: 'Gemini offers thoughts on the design of Humbug.',\\n                    width: 1024,\\n                    height: 'auto'\\n                })\\n            )\\n        )\\n    ];\\n}\\n\\nexport const blogPost_000009 = new BlogPost(\\n    'Initial thoughts on Google Gemini 2.5',\\n    'Dave Hudson',\\n    '2025-03-28',\\n    '/blog/000009-Initial-thoughts-on-Google-Gemini-25',\\n    'An initial comparison of Google Gemini 2.5 Pro with Claude Sonnet 3.7 for code refactoring tasks.',\\n    '/blog/000009-Initial-thoughts-on-Google-Gemini-25/gemini.webp',\\n    blogArticle_000009\\n);\\n\",\n    \"error\": null\n}\n```",
      "completed": true,
      "tool_results": [
        {
          "id": "call_0",
          "name": "filesystem",
          "content": "File: m6r.ai/000009-Initial-thoughts-on-Google-Gemini-25/post.ts\nSize: 4,054 bytes\nEncoding: utf-8\n\nimport {h, VElement} from '../../lib/dvdi';\nimport {BlogPost} from '../BlogPost';\n\nfunction blogArticle_000009(): VElement[] {\n    return [\n        h('p', {},\n            'I was interested to see what Google Gemini 2.5 pro could do, compared with Claude Sonnet 3.7. ' +\n            'Claude has been my go-to model for months now.'\n        ),\n        h('section', {},\n            h('h2', {}, 'The good'),\n            h('ul', {},\n                h('li', {},\n                    'Gemini can handle a very large context - my 35k lines of python required less than 35% of the ' +\n                    'available context window. Google continue to win hands down on this as Claude can only get to ' +\n                    'just over 20k lines of code before it hits its limits.'\n                ),\n                h('li', {},\n                    'I asked it to find opportunities to refactor my code and it found quite a few (I knew about most ' +\n                    'of them already). Its suggestions all looked architecturally sound.'\n                ),\n                h('li', {},\n                    'It can clearly generate very large amounts of software (and it seems to be high quality), including ' +\n                    'breaking things into file-sized chunks to make things easy to work with.'\n                ),\n                h('li', {}, 'Gemini is very fast at generating code.'),\n                h('li', {}, 'You can try it for free as Google offer a free API tier!')\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'The not-so-good'),\n            h('ul', {},\n                h('li', {},\n                    'Despite quite a lot of discussion it was very hard to get Gemini to not try and do other things ' +\n                    'while it was doing the refactoring problem I asked it to try.'\n                ),\n                h('li', {},\n                    'Even after I got it to stop adding pointless comments it insisted on \"helpfully\" doing unrelated ' +\n                    'things. To be fair, it picked up and fixed a couple of bugs, corrected some type hinting issues, ' +\n                    'and fixed some comments that were incorrect, but I\\'d asked it not to touch anything that wasn\\'t ' +\n                    'directly related to my change. A big part of engineering process is to change one thing at a time, ' +\n                    'so I\\'d be happy if it told me about issues it found, but silently changing code is frustrating.'\n                ),\n                h('li', {}, 'I fairly quickly hit the \"requests-per-day\" limit.')\n            )\n        ),\n        h('section', {},\n            h('p', {},\n                'On balance I\\'m pretty impressed. It\\'s dramatically better than earlier Google models, but I\\'m not ' +\n                'trading in Claude for doing implementation work just yet. Claude is just that bit better at doing what it\\'s asked.'\n            ),\n            h('p', {},\n                'With that said, I can now see me regularly using Gemini 2.5 to help me plan work for Claude. No matter ' +\n                'how much I do this, there is still something enormously impressive about watching an AI review 35,000 lines ' +\n                'of code and then make high quality suggestions about how to improve it within 15 seconds!'\n            ),\n            h('figure', {},\n                h('img', {\n                    src: '/blog/000009-Initial-thoughts-on-Google-Gemini-25/gemini.webp',\n                    alt: 'Gemini offers thoughts on the design of Humbug.',\n                    width: 1024,\n                    height: 'auto'\n                })\n            )\n        )\n    ];\n}\n\nexport const blogPost_000009 = new BlogPost(\n    'Initial thoughts on Google Gemini 2.5',\n    'Dave Hudson',\n    '2025-03-28',\n    '/blog/000009-Initial-thoughts-on-Google-Gemini-25',\n    'An initial comparison of Google Gemini 2.5 Pro with Claude Sonnet 3.7 for code refactoring tasks.',\n    '/blog/000009-Initial-thoughts-on-Google-Gemini-25/gemini.webp',\n    blogArticle_000009\n);\n",
          "error": null
        }
      ]
    },
    {
      "id": "dcd8e98c-4f0a-46df-9621-2424146b7ddc",
      "timestamp": "2025-07-27T12:51:30.002079+00:00",
      "type": "user_message",
      "content": "",
      "completed": true,
      "tool_results": [
        {
          "id": "call_0",
          "name": "filesystem",
          "content": "File: m6r.ai/000009-Initial-thoughts-on-Google-Gemini-25/post.ts\nSize: 4,054 bytes\nEncoding: utf-8\n\nimport {h, VElement} from '../../lib/dvdi';\nimport {BlogPost} from '../BlogPost';\n\nfunction blogArticle_000009(): VElement[] {\n    return [\n        h('p', {},\n            'I was interested to see what Google Gemini 2.5 pro could do, compared with Claude Sonnet 3.7. ' +\n            'Claude has been my go-to model for months now.'\n        ),\n        h('section', {},\n            h('h2', {}, 'The good'),\n            h('ul', {},\n                h('li', {},\n                    'Gemini can handle a very large context - my 35k lines of python required less than 35% of the ' +\n                    'available context window. Google continue to win hands down on this as Claude can only get to ' +\n                    'just over 20k lines of code before it hits its limits.'\n                ),\n                h('li', {},\n                    'I asked it to find opportunities to refactor my code and it found quite a few (I knew about most ' +\n                    'of them already). Its suggestions all looked architecturally sound.'\n                ),\n                h('li', {},\n                    'It can clearly generate very large amounts of software (and it seems to be high quality), including ' +\n                    'breaking things into file-sized chunks to make things easy to work with.'\n                ),\n                h('li', {}, 'Gemini is very fast at generating code.'),\n                h('li', {}, 'You can try it for free as Google offer a free API tier!')\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'The not-so-good'),\n            h('ul', {},\n                h('li', {},\n                    'Despite quite a lot of discussion it was very hard to get Gemini to not try and do other things ' +\n                    'while it was doing the refactoring problem I asked it to try.'\n                ),\n                h('li', {},\n                    'Even after I got it to stop adding pointless comments it insisted on \"helpfully\" doing unrelated ' +\n                    'things. To be fair, it picked up and fixed a couple of bugs, corrected some type hinting issues, ' +\n                    'and fixed some comments that were incorrect, but I\\'d asked it not to touch anything that wasn\\'t ' +\n                    'directly related to my change. A big part of engineering process is to change one thing at a time, ' +\n                    'so I\\'d be happy if it told me about issues it found, but silently changing code is frustrating.'\n                ),\n                h('li', {}, 'I fairly quickly hit the \"requests-per-day\" limit.')\n            )\n        ),\n        h('section', {},\n            h('p', {},\n                'On balance I\\'m pretty impressed. It\\'s dramatically better than earlier Google models, but I\\'m not ' +\n                'trading in Claude for doing implementation work just yet. Claude is just that bit better at doing what it\\'s asked.'\n            ),\n            h('p', {},\n                'With that said, I can now see me regularly using Gemini 2.5 to help me plan work for Claude. No matter ' +\n                'how much I do this, there is still something enormously impressive about watching an AI review 35,000 lines ' +\n                'of code and then make high quality suggestions about how to improve it within 15 seconds!'\n            ),\n            h('figure', {},\n                h('img', {\n                    src: '/blog/000009-Initial-thoughts-on-Google-Gemini-25/gemini.webp',\n                    alt: 'Gemini offers thoughts on the design of Humbug.',\n                    width: 1024,\n                    height: 'auto'\n                })\n            )\n        )\n    ];\n}\n\nexport const blogPost_000009 = new BlogPost(\n    'Initial thoughts on Google Gemini 2.5',\n    'Dave Hudson',\n    '2025-03-28',\n    '/blog/000009-Initial-thoughts-on-Google-Gemini-25',\n    'An initial comparison of Google Gemini 2.5 Pro with Claude Sonnet 3.7 for code refactoring tasks.',\n    '/blog/000009-Initial-thoughts-on-Google-Gemini-25/gemini.webp',\n    blogArticle_000009\n);\n",
          "error": null
        }
      ]
    },
    {
      "id": "8593257e-b7ba-4eae-9f16-19c7909029a7",
      "timestamp": "2025-07-27T12:51:31.143567+00:00",
      "type": "ai_response",
      "content": "",
      "completed": true,
      "model": "gemini-1.5-flash",
      "reasoning_capability": 1,
      "temperature": 0.7,
      "tool_calls": [
        {
          "id": "call_0",
          "name": "filesystem",
          "arguments": {
            "operation": "read_file",
            "path": "m6r.ai/000010-The-importance-of-context-in-AI-assisted-coding/post.ts"
          }
        }
      ]
    },
    {
      "id": "a7a89ebf-fd10-4ca0-8195-b577d1a2173f",
      "timestamp": "2025-07-27T12:51:31.149709+00:00",
      "type": "tool_call",
      "content": "```json\n{\n    \"id\": \"call_0\",\n    \"name\": \"filesystem\",\n    \"arguments\": {\n        \"operation\": \"read_file\",\n        \"path\": \"m6r.ai/000010-The-importance-of-context-in-AI-assisted-coding/post.ts\"\n    }\n}\n```",
      "completed": true,
      "tool_calls": [
        {
          "id": "call_0",
          "name": "filesystem",
          "arguments": {
            "operation": "read_file",
            "path": "m6r.ai/000010-The-importance-of-context-in-AI-assisted-coding/post.ts"
          }
        }
      ]
    },
    {
      "id": "921b592c-0b51-4f78-b5e4-daf273b5e244",
      "timestamp": "2025-07-27T12:51:31.160560+00:00",
      "type": "tool_result",
      "content": "```json\n{\n    \"id\": \"call_0\",\n    \"name\": \"filesystem\",\n    \"content\": \"File: m6r.ai/000010-The-importance-of-context-in-AI-assisted-coding/post.ts\\nSize: 16,955 bytes\\nEncoding: utf-8\\n\\nimport {h, VElement} from '../../lib/dvdi';\\nimport {BlogPost} from '../BlogPost';\\n\\nfunction blogArticle_000010(): VElement[] {\\n    return [\\n        h('p', {},\\n            'AI tools like Claude, GitHub Copilot, and ChatGPT have rapidly become essential companions for developers. ' +\\n            'Yet many experienced engineers find themselves frustrated when these powerful assistants produce code that ' +\\n            'misses the mark.'\\n        ),\\n        h('p', {},\\n            'While there may be many nuanced reasons for this, they often come down to a single core problem: AI ' +\\n            'assistants need comprehensive context, just like human programmers do.'\\n        ),\\n        h('p', {},\\n            'If you were onboarding a new developer to your team, you wouldn\\\\'t simply say \\\"build a login page\\\" and walk ' +\\n            'away. You\\\\'d provide project documentation, explain design patterns, discuss user requirements, outline ' +\\n            'technical constraints, and explain your testing strategy. These are all things your new colleague would ' +\\n            'need to be set up for success.'\\n        ),\\n        h('p', {},\\n            'AI requires this same level of context to deliver truly valuable code.'\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'Why context matters'),\\n            h('p', {},\\n                'AIs have a wealth of generic training, but this can actually make things worse if you are unclear about your ' +\\n                'needs. They might know 50 ways to fulfil a generic-sounding request and 49 of those won\\\\'t be the one you ' +\\n                'wanted.'\\n            ),\\n            h('p', {},\\n                'With AI\\\\'s incredible capabilities, it\\\\'s easy to forget they can\\\\'t do some things human engineers would do. ' +\\n                'They don\\\\'t start out with any understanding of your unique project. Unlike human team members who build ' +\\n                'shared understanding through daily collaboration, AI doesn\\\\'t do this. It has no inherent knowledge of your ' +\\n                'application\\\\'s purpose, architecture decisions, or business requirements.'\\n            ),\\n            h('p', {},\\n                'This can be deeply frustrating, especially where some of those elements we co-developed with AI. ' +\\n                'You want to scream at it \\\"Why are you doing this wrong?  You literally only helped me do it right 10 minutes ' +\\n                'ago.\\\"'\\n            ),\\n            h('p', {},\\n                'Ironically, we\\\\'re probably quite familiar with this sort of behaviour from movies like Groundhog Day where most ' +\\n                'of the characters have no idea what they did on each previous version of the same day!'\\n            ),\\n            h('p', {},\\n                'When we provide only minimal context, AI models make assumptions to fill any gaps. These assumptions often ' +\\n                'lead to code that fails to integrate properly with your existing systems, overlooks critical edge cases, or ' +\\n                'ignores performance considerations essential to your application.'\\n            ),\\n            h('p', {},\\n                'To make matters worse, while people naturally ask clarifying questions when information is missing, AI ' +\\n                'assistants rarely do, unless you ask them to. The responsibility falls on us to provide ' +\\n                'comprehensive context upfront.'\\n            ),\\n            h('p', {},\\n                'The quality of code an AI produces is directly proportional to the quality of context it receives: garbage in, ' +\\n                'garbage out. Or, perhaps in this instance: vagueness in, vagueness out.'\\n            )\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'Elements of good context'),\\n            h('p', {},\\n                'If we\\\\'re clear about what we want to do, it\\\\'s amazing how much more focused our AI assistants can be. ' +\\n                'One favourite approach I have is to present an AI with all the context I believe it needs, but instead of asking ' +\\n                'it to build software, I ask it \\\"what\\\\'s unclear, contradictory, or ambiguous, in the information I have just ' +\\n                'given you?\\\" The results are often very illuminating!'\\n            ),\\n            h('p', {},\\n                'I was going to write about what I\\\\'ve learned about providing good context, but I realized most of that ' +\\n                'had come by asking various AI models what they would need to know. Instead, I asked Claude what it would say ' +\\n                'to you on this subject (having given it the context of what this article is about). It\\\\'s reply mirrored the one ' +\\n                'I was going to write, but is probably more eloquent, and it\\\\'s a great checklist:'\\n            ),\\n            h('blockquote', {},\\n                h('p', {},\\n                    h('strong', {}, 'Project background and goals'),\\n                    ' provide the \\\"why\\\" behind the code. Explaining your application\\\\'s purpose, ' +\\n                    'target users, and how this particular code fits into the larger system helps the AI understand the ' +\\n                    'importance of certain features or trade-offs. For example, knowing that code will run in a time-critical ' +\\n                    'medical application signals different priorities than code for an internal admin dashboard.'\\n                ),\\n                h('p', {},\\n                    h('strong', {}, 'Technical constraints'),\\n                    ' establish the boundaries within which solutions must operate. Specifying your ' +\\n                    'programming language version, frameworks, libraries, and deployment environment ensures compatibility. ' +\\n                    'If you\\\\'re working with React 18 and TypeScript in a serverless environment, the AI needs to know this to ' +\\n                    'provide appropriate recommendations.'\\n                ),\\n                h('p', {},\\n                    h('strong', {}, 'User requirements and edge cases'),\\n                    ' help the AI anticipate real-world usage. Detailing expected inputs ' +\\n                    'and outputs, error handling expectations, accessibility needs, and security requirements leads to more robust ' +\\n                    'code. If your form needs to handle international phone numbers or your API must respond within 200ms, these ' +\\n                    'specifications matter tremendously.'\\n                ),\\n                h('p', {},\\n                    h('strong', {}, 'Existing codebase structure'),\\n                    ' enables consistency with your established patterns. Sharing information about ' +\\n                    'file organization, naming conventions, design patterns, and API structures helps ensure the generated code ' +\\n                    'feels like a natural extension of what exists. This prevents the cognitive dissonance of having AI-generated ' +\\n                    'code that follows completely different conventions than the rest of your project.'\\n                ),\\n                h('p', {},\\n                    h('strong', {}, 'Performance considerations'),\\n                    ' guide optimization efforts. Being explicit about expected data volumes, ' +\\n                    'response time requirements, memory constraints, and scalability needs helps the AI make appropriate algorithmic ' +\\n                    'and architectural choices. The solution for processing a few records daily differs dramatically from one ' +\\n                    'handling millions of transactions per hour.'\\n                ),\\n                h('p', {},\\n                    h('strong', {}, 'Coding standards and style preferences'),\\n                    ' ensure maintainability. Clarifying your expectations around ' +\\n                    'formatting, documentation, testing, and code review criteria produces code that meets your quality standards. ' +\\n                    'This reduces the need for extensive rewrites and helps the generated code pass through your existing quality gates.'\\n                )\\n            ),\\n            h('p', {},\\n                'None of this should be too surprising when we think about it. It\\\\'s exactly the sort of contextual information we ' +\\n                'would provide another person.'\\n            ),\\n            h('p', {},\\n                'More from Claude:'\\n            ),\\n            h('blockquote', {},\\n                h('p', {},\\n                    'Developing the skill of providing effective context is crucial for productive AI collaboration. Several strategies ' +\\n                    'can help:'\\n                ),\\n                h('p', {},\\n                    h('strong', {}, 'Start with the \\\"why\\\" before the \\\"what\\\"'),\\n                    ' to orient the AI to your goals. Explaining the business or user ' +\\n                    'problem being solved provides crucial perspective. Instead of asking for \\\"a function to validate input,\\\" share that ' +\\n                    'you need \\\"a function to validate user-submitted addresses for a shipping label generator where accuracy is critical ' +\\n                    'for delivery success.\\\"'\\n                ),\\n                h('p', {},\\n                    h('strong', {}, 'Share relevant code snippets'),\\n                    ' from your existing codebase. These examples help the AI understand your ' +\\n                    'conventions and patterns. Showing how you\\\\'ve implemented similar components or how the new code will interact ' +\\n                    'with existing systems provides concrete guidance the AI can follow.'\\n                ),\\n                h('p', {},\\n                    h('strong', {}, 'Describe the problem from multiple angles'),\\n                    ' - technical, user experience, business value, and maintenance ' +\\n                    'perspectives. This multi-dimensional context helps the AI make appropriate trade-offs. For example, explaining ' +\\n                    'that a feature will be used by non-technical staff on potentially slow connections guides interface design choices.'\\n                ),\\n                h('p', {},\\n                    h('strong', {}, 'Specify your expertise level and what you need explained'),\\n                    '. If you\\\\'re learning a new technology, request ' +\\n                    'commented code with explanations. If you\\\\'re an expert seeking efficiency, ask for concise, optimized solutions. ' +\\n                    'This calibrates the AI\\\\'s response to your needs rather than receiving explanations you don\\\\'t need or missing ones ' +\\n                    'you do.'\\n                ),\\n                h('p', {},\\n                    h('strong', {}, 'Iterate on solutions with additional context.'),\\n                    ' AI collaboration works best as a conversation. Start with ' +\\n                    'your initial request, evaluate the response, then refine with additional details. Each iteration builds a richer ' +\\n                    'shared understanding, improving results with each cycle.'\\n                ),\\n                h('p', {},\\n                    h('strong', {}, 'Structure your context effectively'),\\n                    ' by organizing information into clear sections, putting critical details ' +\\n                    'first. Eliminate irrelevant information like organizational politics or historical decisions that no ' +\\n                    'longer affect the current implementation.'\\n                )\\n            ),\\n            h('p', {},\\n                'Having used variations on all these for the last 6 months, I can attest to their effectiveness.'\\n            )\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'More context please!'),\\n            h('p', {},\\n                'Our AI tools only know what we tell them. The more specific and comprehensive our context, the more focused and ' +\\n                'helpful their responses become. While this article relates to coding, the principle applies to a wide range of AI ' +\\n                'interactions.'\\n            ),\\n            h('p', {},\\n                'In my own experience, providing rich context has transformed my results with AI-assisted coding. In the last few ' +\\n                'months, I\\\\'ve seen detailed context enable AIs to refactor thousands of lines of code or add complex new features. ' +\\n                'When the results aren\\\\'t quite right, I\\\\'ve learned the problem usually lies in the context I provided. Fix that, ' +\\n                'and everything improves.'\\n            ),\\n            h('p', {},\\n                'I have seen a lot of great results, but here are some memorable ones:'\\n            ),\\n            h('ul', {},\\n                h('li', {}, 'Having AI help me iterate through 4 completely different designs for a terminal emulator in 15 days.'),\\n                h('li', {}, 'Building the entire search functionality for a complex development platform.'),\\n                h('li', {}, 'Harmonizing 2 completely different styles of lexers and parsers to use a new shared design.'),\\n                h('li', {}, 'Building an AI-powered log analysis tool.'),\\n                h('li', {}, 'Taking a large codebase and building new automated tests from manual testing scripts.')\\n            ),\\n            h('p', {},\\n                'The terminal emulator example also included a couple of very memorable 1000+ line refactors in which object classes ' +\\n                'were split and merged, but perhaps the most impressive change was watching an AI optimise the terminal rendering engine. ' +\\n                'In that instance it rewrote about 300 lines of code, implemented 5 major optimization strategies and gave a 6x performance ' +\\n                'improvement over something that actually worked quite well before!'\\n            ),\\n            h('p', {},\\n                'I\\\\'m not alone in this discovery. Recently, I\\\\'ve observed a growing community of developers achieving remarkable ' +\\n                'success with AI coding assistants. The common thread? They\\\\'ve all developed strategies for capturing and ' +\\n                'communicating context.'\\n            ),\\n            h('p', {},\\n                'The insight that context was crucial led to the original design of Metaphor. Metaphor is a language specifically ' +\\n                'desiged to help capture and organize this critical context information. The examples I mentioned earlier all ' +\\n                'relied on Metaphor and the Metaphor prompt compiler to capture and provide context to the AIs. You ' +\\n                'can find out more about Metaphor at ',\\n                h('a', {\\n                    href: 'https://m6r.ai/metaphor',\\n                    target: '_blank',\\n                    title: 'Learn more about Metaphor'\\n                }, 'https://m6r.ai/metaphor'),\\n                ' (it\\\\'s free and open source).'\\n            ),\\n            h('p', {},\\n                'I anticipate there will be developers reading this who may be inclined to say \\\"that\\\\'s great, but won\\\\'t this take ' +\\n                'a huge amount of time?\\\" It\\\\'s fair to say it does require some time and discipline, but in many cases the sort ' +\\n                'of information we\\\\'re talking about already exists in digital form (and yes, Metaphor makes this easy if you want ' +\\n                'to try it). It\\\\'s also an area where AI can help too. If you have a well structured format for your context, ' +\\n                'you can ask an AI to give you modifications to meet your needs. Importantly, however, if you invest time in ' +\\n                'providing context to allow an AI to deliver code dramatically faster and more reliably, the overall savings can be huge.'\\n            ),\\n            h('p', {},\\n                'Raw AI models possess incredible capabilities, but it\\\\'s the quality of context we provide that transforms them ' +\\n                'from generic tools into focused, high-performing development partners. Just as with human collaboration, the ' +\\n                'effort we put into clear communication directly determines the value we receive in return.'\\n            ),\\n            h('figure', {},\\n                h('img', {\\n                    src: '/blog/000010-The-importance-of-context-in-AI-assisted-coding/context.webp',\\n                    alt: 'An example of context described in Metaphor.',\\n                    width: 1024,\\n                    height: 'auto'\\n                })\\n             )\\n        )\\n    ];\\n}\\n\\nexport const blogPost_000010 = new BlogPost(\\n    'The importance of context in AI-assisted coding',\\n    'Dave Hudson',\\n    '2025-04-04',\\n    '/blog/000010-The-importance-of-context-in-AI-assisted-coding',\\n    'Why providing comprehensive context is crucial for effective AI-assisted coding and how to do it well.',\\n    '/blog/000010-The-importance-of-context-in-AI-assisted-coding/context.webp',\\n    blogArticle_000010\\n);\\n\",\n    \"error\": null\n}\n```",
      "completed": true,
      "tool_results": [
        {
          "id": "call_0",
          "name": "filesystem",
          "content": "File: m6r.ai/000010-The-importance-of-context-in-AI-assisted-coding/post.ts\nSize: 16,955 bytes\nEncoding: utf-8\n\nimport {h, VElement} from '../../lib/dvdi';\nimport {BlogPost} from '../BlogPost';\n\nfunction blogArticle_000010(): VElement[] {\n    return [\n        h('p', {},\n            'AI tools like Claude, GitHub Copilot, and ChatGPT have rapidly become essential companions for developers. ' +\n            'Yet many experienced engineers find themselves frustrated when these powerful assistants produce code that ' +\n            'misses the mark.'\n        ),\n        h('p', {},\n            'While there may be many nuanced reasons for this, they often come down to a single core problem: AI ' +\n            'assistants need comprehensive context, just like human programmers do.'\n        ),\n        h('p', {},\n            'If you were onboarding a new developer to your team, you wouldn\\'t simply say \"build a login page\" and walk ' +\n            'away. You\\'d provide project documentation, explain design patterns, discuss user requirements, outline ' +\n            'technical constraints, and explain your testing strategy. These are all things your new colleague would ' +\n            'need to be set up for success.'\n        ),\n        h('p', {},\n            'AI requires this same level of context to deliver truly valuable code.'\n        ),\n        h('section', {},\n            h('h2', {}, 'Why context matters'),\n            h('p', {},\n                'AIs have a wealth of generic training, but this can actually make things worse if you are unclear about your ' +\n                'needs. They might know 50 ways to fulfil a generic-sounding request and 49 of those won\\'t be the one you ' +\n                'wanted.'\n            ),\n            h('p', {},\n                'With AI\\'s incredible capabilities, it\\'s easy to forget they can\\'t do some things human engineers would do. ' +\n                'They don\\'t start out with any understanding of your unique project. Unlike human team members who build ' +\n                'shared understanding through daily collaboration, AI doesn\\'t do this. It has no inherent knowledge of your ' +\n                'application\\'s purpose, architecture decisions, or business requirements.'\n            ),\n            h('p', {},\n                'This can be deeply frustrating, especially where some of those elements we co-developed with AI. ' +\n                'You want to scream at it \"Why are you doing this wrong?  You literally only helped me do it right 10 minutes ' +\n                'ago.\"'\n            ),\n            h('p', {},\n                'Ironically, we\\'re probably quite familiar with this sort of behaviour from movies like Groundhog Day where most ' +\n                'of the characters have no idea what they did on each previous version of the same day!'\n            ),\n            h('p', {},\n                'When we provide only minimal context, AI models make assumptions to fill any gaps. These assumptions often ' +\n                'lead to code that fails to integrate properly with your existing systems, overlooks critical edge cases, or ' +\n                'ignores performance considerations essential to your application.'\n            ),\n            h('p', {},\n                'To make matters worse, while people naturally ask clarifying questions when information is missing, AI ' +\n                'assistants rarely do, unless you ask them to. The responsibility falls on us to provide ' +\n                'comprehensive context upfront.'\n            ),\n            h('p', {},\n                'The quality of code an AI produces is directly proportional to the quality of context it receives: garbage in, ' +\n                'garbage out. Or, perhaps in this instance: vagueness in, vagueness out.'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'Elements of good context'),\n            h('p', {},\n                'If we\\'re clear about what we want to do, it\\'s amazing how much more focused our AI assistants can be. ' +\n                'One favourite approach I have is to present an AI with all the context I believe it needs, but instead of asking ' +\n                'it to build software, I ask it \"what\\'s unclear, contradictory, or ambiguous, in the information I have just ' +\n                'given you?\" The results are often very illuminating!'\n            ),\n            h('p', {},\n                'I was going to write about what I\\'ve learned about providing good context, but I realized most of that ' +\n                'had come by asking various AI models what they would need to know. Instead, I asked Claude what it would say ' +\n                'to you on this subject (having given it the context of what this article is about). It\\'s reply mirrored the one ' +\n                'I was going to write, but is probably more eloquent, and it\\'s a great checklist:'\n            ),\n            h('blockquote', {},\n                h('p', {},\n                    h('strong', {}, 'Project background and goals'),\n                    ' provide the \"why\" behind the code. Explaining your application\\'s purpose, ' +\n                    'target users, and how this particular code fits into the larger system helps the AI understand the ' +\n                    'importance of certain features or trade-offs. For example, knowing that code will run in a time-critical ' +\n                    'medical application signals different priorities than code for an internal admin dashboard.'\n                ),\n                h('p', {},\n                    h('strong', {}, 'Technical constraints'),\n                    ' establish the boundaries within which solutions must operate. Specifying your ' +\n                    'programming language version, frameworks, libraries, and deployment environment ensures compatibility. ' +\n                    'If you\\'re working with React 18 and TypeScript in a serverless environment, the AI needs to know this to ' +\n                    'provide appropriate recommendations.'\n                ),\n                h('p', {},\n                    h('strong', {}, 'User requirements and edge cases'),\n                    ' help the AI anticipate real-world usage. Detailing expected inputs ' +\n                    'and outputs, error handling expectations, accessibility needs, and security requirements leads to more robust ' +\n                    'code. If your form needs to handle international phone numbers or your API must respond within 200ms, these ' +\n                    'specifications matter tremendously.'\n                ),\n                h('p', {},\n                    h('strong', {}, 'Existing codebase structure'),\n                    ' enables consistency with your established patterns. Sharing information about ' +\n                    'file organization, naming conventions, design patterns, and API structures helps ensure the generated code ' +\n                    'feels like a natural extension of what exists. This prevents the cognitive dissonance of having AI-generated ' +\n                    'code that follows completely different conventions than the rest of your project.'\n                ),\n                h('p', {},\n                    h('strong', {}, 'Performance considerations'),\n                    ' guide optimization efforts. Being explicit about expected data volumes, ' +\n                    'response time requirements, memory constraints, and scalability needs helps the AI make appropriate algorithmic ' +\n                    'and architectural choices. The solution for processing a few records daily differs dramatically from one ' +\n                    'handling millions of transactions per hour.'\n                ),\n                h('p', {},\n                    h('strong', {}, 'Coding standards and style preferences'),\n                    ' ensure maintainability. Clarifying your expectations around ' +\n                    'formatting, documentation, testing, and code review criteria produces code that meets your quality standards. ' +\n                    'This reduces the need for extensive rewrites and helps the generated code pass through your existing quality gates.'\n                )\n            ),\n            h('p', {},\n                'None of this should be too surprising when we think about it. It\\'s exactly the sort of contextual information we ' +\n                'would provide another person.'\n            ),\n            h('p', {},\n                'More from Claude:'\n            ),\n            h('blockquote', {},\n                h('p', {},\n                    'Developing the skill of providing effective context is crucial for productive AI collaboration. Several strategies ' +\n                    'can help:'\n                ),\n                h('p', {},\n                    h('strong', {}, 'Start with the \"why\" before the \"what\"'),\n                    ' to orient the AI to your goals. Explaining the business or user ' +\n                    'problem being solved provides crucial perspective. Instead of asking for \"a function to validate input,\" share that ' +\n                    'you need \"a function to validate user-submitted addresses for a shipping label generator where accuracy is critical ' +\n                    'for delivery success.\"'\n                ),\n                h('p', {},\n                    h('strong', {}, 'Share relevant code snippets'),\n                    ' from your existing codebase. These examples help the AI understand your ' +\n                    'conventions and patterns. Showing how you\\'ve implemented similar components or how the new code will interact ' +\n                    'with existing systems provides concrete guidance the AI can follow.'\n                ),\n                h('p', {},\n                    h('strong', {}, 'Describe the problem from multiple angles'),\n                    ' - technical, user experience, business value, and maintenance ' +\n                    'perspectives. This multi-dimensional context helps the AI make appropriate trade-offs. For example, explaining ' +\n                    'that a feature will be used by non-technical staff on potentially slow connections guides interface design choices.'\n                ),\n                h('p', {},\n                    h('strong', {}, 'Specify your expertise level and what you need explained'),\n                    '. If you\\'re learning a new technology, request ' +\n                    'commented code with explanations. If you\\'re an expert seeking efficiency, ask for concise, optimized solutions. ' +\n                    'This calibrates the AI\\'s response to your needs rather than receiving explanations you don\\'t need or missing ones ' +\n                    'you do.'\n                ),\n                h('p', {},\n                    h('strong', {}, 'Iterate on solutions with additional context.'),\n                    ' AI collaboration works best as a conversation. Start with ' +\n                    'your initial request, evaluate the response, then refine with additional details. Each iteration builds a richer ' +\n                    'shared understanding, improving results with each cycle.'\n                ),\n                h('p', {},\n                    h('strong', {}, 'Structure your context effectively'),\n                    ' by organizing information into clear sections, putting critical details ' +\n                    'first. Eliminate irrelevant information like organizational politics or historical decisions that no ' +\n                    'longer affect the current implementation.'\n                )\n            ),\n            h('p', {},\n                'Having used variations on all these for the last 6 months, I can attest to their effectiveness.'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'More context please!'),\n            h('p', {},\n                'Our AI tools only know what we tell them. The more specific and comprehensive our context, the more focused and ' +\n                'helpful their responses become. While this article relates to coding, the principle applies to a wide range of AI ' +\n                'interactions.'\n            ),\n            h('p', {},\n                'In my own experience, providing rich context has transformed my results with AI-assisted coding. In the last few ' +\n                'months, I\\'ve seen detailed context enable AIs to refactor thousands of lines of code or add complex new features. ' +\n                'When the results aren\\'t quite right, I\\'ve learned the problem usually lies in the context I provided. Fix that, ' +\n                'and everything improves.'\n            ),\n            h('p', {},\n                'I have seen a lot of great results, but here are some memorable ones:'\n            ),\n            h('ul', {},\n                h('li', {}, 'Having AI help me iterate through 4 completely different designs for a terminal emulator in 15 days.'),\n                h('li', {}, 'Building the entire search functionality for a complex development platform.'),\n                h('li', {}, 'Harmonizing 2 completely different styles of lexers and parsers to use a new shared design.'),\n                h('li', {}, 'Building an AI-powered log analysis tool.'),\n                h('li', {}, 'Taking a large codebase and building new automated tests from manual testing scripts.')\n            ),\n            h('p', {},\n                'The terminal emulator example also included a couple of very memorable 1000+ line refactors in which object classes ' +\n                'were split and merged, but perhaps the most impressive change was watching an AI optimise the terminal rendering engine. ' +\n                'In that instance it rewrote about 300 lines of code, implemented 5 major optimization strategies and gave a 6x performance ' +\n                'improvement over something that actually worked quite well before!'\n            ),\n            h('p', {},\n                'I\\'m not alone in this discovery. Recently, I\\'ve observed a growing community of developers achieving remarkable ' +\n                'success with AI coding assistants. The common thread? They\\'ve all developed strategies for capturing and ' +\n                'communicating context.'\n            ),\n            h('p', {},\n                'The insight that context was crucial led to the original design of Metaphor. Metaphor is a language specifically ' +\n                'desiged to help capture and organize this critical context information. The examples I mentioned earlier all ' +\n                'relied on Metaphor and the Metaphor prompt compiler to capture and provide context to the AIs. You ' +\n                'can find out more about Metaphor at ',\n                h('a', {\n                    href: 'https://m6r.ai/metaphor',\n                    target: '_blank',\n                    title: 'Learn more about Metaphor'\n                }, 'https://m6r.ai/metaphor'),\n                ' (it\\'s free and open source).'\n            ),\n            h('p', {},\n                'I anticipate there will be developers reading this who may be inclined to say \"that\\'s great, but won\\'t this take ' +\n                'a huge amount of time?\" It\\'s fair to say it does require some time and discipline, but in many cases the sort ' +\n                'of information we\\'re talking about already exists in digital form (and yes, Metaphor makes this easy if you want ' +\n                'to try it). It\\'s also an area where AI can help too. If you have a well structured format for your context, ' +\n                'you can ask an AI to give you modifications to meet your needs. Importantly, however, if you invest time in ' +\n                'providing context to allow an AI to deliver code dramatically faster and more reliably, the overall savings can be huge.'\n            ),\n            h('p', {},\n                'Raw AI models possess incredible capabilities, but it\\'s the quality of context we provide that transforms them ' +\n                'from generic tools into focused, high-performing development partners. Just as with human collaboration, the ' +\n                'effort we put into clear communication directly determines the value we receive in return.'\n            ),\n            h('figure', {},\n                h('img', {\n                    src: '/blog/000010-The-importance-of-context-in-AI-assisted-coding/context.webp',\n                    alt: 'An example of context described in Metaphor.',\n                    width: 1024,\n                    height: 'auto'\n                })\n             )\n        )\n    ];\n}\n\nexport const blogPost_000010 = new BlogPost(\n    'The importance of context in AI-assisted coding',\n    'Dave Hudson',\n    '2025-04-04',\n    '/blog/000010-The-importance-of-context-in-AI-assisted-coding',\n    'Why providing comprehensive context is crucial for effective AI-assisted coding and how to do it well.',\n    '/blog/000010-The-importance-of-context-in-AI-assisted-coding/context.webp',\n    blogArticle_000010\n);\n",
          "error": null
        }
      ]
    },
    {
      "id": "8b47cfad-6819-466d-9316-bcb1646e937a",
      "timestamp": "2025-07-27T12:51:31.173440+00:00",
      "type": "user_message",
      "content": "",
      "completed": true,
      "tool_results": [
        {
          "id": "call_0",
          "name": "filesystem",
          "content": "File: m6r.ai/000010-The-importance-of-context-in-AI-assisted-coding/post.ts\nSize: 16,955 bytes\nEncoding: utf-8\n\nimport {h, VElement} from '../../lib/dvdi';\nimport {BlogPost} from '../BlogPost';\n\nfunction blogArticle_000010(): VElement[] {\n    return [\n        h('p', {},\n            'AI tools like Claude, GitHub Copilot, and ChatGPT have rapidly become essential companions for developers. ' +\n            'Yet many experienced engineers find themselves frustrated when these powerful assistants produce code that ' +\n            'misses the mark.'\n        ),\n        h('p', {},\n            'While there may be many nuanced reasons for this, they often come down to a single core problem: AI ' +\n            'assistants need comprehensive context, just like human programmers do.'\n        ),\n        h('p', {},\n            'If you were onboarding a new developer to your team, you wouldn\\'t simply say \"build a login page\" and walk ' +\n            'away. You\\'d provide project documentation, explain design patterns, discuss user requirements, outline ' +\n            'technical constraints, and explain your testing strategy. These are all things your new colleague would ' +\n            'need to be set up for success.'\n        ),\n        h('p', {},\n            'AI requires this same level of context to deliver truly valuable code.'\n        ),\n        h('section', {},\n            h('h2', {}, 'Why context matters'),\n            h('p', {},\n                'AIs have a wealth of generic training, but this can actually make things worse if you are unclear about your ' +\n                'needs. They might know 50 ways to fulfil a generic-sounding request and 49 of those won\\'t be the one you ' +\n                'wanted.'\n            ),\n            h('p', {},\n                'With AI\\'s incredible capabilities, it\\'s easy to forget they can\\'t do some things human engineers would do. ' +\n                'They don\\'t start out with any understanding of your unique project. Unlike human team members who build ' +\n                'shared understanding through daily collaboration, AI doesn\\'t do this. It has no inherent knowledge of your ' +\n                'application\\'s purpose, architecture decisions, or business requirements.'\n            ),\n            h('p', {},\n                'This can be deeply frustrating, especially where some of those elements we co-developed with AI. ' +\n                'You want to scream at it \"Why are you doing this wrong?  You literally only helped me do it right 10 minutes ' +\n                'ago.\"'\n            ),\n            h('p', {},\n                'Ironically, we\\'re probably quite familiar with this sort of behaviour from movies like Groundhog Day where most ' +\n                'of the characters have no idea what they did on each previous version of the same day!'\n            ),\n            h('p', {},\n                'When we provide only minimal context, AI models make assumptions to fill any gaps. These assumptions often ' +\n                'lead to code that fails to integrate properly with your existing systems, overlooks critical edge cases, or ' +\n                'ignores performance considerations essential to your application.'\n            ),\n            h('p', {},\n                'To make matters worse, while people naturally ask clarifying questions when information is missing, AI ' +\n                'assistants rarely do, unless you ask them to. The responsibility falls on us to provide ' +\n                'comprehensive context upfront.'\n            ),\n            h('p', {},\n                'The quality of code an AI produces is directly proportional to the quality of context it receives: garbage in, ' +\n                'garbage out. Or, perhaps in this instance: vagueness in, vagueness out.'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'Elements of good context'),\n            h('p', {},\n                'If we\\'re clear about what we want to do, it\\'s amazing how much more focused our AI assistants can be. ' +\n                'One favourite approach I have is to present an AI with all the context I believe it needs, but instead of asking ' +\n                'it to build software, I ask it \"what\\'s unclear, contradictory, or ambiguous, in the information I have just ' +\n                'given you?\" The results are often very illuminating!'\n            ),\n            h('p', {},\n                'I was going to write about what I\\'ve learned about providing good context, but I realized most of that ' +\n                'had come by asking various AI models what they would need to know. Instead, I asked Claude what it would say ' +\n                'to you on this subject (having given it the context of what this article is about). It\\'s reply mirrored the one ' +\n                'I was going to write, but is probably more eloquent, and it\\'s a great checklist:'\n            ),\n            h('blockquote', {},\n                h('p', {},\n                    h('strong', {}, 'Project background and goals'),\n                    ' provide the \"why\" behind the code. Explaining your application\\'s purpose, ' +\n                    'target users, and how this particular code fits into the larger system helps the AI understand the ' +\n                    'importance of certain features or trade-offs. For example, knowing that code will run in a time-critical ' +\n                    'medical application signals different priorities than code for an internal admin dashboard.'\n                ),\n                h('p', {},\n                    h('strong', {}, 'Technical constraints'),\n                    ' establish the boundaries within which solutions must operate. Specifying your ' +\n                    'programming language version, frameworks, libraries, and deployment environment ensures compatibility. ' +\n                    'If you\\'re working with React 18 and TypeScript in a serverless environment, the AI needs to know this to ' +\n                    'provide appropriate recommendations.'\n                ),\n                h('p', {},\n                    h('strong', {}, 'User requirements and edge cases'),\n                    ' help the AI anticipate real-world usage. Detailing expected inputs ' +\n                    'and outputs, error handling expectations, accessibility needs, and security requirements leads to more robust ' +\n                    'code. If your form needs to handle international phone numbers or your API must respond within 200ms, these ' +\n                    'specifications matter tremendously.'\n                ),\n                h('p', {},\n                    h('strong', {}, 'Existing codebase structure'),\n                    ' enables consistency with your established patterns. Sharing information about ' +\n                    'file organization, naming conventions, design patterns, and API structures helps ensure the generated code ' +\n                    'feels like a natural extension of what exists. This prevents the cognitive dissonance of having AI-generated ' +\n                    'code that follows completely different conventions than the rest of your project.'\n                ),\n                h('p', {},\n                    h('strong', {}, 'Performance considerations'),\n                    ' guide optimization efforts. Being explicit about expected data volumes, ' +\n                    'response time requirements, memory constraints, and scalability needs helps the AI make appropriate algorithmic ' +\n                    'and architectural choices. The solution for processing a few records daily differs dramatically from one ' +\n                    'handling millions of transactions per hour.'\n                ),\n                h('p', {},\n                    h('strong', {}, 'Coding standards and style preferences'),\n                    ' ensure maintainability. Clarifying your expectations around ' +\n                    'formatting, documentation, testing, and code review criteria produces code that meets your quality standards. ' +\n                    'This reduces the need for extensive rewrites and helps the generated code pass through your existing quality gates.'\n                )\n            ),\n            h('p', {},\n                'None of this should be too surprising when we think about it. It\\'s exactly the sort of contextual information we ' +\n                'would provide another person.'\n            ),\n            h('p', {},\n                'More from Claude:'\n            ),\n            h('blockquote', {},\n                h('p', {},\n                    'Developing the skill of providing effective context is crucial for productive AI collaboration. Several strategies ' +\n                    'can help:'\n                ),\n                h('p', {},\n                    h('strong', {}, 'Start with the \"why\" before the \"what\"'),\n                    ' to orient the AI to your goals. Explaining the business or user ' +\n                    'problem being solved provides crucial perspective. Instead of asking for \"a function to validate input,\" share that ' +\n                    'you need \"a function to validate user-submitted addresses for a shipping label generator where accuracy is critical ' +\n                    'for delivery success.\"'\n                ),\n                h('p', {},\n                    h('strong', {}, 'Share relevant code snippets'),\n                    ' from your existing codebase. These examples help the AI understand your ' +\n                    'conventions and patterns. Showing how you\\'ve implemented similar components or how the new code will interact ' +\n                    'with existing systems provides concrete guidance the AI can follow.'\n                ),\n                h('p', {},\n                    h('strong', {}, 'Describe the problem from multiple angles'),\n                    ' - technical, user experience, business value, and maintenance ' +\n                    'perspectives. This multi-dimensional context helps the AI make appropriate trade-offs. For example, explaining ' +\n                    'that a feature will be used by non-technical staff on potentially slow connections guides interface design choices.'\n                ),\n                h('p', {},\n                    h('strong', {}, 'Specify your expertise level and what you need explained'),\n                    '. If you\\'re learning a new technology, request ' +\n                    'commented code with explanations. If you\\'re an expert seeking efficiency, ask for concise, optimized solutions. ' +\n                    'This calibrates the AI\\'s response to your needs rather than receiving explanations you don\\'t need or missing ones ' +\n                    'you do.'\n                ),\n                h('p', {},\n                    h('strong', {}, 'Iterate on solutions with additional context.'),\n                    ' AI collaboration works best as a conversation. Start with ' +\n                    'your initial request, evaluate the response, then refine with additional details. Each iteration builds a richer ' +\n                    'shared understanding, improving results with each cycle.'\n                ),\n                h('p', {},\n                    h('strong', {}, 'Structure your context effectively'),\n                    ' by organizing information into clear sections, putting critical details ' +\n                    'first. Eliminate irrelevant information like organizational politics or historical decisions that no ' +\n                    'longer affect the current implementation.'\n                )\n            ),\n            h('p', {},\n                'Having used variations on all these for the last 6 months, I can attest to their effectiveness.'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'More context please!'),\n            h('p', {},\n                'Our AI tools only know what we tell them. The more specific and comprehensive our context, the more focused and ' +\n                'helpful their responses become. While this article relates to coding, the principle applies to a wide range of AI ' +\n                'interactions.'\n            ),\n            h('p', {},\n                'In my own experience, providing rich context has transformed my results with AI-assisted coding. In the last few ' +\n                'months, I\\'ve seen detailed context enable AIs to refactor thousands of lines of code or add complex new features. ' +\n                'When the results aren\\'t quite right, I\\'ve learned the problem usually lies in the context I provided. Fix that, ' +\n                'and everything improves.'\n            ),\n            h('p', {},\n                'I have seen a lot of great results, but here are some memorable ones:'\n            ),\n            h('ul', {},\n                h('li', {}, 'Having AI help me iterate through 4 completely different designs for a terminal emulator in 15 days.'),\n                h('li', {}, 'Building the entire search functionality for a complex development platform.'),\n                h('li', {}, 'Harmonizing 2 completely different styles of lexers and parsers to use a new shared design.'),\n                h('li', {}, 'Building an AI-powered log analysis tool.'),\n                h('li', {}, 'Taking a large codebase and building new automated tests from manual testing scripts.')\n            ),\n            h('p', {},\n                'The terminal emulator example also included a couple of very memorable 1000+ line refactors in which object classes ' +\n                'were split and merged, but perhaps the most impressive change was watching an AI optimise the terminal rendering engine. ' +\n                'In that instance it rewrote about 300 lines of code, implemented 5 major optimization strategies and gave a 6x performance ' +\n                'improvement over something that actually worked quite well before!'\n            ),\n            h('p', {},\n                'I\\'m not alone in this discovery. Recently, I\\'ve observed a growing community of developers achieving remarkable ' +\n                'success with AI coding assistants. The common thread? They\\'ve all developed strategies for capturing and ' +\n                'communicating context.'\n            ),\n            h('p', {},\n                'The insight that context was crucial led to the original design of Metaphor. Metaphor is a language specifically ' +\n                'desiged to help capture and organize this critical context information. The examples I mentioned earlier all ' +\n                'relied on Metaphor and the Metaphor prompt compiler to capture and provide context to the AIs. You ' +\n                'can find out more about Metaphor at ',\n                h('a', {\n                    href: 'https://m6r.ai/metaphor',\n                    target: '_blank',\n                    title: 'Learn more about Metaphor'\n                }, 'https://m6r.ai/metaphor'),\n                ' (it\\'s free and open source).'\n            ),\n            h('p', {},\n                'I anticipate there will be developers reading this who may be inclined to say \"that\\'s great, but won\\'t this take ' +\n                'a huge amount of time?\" It\\'s fair to say it does require some time and discipline, but in many cases the sort ' +\n                'of information we\\'re talking about already exists in digital form (and yes, Metaphor makes this easy if you want ' +\n                'to try it). It\\'s also an area where AI can help too. If you have a well structured format for your context, ' +\n                'you can ask an AI to give you modifications to meet your needs. Importantly, however, if you invest time in ' +\n                'providing context to allow an AI to deliver code dramatically faster and more reliably, the overall savings can be huge.'\n            ),\n            h('p', {},\n                'Raw AI models possess incredible capabilities, but it\\'s the quality of context we provide that transforms them ' +\n                'from generic tools into focused, high-performing development partners. Just as with human collaboration, the ' +\n                'effort we put into clear communication directly determines the value we receive in return.'\n            ),\n            h('figure', {},\n                h('img', {\n                    src: '/blog/000010-The-importance-of-context-in-AI-assisted-coding/context.webp',\n                    alt: 'An example of context described in Metaphor.',\n                    width: 1024,\n                    height: 'auto'\n                })\n             )\n        )\n    ];\n}\n\nexport const blogPost_000010 = new BlogPost(\n    'The importance of context in AI-assisted coding',\n    'Dave Hudson',\n    '2025-04-04',\n    '/blog/000010-The-importance-of-context-in-AI-assisted-coding',\n    'Why providing comprehensive context is crucial for effective AI-assisted coding and how to do it well.',\n    '/blog/000010-The-importance-of-context-in-AI-assisted-coding/context.webp',\n    blogArticle_000010\n);\n",
          "error": null
        }
      ]
    },
    {
      "id": "2c3b2e12-b135-4367-9400-c4f58da61969",
      "timestamp": "2025-07-27T12:51:32.428186+00:00",
      "type": "ai_response",
      "content": "",
      "completed": true,
      "model": "gemini-1.5-flash",
      "reasoning_capability": 1,
      "temperature": 0.7,
      "tool_calls": [
        {
          "id": "call_0",
          "name": "filesystem",
          "arguments": {
            "operation": "read_file",
            "path": "m6r.ai/000011-Introducing-Metaphor-commands/post.ts"
          }
        }
      ]
    },
    {
      "id": "faeed0cd-4480-430f-aba1-659d7bd81ae0",
      "timestamp": "2025-07-27T12:51:32.438670+00:00",
      "type": "tool_call",
      "content": "```json\n{\n    \"id\": \"call_0\",\n    \"name\": \"filesystem\",\n    \"arguments\": {\n        \"operation\": \"read_file\",\n        \"path\": \"m6r.ai/000011-Introducing-Metaphor-commands/post.ts\"\n    }\n}\n```",
      "completed": true,
      "tool_calls": [
        {
          "id": "call_0",
          "name": "filesystem",
          "arguments": {
            "operation": "read_file",
            "path": "m6r.ai/000011-Introducing-Metaphor-commands/post.ts"
          }
        }
      ]
    },
    {
      "id": "8ae6754b-4344-488d-8c7c-7186f91707ca",
      "timestamp": "2025-07-27T12:51:32.452791+00:00",
      "type": "tool_result",
      "content": "```json\n{\n    \"id\": \"call_0\",\n    \"name\": \"filesystem\",\n    \"content\": \"File: m6r.ai/000011-Introducing-Metaphor-commands/post.ts\\nSize: 13,866 bytes\\nEncoding: utf-8\\n\\nimport {assertIsVElement, h, updateElement, VNode, VElement} from '../../lib/dvdi';\\nimport {BlogPost} from '../BlogPost';\\nimport {MetaphorParser} from '../../lib/syntax';\\nimport {highlight} from '../../lib/highlight';\\nimport {cloneObject} from '../../lib/cloneObject';\\nimport {navigateEvent} from '../../app';\\n\\nconst code: VNode[][] = [[], []];\\nlet codeVElement: (VElement | null)[] = [null, null];\\nconst codeFunction: (() => VElement)[] = [\\n    blogArticle_000011_ReviewCritic,\\n    blogArticle_000011_Introspection\\n];\\n\\n/**\\n * Callback to write the contents of the file load for code fragments.\\n * @param segment - The segment index to update\\n * @param content - The content to write\\n */\\nfunction writeCode(segment: number, content: VNode[]) {\\n    code[segment].push(...content);\\n    if (codeVElement[segment] === null) {\\n        return;\\n    }\\n\\n    assertIsVElement(codeVElement[segment]);\\n    if (codeVElement[segment].parentVNode === null) {\\n        return;\\n    }\\n\\n    const parentElem = (codeVElement[segment].parentVNode as VElement).domElement;\\n    if (parentElem === null) {\\n        return;\\n    }\\n\\n    if (codeVElement[segment].domElement === null) {\\n        return;\\n    }\\n\\n    const index = Array.from(parentElem.childNodes).indexOf(codeVElement[segment].domElement);\\n    const newVElement = codeFunction[segment]();\\n    newVElement.parentVNode = codeVElement[segment].parentVNode;\\n    updateElement(parentElem,\\n        parentElem.childNodes[index],\\n        codeVElement[segment].parentVNode as VElement,\\n        codeVElement[segment],\\n        newVElement\\n    );\\n    codeVElement[segment] = newVElement;\\n}\\n\\n/**\\n * Load Metaphor code file and prepare for highlighting\\n */\\nasync function loadFile(segment: number, filePath: string, storeFunction: (segment: number, content: VNode[]) => void) {\\n    try {\\n        const response = await fetch(filePath);\\n        if (!response.ok) {\\n            throw new Error(`Failed to fetch file: ${response.statusText}`);\\n        }\\n\\n        const content = await response.text();\\n        const formattedContent = highlight(content, MetaphorParser);\\n\\n        storeFunction(segment, formattedContent);\\n    } catch (error) {\\n        console.error('Error loading file:', error);\\n    }\\n}\\n\\n/**\\n * Function to handle the first Metaphor code block (commit-critic)\\n */\\nfunction blogArticle_000011_ReviewCritic(): VElement {\\n    let contents: VElement;\\n    if (code[0].length === 0) {\\n        contents = h('pre', {});\\n    } else {\\n        contents = h('pre', {}, h('code', {}, ...cloneObject(code[0])));\\n    }\\n\\n    contents.mountCallback = () => {\\n        codeVElement[0] = contents;\\n        if (code[0].length === 0) {\\n            loadFile(0, '/blog/000011-Introducing-Metaphor-commands/commit-critic.m6r', writeCode);\\n        }\\n    }\\n\\n    contents.unmountCallback = () => {\\n        codeVElement[0] = null;\\n    }\\n\\n    return contents;\\n}\\n\\n/**\\n * Function to handle the second Metaphor code block (introspection)\\n */\\nfunction blogArticle_000011_Introspection(): VElement {\\n    let contents: VElement;\\n    if (code[1].length === 0) {\\n        contents = h('pre', {});\\n    } else {\\n        contents = h('pre', {}, h('code', {}, ...cloneObject(code[1])));\\n    }\\n\\n    contents.mountCallback = () => {\\n        codeVElement[1] = contents;\\n        if (code[1].length === 0) {\\n            loadFile(1, '/blog/000011-Introducing-Metaphor-commands/introspection.m6r', writeCode);\\n        }\\n    }\\n\\n    contents.unmountCallback = () => {\\n        codeVElement[1] = null;\\n    }\\n\\n    return contents;\\n}\\n\\n/**\\n * Main function to generate the blog post content\\n */\\nfunction blogArticle_000011(): VElement[] {\\n    return [\\n        h('p', {},\\n            'The latest version of Humbug, v0.10, introduces the system shell.  This is an incredibly useful productivity ' +\\n            'feature that lets you use built-in commands to create conversation, editor, and terminal windows in a way ' +\\n            'that\\\\'s tricky to do from the GUI. The integration within Humbug, rather than making these regular command ' +\\n            'line tools, means they can invoke GUI features - useful in itself. The big unlock, however, lies with the ' +\\n            'updated ',\\n            h('code', {}, 'm6rc'),\\n            ' Metaphor compiler.'\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'Metaphor and the m6rc Metaphor compiler'),\\n            h('p', {},\\n                'Metaphor predates Humbug, and has been a part of the Humbug design since v0.1.  It allows you to define ' +\\n                'the role, detailed context, and action you require for your AI to do its work.  It also allows you to ' +\\n                'partition these elements into separate files and join them together and compile all the elements into a ' +\\n                'prompt using ',\\n                h('code', {}, 'm6rc'),\\n                '.'\\n            ),\\n            h('p', {},\\n                'This modular approach, familiar to software developers, allows you to independently maintain and version ' +\\n                'important Metaphor components, allowing them to be used across many projects and tasks. Equally, these ' +\\n                'components can be maintained by different teams allowing them to bring their unique expertise to bear.'\\n            ),\\n            h('p', {},\\n                'As with programming language compilers, ',\\n                h('code', {}, 'm6rc'),\\n                ' also gets to perform correctness checks on the Metaphor files it ' +\\n                'processes. This helps ensure the structure you present as a prompt will make sense to your AI models.'\\n            )\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'The v0.10 improvement'),\\n            h('p', {},\\n                'The ',\\n                h('code', {}, 'm6rc'),\\n                ' approach has been very powerful, but the user experience was a little awkward as you invariably ' +\\n                'had to edit one or more Metaphor source files each time you wanted to do something slightly different.  ' +\\n                'With v0.10 of Humbug it\\\\'s now possible to eliminate the major problem.'\\n            ),\\n            h('p', {},\\n                'The new compiler can take \\\"argument references\\\" in ',\\n                h('code', {}, 'Include'),\\n                ' and ',\\n                h('code', {}, 'Embed'),\\n                ' statements. These take the form of ', \\n                h('code', {}, '$<number>'),\\n                ' where ',\\n                h('code', {}, '<number>'),\\n                ' is the number of the positional command line argument passed to ',\\n                h('code', {}, 'm6rc'),\\n                '. That may sound a little odd, so here\\\\'s an example:'\\n            ),\\n            h('pre', {},\\n                h('code', {}, 'm6rc script.m6r -m gpt-4.1 cat.m6r dog.md')\\n            ),\\n            h('p', {},\\n                'Positional arguments are the ones that don\\\\'t have option flags (things starting with a ',\\n                h('code', {}, '-'),\\n                ') and their associated option values (if they have them). In this example, the option ',\\n                h('code', {}, '-m'),\\n                ' has an option value of ',\\n                h('code', {}, 'gpt-4.1'),\\n                ', since it specifies the AI model to be used, and ',\\n                h('code', {}, 'm6rc'),\\n                ' is our command. This leaves ',\\n                h('code', {}, 'script.m6r'),\\n                ', ',\\n                h('code', {}, 'cat.m6r'),\\n                ', and ',\\n                h('code', {}, 'dog.md'),\\n                ' as our 3 positional arguments.  By convention we start numbering them from 0, ',\\n                h('code', {}, 'script.m6r'),\\n                ' is argument 0, ',\\n                h('code', {}, 'cat'),\\n                ' is argument 1, and ',\\n                h('code', {}, 'dog'),\\n                ' is argument 2.'\\n            ),\\n            h('p', {},\\n                'If our ',\\n                h('code', {}, 'script.m6r'),\\n                ' file contains the statement: ',\\n                h('code', {}, 'Embed: $2'),\\n                ' then the compiler will replace ',\\n                h('code', {}, '$2'),\\n                ' with ',\\n                h('code', {}, 'dog.md'),\\n                ' and will try to embed a file called ',\\n                h('code', {}, 'dog.md'),\\n                ' into our compiled prompt. Similarly, if ',\\n                h('code', {}, 'script.m6r'),\\n                ' contains the statement ',\\n                h('code', {}, 'Include: $1'),\\n                ' then this will try to include another Metaphor file called ',\\n                h('code', {}, 'cat.m6r'), '.'\\n            ),\\n            h('p', {},\\n                'This very simple change makes it possible to define completely reusable AI-powered tools that need ' +\\n                'no changes to be used for different purposes.  We simply pass extra parameters on the ',\\n                h('code', {}, 'm6rc'),\\n                ' command line.'\\n            )\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'Revisiting commit-critic'),\\n            h('p', {},\\n                'Last year we introduced an example of a Metaphor-powered tool, ',\\n                h('a', {\\n                        href: '/blog/000005-commit-critic',\\n                        onclick: (e: MouseEvent) => navigateEvent(e, '/blog/000005-commit-critic')\\n                    },\\n                    'commit-critic'\\n                ),\\n                '. This is an AI-powered software code review tool.  To make this useful in November we had to build ' +\\n                'a custom command line tool that could handle the positional argument handling.  With Humbug v0.10 ' +\\n                'we no longer need to do this, instead allowing commit-critic\\\\'s functionality to be completely ' +\\n                'described in Metaphor!'\\n            ),\\n            h('p', {},\\n                'Here\\\\'s what a pure Metaphor version looks like:'\\n            ),\\n            h('figure', {},\\n                blogArticle_000011_ReviewCritic(),\\n                h('figcaption', {}, 'Metaphor code for the new commit-critic implementation')\\n            ),\\n            h('p', {},\\n                'If you\\\\'re a keen observer, you may notice this has an enhancement on the original tool.  ' +\\n                'This version ranks the importance of any issues it identifies to help you judge how serious ' +\\n                'any issues might be.'\\n            )\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'An introspection tool'),\\n            h('p', {},\\n                'Now you\\\\'ve seen how you can solve an earlier problem in a simpler way, let\\\\'s look at how you can ' +\\n                'solve a new problem.'\\n            ),\\n            h('p', {},\\n                'A common question people have asked about Humbug is \\\"how easy is it to have one AI review the work ' +\\n                'of another AI?\\\"  It turns out you can now solve this sort of problem quite easily with Humbug v0.10.'\\n            ),\\n            h('p', {},\\n                'Humbug has always supported ',\\n                h('code', {}, '.conv'),\\n                ' files. These are JSON files that hold details of the conversations you have with ' +\\n                'our AIs when using Humbug.  These are stored in the ',\\n                h('code', {}, 'conversations'),\\n                ' directory of any Humbug mindspace.'\\n            ),\\n            h('p', {},\\n                'The approach outlined here took about 5 minutes to write, so it\\\\'s not refined, but you can see ' +\\n                'the potential!'\\n            ),\\n            h('figure', {},\\n                blogArticle_000011_Introspection(),\\n                h('figcaption', {}, 'Metaphor code for the AI introspection tool')\\n            ),\\n            h('p', {},\\n                'Here\\\\'s a screenshot of codestral (one of the Mistral models) reviewing a design change Metaphor ' +\\n                'conversation I had with Claude Sonnet 3.7 about an aspect of the system shell design from a few days ago!'\\n            ),\\n            h('figure', {},\\n                h('img', {\\n                    src: '/blog/000011-Introducing-Metaphor-commands/introspection-screenshot.webp',\\n                    alt: 'Screenshot of codestral reviewing a Metaphor conversation',\\n                    width: 1024,\\n                    height: 'auto'\\n                })\\n            )\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'What do you want to build?'),\\n            h('p', {},\\n                'We\\\\'ve seen how ',\\n                h('code', {}, 'm6rc'),\\n                ' within the Humbug system shell can now enable you to build a whole series of new AI-powered tools. ' +\\n                'Couple this with the ability to now embed elements from previous conversations as well as other ' +\\n                'documents and source code and the possibilities are amazing.'\\n            ),\\n            h('p', {},\\n                'We\\\\'re excited to see what you will be able to build!'\\n            ),\\n            h('p', {},\\n                'If you want to share your ideas, join us on ',\\n                h('a', {href: 'https://discord.gg/GZhJ7ZtgwN', target: '_blank'}, 'Discord'),\\n                '!  For help with Metaphor and Humbug, check out our ',\\n                h('a', {href: 'https://youtube.com/@m6rai', target: '_blank'}, 'YouTube'),\\n                ' channel.'\\n            )\\n        )\\n    ];\\n}\\n\\nexport const blogPost_000011 = new BlogPost(\\n    'Introducing Metaphor commands',\\n    'Dave Hudson',\\n    '2025-04-24',\\n    '/blog/000011-Introducing-Metaphor-commands',\\n    'Learn how Humbug v0.10 introduces powerful command-line features for Metaphor that enable building reusable AI-powered tools.',\\n    '/blog/000011-Introducing-Metaphor-commands/introspection-screenshot.webp',\\n    blogArticle_000011\\n);\\n\",\n    \"error\": null\n}\n```",
      "completed": true,
      "tool_results": [
        {
          "id": "call_0",
          "name": "filesystem",
          "content": "File: m6r.ai/000011-Introducing-Metaphor-commands/post.ts\nSize: 13,866 bytes\nEncoding: utf-8\n\nimport {assertIsVElement, h, updateElement, VNode, VElement} from '../../lib/dvdi';\nimport {BlogPost} from '../BlogPost';\nimport {MetaphorParser} from '../../lib/syntax';\nimport {highlight} from '../../lib/highlight';\nimport {cloneObject} from '../../lib/cloneObject';\nimport {navigateEvent} from '../../app';\n\nconst code: VNode[][] = [[], []];\nlet codeVElement: (VElement | null)[] = [null, null];\nconst codeFunction: (() => VElement)[] = [\n    blogArticle_000011_ReviewCritic,\n    blogArticle_000011_Introspection\n];\n\n/**\n * Callback to write the contents of the file load for code fragments.\n * @param segment - The segment index to update\n * @param content - The content to write\n */\nfunction writeCode(segment: number, content: VNode[]) {\n    code[segment].push(...content);\n    if (codeVElement[segment] === null) {\n        return;\n    }\n\n    assertIsVElement(codeVElement[segment]);\n    if (codeVElement[segment].parentVNode === null) {\n        return;\n    }\n\n    const parentElem = (codeVElement[segment].parentVNode as VElement).domElement;\n    if (parentElem === null) {\n        return;\n    }\n\n    if (codeVElement[segment].domElement === null) {\n        return;\n    }\n\n    const index = Array.from(parentElem.childNodes).indexOf(codeVElement[segment].domElement);\n    const newVElement = codeFunction[segment]();\n    newVElement.parentVNode = codeVElement[segment].parentVNode;\n    updateElement(parentElem,\n        parentElem.childNodes[index],\n        codeVElement[segment].parentVNode as VElement,\n        codeVElement[segment],\n        newVElement\n    );\n    codeVElement[segment] = newVElement;\n}\n\n/**\n * Load Metaphor code file and prepare for highlighting\n */\nasync function loadFile(segment: number, filePath: string, storeFunction: (segment: number, content: VNode[]) => void) {\n    try {\n        const response = await fetch(filePath);\n        if (!response.ok) {\n            throw new Error(`Failed to fetch file: ${response.statusText}`);\n        }\n\n        const content = await response.text();\n        const formattedContent = highlight(content, MetaphorParser);\n\n        storeFunction(segment, formattedContent);\n    } catch (error) {\n        console.error('Error loading file:', error);\n    }\n}\n\n/**\n * Function to handle the first Metaphor code block (commit-critic)\n */\nfunction blogArticle_000011_ReviewCritic(): VElement {\n    let contents: VElement;\n    if (code[0].length === 0) {\n        contents = h('pre', {});\n    } else {\n        contents = h('pre', {}, h('code', {}, ...cloneObject(code[0])));\n    }\n\n    contents.mountCallback = () => {\n        codeVElement[0] = contents;\n        if (code[0].length === 0) {\n            loadFile(0, '/blog/000011-Introducing-Metaphor-commands/commit-critic.m6r', writeCode);\n        }\n    }\n\n    contents.unmountCallback = () => {\n        codeVElement[0] = null;\n    }\n\n    return contents;\n}\n\n/**\n * Function to handle the second Metaphor code block (introspection)\n */\nfunction blogArticle_000011_Introspection(): VElement {\n    let contents: VElement;\n    if (code[1].length === 0) {\n        contents = h('pre', {});\n    } else {\n        contents = h('pre', {}, h('code', {}, ...cloneObject(code[1])));\n    }\n\n    contents.mountCallback = () => {\n        codeVElement[1] = contents;\n        if (code[1].length === 0) {\n            loadFile(1, '/blog/000011-Introducing-Metaphor-commands/introspection.m6r', writeCode);\n        }\n    }\n\n    contents.unmountCallback = () => {\n        codeVElement[1] = null;\n    }\n\n    return contents;\n}\n\n/**\n * Main function to generate the blog post content\n */\nfunction blogArticle_000011(): VElement[] {\n    return [\n        h('p', {},\n            'The latest version of Humbug, v0.10, introduces the system shell.  This is an incredibly useful productivity ' +\n            'feature that lets you use built-in commands to create conversation, editor, and terminal windows in a way ' +\n            'that\\'s tricky to do from the GUI. The integration within Humbug, rather than making these regular command ' +\n            'line tools, means they can invoke GUI features - useful in itself. The big unlock, however, lies with the ' +\n            'updated ',\n            h('code', {}, 'm6rc'),\n            ' Metaphor compiler.'\n        ),\n        h('section', {},\n            h('h2', {}, 'Metaphor and the m6rc Metaphor compiler'),\n            h('p', {},\n                'Metaphor predates Humbug, and has been a part of the Humbug design since v0.1.  It allows you to define ' +\n                'the role, detailed context, and action you require for your AI to do its work.  It also allows you to ' +\n                'partition these elements into separate files and join them together and compile all the elements into a ' +\n                'prompt using ',\n                h('code', {}, 'm6rc'),\n                '.'\n            ),\n            h('p', {},\n                'This modular approach, familiar to software developers, allows you to independently maintain and version ' +\n                'important Metaphor components, allowing them to be used across many projects and tasks. Equally, these ' +\n                'components can be maintained by different teams allowing them to bring their unique expertise to bear.'\n            ),\n            h('p', {},\n                'As with programming language compilers, ',\n                h('code', {}, 'm6rc'),\n                ' also gets to perform correctness checks on the Metaphor files it ' +\n                'processes. This helps ensure the structure you present as a prompt will make sense to your AI models.'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'The v0.10 improvement'),\n            h('p', {},\n                'The ',\n                h('code', {}, 'm6rc'),\n                ' approach has been very powerful, but the user experience was a little awkward as you invariably ' +\n                'had to edit one or more Metaphor source files each time you wanted to do something slightly different.  ' +\n                'With v0.10 of Humbug it\\'s now possible to eliminate the major problem.'\n            ),\n            h('p', {},\n                'The new compiler can take \"argument references\" in ',\n                h('code', {}, 'Include'),\n                ' and ',\n                h('code', {}, 'Embed'),\n                ' statements. These take the form of ', \n                h('code', {}, '$<number>'),\n                ' where ',\n                h('code', {}, '<number>'),\n                ' is the number of the positional command line argument passed to ',\n                h('code', {}, 'm6rc'),\n                '. That may sound a little odd, so here\\'s an example:'\n            ),\n            h('pre', {},\n                h('code', {}, 'm6rc script.m6r -m gpt-4.1 cat.m6r dog.md')\n            ),\n            h('p', {},\n                'Positional arguments are the ones that don\\'t have option flags (things starting with a ',\n                h('code', {}, '-'),\n                ') and their associated option values (if they have them). In this example, the option ',\n                h('code', {}, '-m'),\n                ' has an option value of ',\n                h('code', {}, 'gpt-4.1'),\n                ', since it specifies the AI model to be used, and ',\n                h('code', {}, 'm6rc'),\n                ' is our command. This leaves ',\n                h('code', {}, 'script.m6r'),\n                ', ',\n                h('code', {}, 'cat.m6r'),\n                ', and ',\n                h('code', {}, 'dog.md'),\n                ' as our 3 positional arguments.  By convention we start numbering them from 0, ',\n                h('code', {}, 'script.m6r'),\n                ' is argument 0, ',\n                h('code', {}, 'cat'),\n                ' is argument 1, and ',\n                h('code', {}, 'dog'),\n                ' is argument 2.'\n            ),\n            h('p', {},\n                'If our ',\n                h('code', {}, 'script.m6r'),\n                ' file contains the statement: ',\n                h('code', {}, 'Embed: $2'),\n                ' then the compiler will replace ',\n                h('code', {}, '$2'),\n                ' with ',\n                h('code', {}, 'dog.md'),\n                ' and will try to embed a file called ',\n                h('code', {}, 'dog.md'),\n                ' into our compiled prompt. Similarly, if ',\n                h('code', {}, 'script.m6r'),\n                ' contains the statement ',\n                h('code', {}, 'Include: $1'),\n                ' then this will try to include another Metaphor file called ',\n                h('code', {}, 'cat.m6r'), '.'\n            ),\n            h('p', {},\n                'This very simple change makes it possible to define completely reusable AI-powered tools that need ' +\n                'no changes to be used for different purposes.  We simply pass extra parameters on the ',\n                h('code', {}, 'm6rc'),\n                ' command line.'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'Revisiting commit-critic'),\n            h('p', {},\n                'Last year we introduced an example of a Metaphor-powered tool, ',\n                h('a', {\n                        href: '/blog/000005-commit-critic',\n                        onclick: (e: MouseEvent) => navigateEvent(e, '/blog/000005-commit-critic')\n                    },\n                    'commit-critic'\n                ),\n                '. This is an AI-powered software code review tool.  To make this useful in November we had to build ' +\n                'a custom command line tool that could handle the positional argument handling.  With Humbug v0.10 ' +\n                'we no longer need to do this, instead allowing commit-critic\\'s functionality to be completely ' +\n                'described in Metaphor!'\n            ),\n            h('p', {},\n                'Here\\'s what a pure Metaphor version looks like:'\n            ),\n            h('figure', {},\n                blogArticle_000011_ReviewCritic(),\n                h('figcaption', {}, 'Metaphor code for the new commit-critic implementation')\n            ),\n            h('p', {},\n                'If you\\'re a keen observer, you may notice this has an enhancement on the original tool.  ' +\n                'This version ranks the importance of any issues it identifies to help you judge how serious ' +\n                'any issues might be.'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'An introspection tool'),\n            h('p', {},\n                'Now you\\'ve seen how you can solve an earlier problem in a simpler way, let\\'s look at how you can ' +\n                'solve a new problem.'\n            ),\n            h('p', {},\n                'A common question people have asked about Humbug is \"how easy is it to have one AI review the work ' +\n                'of another AI?\"  It turns out you can now solve this sort of problem quite easily with Humbug v0.10.'\n            ),\n            h('p', {},\n                'Humbug has always supported ',\n                h('code', {}, '.conv'),\n                ' files. These are JSON files that hold details of the conversations you have with ' +\n                'our AIs when using Humbug.  These are stored in the ',\n                h('code', {}, 'conversations'),\n                ' directory of any Humbug mindspace.'\n            ),\n            h('p', {},\n                'The approach outlined here took about 5 minutes to write, so it\\'s not refined, but you can see ' +\n                'the potential!'\n            ),\n            h('figure', {},\n                blogArticle_000011_Introspection(),\n                h('figcaption', {}, 'Metaphor code for the AI introspection tool')\n            ),\n            h('p', {},\n                'Here\\'s a screenshot of codestral (one of the Mistral models) reviewing a design change Metaphor ' +\n                'conversation I had with Claude Sonnet 3.7 about an aspect of the system shell design from a few days ago!'\n            ),\n            h('figure', {},\n                h('img', {\n                    src: '/blog/000011-Introducing-Metaphor-commands/introspection-screenshot.webp',\n                    alt: 'Screenshot of codestral reviewing a Metaphor conversation',\n                    width: 1024,\n                    height: 'auto'\n                })\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'What do you want to build?'),\n            h('p', {},\n                'We\\'ve seen how ',\n                h('code', {}, 'm6rc'),\n                ' within the Humbug system shell can now enable you to build a whole series of new AI-powered tools. ' +\n                'Couple this with the ability to now embed elements from previous conversations as well as other ' +\n                'documents and source code and the possibilities are amazing.'\n            ),\n            h('p', {},\n                'We\\'re excited to see what you will be able to build!'\n            ),\n            h('p', {},\n                'If you want to share your ideas, join us on ',\n                h('a', {href: 'https://discord.gg/GZhJ7ZtgwN', target: '_blank'}, 'Discord'),\n                '!  For help with Metaphor and Humbug, check out our ',\n                h('a', {href: 'https://youtube.com/@m6rai', target: '_blank'}, 'YouTube'),\n                ' channel.'\n            )\n        )\n    ];\n}\n\nexport const blogPost_000011 = new BlogPost(\n    'Introducing Metaphor commands',\n    'Dave Hudson',\n    '2025-04-24',\n    '/blog/000011-Introducing-Metaphor-commands',\n    'Learn how Humbug v0.10 introduces powerful command-line features for Metaphor that enable building reusable AI-powered tools.',\n    '/blog/000011-Introducing-Metaphor-commands/introspection-screenshot.webp',\n    blogArticle_000011\n);\n",
          "error": null
        }
      ]
    },
    {
      "id": "48a84eb4-6d4d-4d70-94bc-42c992549191",
      "timestamp": "2025-07-27T12:51:32.466425+00:00",
      "type": "user_message",
      "content": "",
      "completed": true,
      "tool_results": [
        {
          "id": "call_0",
          "name": "filesystem",
          "content": "File: m6r.ai/000011-Introducing-Metaphor-commands/post.ts\nSize: 13,866 bytes\nEncoding: utf-8\n\nimport {assertIsVElement, h, updateElement, VNode, VElement} from '../../lib/dvdi';\nimport {BlogPost} from '../BlogPost';\nimport {MetaphorParser} from '../../lib/syntax';\nimport {highlight} from '../../lib/highlight';\nimport {cloneObject} from '../../lib/cloneObject';\nimport {navigateEvent} from '../../app';\n\nconst code: VNode[][] = [[], []];\nlet codeVElement: (VElement | null)[] = [null, null];\nconst codeFunction: (() => VElement)[] = [\n    blogArticle_000011_ReviewCritic,\n    blogArticle_000011_Introspection\n];\n\n/**\n * Callback to write the contents of the file load for code fragments.\n * @param segment - The segment index to update\n * @param content - The content to write\n */\nfunction writeCode(segment: number, content: VNode[]) {\n    code[segment].push(...content);\n    if (codeVElement[segment] === null) {\n        return;\n    }\n\n    assertIsVElement(codeVElement[segment]);\n    if (codeVElement[segment].parentVNode === null) {\n        return;\n    }\n\n    const parentElem = (codeVElement[segment].parentVNode as VElement).domElement;\n    if (parentElem === null) {\n        return;\n    }\n\n    if (codeVElement[segment].domElement === null) {\n        return;\n    }\n\n    const index = Array.from(parentElem.childNodes).indexOf(codeVElement[segment].domElement);\n    const newVElement = codeFunction[segment]();\n    newVElement.parentVNode = codeVElement[segment].parentVNode;\n    updateElement(parentElem,\n        parentElem.childNodes[index],\n        codeVElement[segment].parentVNode as VElement,\n        codeVElement[segment],\n        newVElement\n    );\n    codeVElement[segment] = newVElement;\n}\n\n/**\n * Load Metaphor code file and prepare for highlighting\n */\nasync function loadFile(segment: number, filePath: string, storeFunction: (segment: number, content: VNode[]) => void) {\n    try {\n        const response = await fetch(filePath);\n        if (!response.ok) {\n            throw new Error(`Failed to fetch file: ${response.statusText}`);\n        }\n\n        const content = await response.text();\n        const formattedContent = highlight(content, MetaphorParser);\n\n        storeFunction(segment, formattedContent);\n    } catch (error) {\n        console.error('Error loading file:', error);\n    }\n}\n\n/**\n * Function to handle the first Metaphor code block (commit-critic)\n */\nfunction blogArticle_000011_ReviewCritic(): VElement {\n    let contents: VElement;\n    if (code[0].length === 0) {\n        contents = h('pre', {});\n    } else {\n        contents = h('pre', {}, h('code', {}, ...cloneObject(code[0])));\n    }\n\n    contents.mountCallback = () => {\n        codeVElement[0] = contents;\n        if (code[0].length === 0) {\n            loadFile(0, '/blog/000011-Introducing-Metaphor-commands/commit-critic.m6r', writeCode);\n        }\n    }\n\n    contents.unmountCallback = () => {\n        codeVElement[0] = null;\n    }\n\n    return contents;\n}\n\n/**\n * Function to handle the second Metaphor code block (introspection)\n */\nfunction blogArticle_000011_Introspection(): VElement {\n    let contents: VElement;\n    if (code[1].length === 0) {\n        contents = h('pre', {});\n    } else {\n        contents = h('pre', {}, h('code', {}, ...cloneObject(code[1])));\n    }\n\n    contents.mountCallback = () => {\n        codeVElement[1] = contents;\n        if (code[1].length === 0) {\n            loadFile(1, '/blog/000011-Introducing-Metaphor-commands/introspection.m6r', writeCode);\n        }\n    }\n\n    contents.unmountCallback = () => {\n        codeVElement[1] = null;\n    }\n\n    return contents;\n}\n\n/**\n * Main function to generate the blog post content\n */\nfunction blogArticle_000011(): VElement[] {\n    return [\n        h('p', {},\n            'The latest version of Humbug, v0.10, introduces the system shell.  This is an incredibly useful productivity ' +\n            'feature that lets you use built-in commands to create conversation, editor, and terminal windows in a way ' +\n            'that\\'s tricky to do from the GUI. The integration within Humbug, rather than making these regular command ' +\n            'line tools, means they can invoke GUI features - useful in itself. The big unlock, however, lies with the ' +\n            'updated ',\n            h('code', {}, 'm6rc'),\n            ' Metaphor compiler.'\n        ),\n        h('section', {},\n            h('h2', {}, 'Metaphor and the m6rc Metaphor compiler'),\n            h('p', {},\n                'Metaphor predates Humbug, and has been a part of the Humbug design since v0.1.  It allows you to define ' +\n                'the role, detailed context, and action you require for your AI to do its work.  It also allows you to ' +\n                'partition these elements into separate files and join them together and compile all the elements into a ' +\n                'prompt using ',\n                h('code', {}, 'm6rc'),\n                '.'\n            ),\n            h('p', {},\n                'This modular approach, familiar to software developers, allows you to independently maintain and version ' +\n                'important Metaphor components, allowing them to be used across many projects and tasks. Equally, these ' +\n                'components can be maintained by different teams allowing them to bring their unique expertise to bear.'\n            ),\n            h('p', {},\n                'As with programming language compilers, ',\n                h('code', {}, 'm6rc'),\n                ' also gets to perform correctness checks on the Metaphor files it ' +\n                'processes. This helps ensure the structure you present as a prompt will make sense to your AI models.'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'The v0.10 improvement'),\n            h('p', {},\n                'The ',\n                h('code', {}, 'm6rc'),\n                ' approach has been very powerful, but the user experience was a little awkward as you invariably ' +\n                'had to edit one or more Metaphor source files each time you wanted to do something slightly different.  ' +\n                'With v0.10 of Humbug it\\'s now possible to eliminate the major problem.'\n            ),\n            h('p', {},\n                'The new compiler can take \"argument references\" in ',\n                h('code', {}, 'Include'),\n                ' and ',\n                h('code', {}, 'Embed'),\n                ' statements. These take the form of ', \n                h('code', {}, '$<number>'),\n                ' where ',\n                h('code', {}, '<number>'),\n                ' is the number of the positional command line argument passed to ',\n                h('code', {}, 'm6rc'),\n                '. That may sound a little odd, so here\\'s an example:'\n            ),\n            h('pre', {},\n                h('code', {}, 'm6rc script.m6r -m gpt-4.1 cat.m6r dog.md')\n            ),\n            h('p', {},\n                'Positional arguments are the ones that don\\'t have option flags (things starting with a ',\n                h('code', {}, '-'),\n                ') and their associated option values (if they have them). In this example, the option ',\n                h('code', {}, '-m'),\n                ' has an option value of ',\n                h('code', {}, 'gpt-4.1'),\n                ', since it specifies the AI model to be used, and ',\n                h('code', {}, 'm6rc'),\n                ' is our command. This leaves ',\n                h('code', {}, 'script.m6r'),\n                ', ',\n                h('code', {}, 'cat.m6r'),\n                ', and ',\n                h('code', {}, 'dog.md'),\n                ' as our 3 positional arguments.  By convention we start numbering them from 0, ',\n                h('code', {}, 'script.m6r'),\n                ' is argument 0, ',\n                h('code', {}, 'cat'),\n                ' is argument 1, and ',\n                h('code', {}, 'dog'),\n                ' is argument 2.'\n            ),\n            h('p', {},\n                'If our ',\n                h('code', {}, 'script.m6r'),\n                ' file contains the statement: ',\n                h('code', {}, 'Embed: $2'),\n                ' then the compiler will replace ',\n                h('code', {}, '$2'),\n                ' with ',\n                h('code', {}, 'dog.md'),\n                ' and will try to embed a file called ',\n                h('code', {}, 'dog.md'),\n                ' into our compiled prompt. Similarly, if ',\n                h('code', {}, 'script.m6r'),\n                ' contains the statement ',\n                h('code', {}, 'Include: $1'),\n                ' then this will try to include another Metaphor file called ',\n                h('code', {}, 'cat.m6r'), '.'\n            ),\n            h('p', {},\n                'This very simple change makes it possible to define completely reusable AI-powered tools that need ' +\n                'no changes to be used for different purposes.  We simply pass extra parameters on the ',\n                h('code', {}, 'm6rc'),\n                ' command line.'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'Revisiting commit-critic'),\n            h('p', {},\n                'Last year we introduced an example of a Metaphor-powered tool, ',\n                h('a', {\n                        href: '/blog/000005-commit-critic',\n                        onclick: (e: MouseEvent) => navigateEvent(e, '/blog/000005-commit-critic')\n                    },\n                    'commit-critic'\n                ),\n                '. This is an AI-powered software code review tool.  To make this useful in November we had to build ' +\n                'a custom command line tool that could handle the positional argument handling.  With Humbug v0.10 ' +\n                'we no longer need to do this, instead allowing commit-critic\\'s functionality to be completely ' +\n                'described in Metaphor!'\n            ),\n            h('p', {},\n                'Here\\'s what a pure Metaphor version looks like:'\n            ),\n            h('figure', {},\n                blogArticle_000011_ReviewCritic(),\n                h('figcaption', {}, 'Metaphor code for the new commit-critic implementation')\n            ),\n            h('p', {},\n                'If you\\'re a keen observer, you may notice this has an enhancement on the original tool.  ' +\n                'This version ranks the importance of any issues it identifies to help you judge how serious ' +\n                'any issues might be.'\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'An introspection tool'),\n            h('p', {},\n                'Now you\\'ve seen how you can solve an earlier problem in a simpler way, let\\'s look at how you can ' +\n                'solve a new problem.'\n            ),\n            h('p', {},\n                'A common question people have asked about Humbug is \"how easy is it to have one AI review the work ' +\n                'of another AI?\"  It turns out you can now solve this sort of problem quite easily with Humbug v0.10.'\n            ),\n            h('p', {},\n                'Humbug has always supported ',\n                h('code', {}, '.conv'),\n                ' files. These are JSON files that hold details of the conversations you have with ' +\n                'our AIs when using Humbug.  These are stored in the ',\n                h('code', {}, 'conversations'),\n                ' directory of any Humbug mindspace.'\n            ),\n            h('p', {},\n                'The approach outlined here took about 5 minutes to write, so it\\'s not refined, but you can see ' +\n                'the potential!'\n            ),\n            h('figure', {},\n                blogArticle_000011_Introspection(),\n                h('figcaption', {}, 'Metaphor code for the AI introspection tool')\n            ),\n            h('p', {},\n                'Here\\'s a screenshot of codestral (one of the Mistral models) reviewing a design change Metaphor ' +\n                'conversation I had with Claude Sonnet 3.7 about an aspect of the system shell design from a few days ago!'\n            ),\n            h('figure', {},\n                h('img', {\n                    src: '/blog/000011-Introducing-Metaphor-commands/introspection-screenshot.webp',\n                    alt: 'Screenshot of codestral reviewing a Metaphor conversation',\n                    width: 1024,\n                    height: 'auto'\n                })\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'What do you want to build?'),\n            h('p', {},\n                'We\\'ve seen how ',\n                h('code', {}, 'm6rc'),\n                ' within the Humbug system shell can now enable you to build a whole series of new AI-powered tools. ' +\n                'Couple this with the ability to now embed elements from previous conversations as well as other ' +\n                'documents and source code and the possibilities are amazing.'\n            ),\n            h('p', {},\n                'We\\'re excited to see what you will be able to build!'\n            ),\n            h('p', {},\n                'If you want to share your ideas, join us on ',\n                h('a', {href: 'https://discord.gg/GZhJ7ZtgwN', target: '_blank'}, 'Discord'),\n                '!  For help with Metaphor and Humbug, check out our ',\n                h('a', {href: 'https://youtube.com/@m6rai', target: '_blank'}, 'YouTube'),\n                ' channel.'\n            )\n        )\n    ];\n}\n\nexport const blogPost_000011 = new BlogPost(\n    'Introducing Metaphor commands',\n    'Dave Hudson',\n    '2025-04-24',\n    '/blog/000011-Introducing-Metaphor-commands',\n    'Learn how Humbug v0.10 introduces powerful command-line features for Metaphor that enable building reusable AI-powered tools.',\n    '/blog/000011-Introducing-Metaphor-commands/introspection-screenshot.webp',\n    blogArticle_000011\n);\n",
          "error": null
        }
      ]
    },
    {
      "id": "88a19158-5c6c-444d-bacd-247827169962",
      "timestamp": "2025-07-27T12:51:33.762645+00:00",
      "type": "ai_response",
      "content": "",
      "completed": true,
      "model": "gemini-1.5-flash",
      "reasoning_capability": 1,
      "temperature": 0.7,
      "tool_calls": [
        {
          "id": "call_0",
          "name": "filesystem",
          "arguments": {
            "path": "m6r.ai/000012-Writing-tests-with-Metaphor/post.ts",
            "operation": "read_file"
          }
        }
      ]
    },
    {
      "id": "f1f63215-8354-4bce-a628-05cbbe945b50",
      "timestamp": "2025-07-27T12:51:33.771829+00:00",
      "type": "tool_call",
      "content": "```json\n{\n    \"id\": \"call_0\",\n    \"name\": \"filesystem\",\n    \"arguments\": {\n        \"path\": \"m6r.ai/000012-Writing-tests-with-Metaphor/post.ts\",\n        \"operation\": \"read_file\"\n    }\n}\n```",
      "completed": true,
      "tool_calls": [
        {
          "id": "call_0",
          "name": "filesystem",
          "arguments": {
            "path": "m6r.ai/000012-Writing-tests-with-Metaphor/post.ts",
            "operation": "read_file"
          }
        }
      ]
    },
    {
      "id": "18f71b9a-f76a-4a96-958e-6de4f6ecb650",
      "timestamp": "2025-07-27T12:51:33.783192+00:00",
      "type": "tool_result",
      "content": "```json\n{\n    \"id\": \"call_0\",\n    \"name\": \"filesystem\",\n    \"content\": \"File: m6r.ai/000012-Writing-tests-with-Metaphor/post.ts\\nSize: 6,313 bytes\\nEncoding: utf-8\\n\\nimport {h, VElement} from '../../lib/dvdi';\\nimport {BlogPost} from '../BlogPost';\\n\\nfunction blogArticle_000012(): VElement[] {\\n    return [\\n        h('p', {},\\n            'Over the last few months, quite a few people have asked me whether it\\\\'s possible to get an AI to build good tests for ' +\\n            'software. I\\\\'ve always told them LLMs can do a pretty amazing job, but you need to be very clear about what you want them ' +\\n            'to do. I\\\\'ve also been asked how I manage to get large amounts of working code from Metaphor prompts.'\\n        ),\\n        h('p', {},\\n            'I figured a good example might go a long way!'\\n        ),\\n        h('p', {},\\n            'Over the last month or so, I\\\\'ve built a new Markdown parser (abstract syntax tree builder). I needed to add some tests, ' +\\n            'so I recorded a video of me adding them. All done using a couple of Metaphor prompts and Humbug.'\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'Why Humbug has its own Markdown parser'),\\n            h('p', {},\\n                'You might be asking why Humbug has a special Markdown parser.  After all, there are lots of good open-source ones around. ' +\\n                'The answer is Humbug has a few unusual requirements:'\\n            ),\\n            h('ul', {},\\n                h('li', {},\\n                    'There are a lot of parsing capabilities inside Humbug and I want them to all work in a consistent way to make the code ' +\\n                    'easier to understand.'\\n                ),\\n                h('li', {},\\n                    'Most Markdown parsers assume a complete Markdown file, but Humbug has to deal with streaming responses from LLMs and ' +\\n                    'that means we can end up with contents that don\\\\'t make sense until more data arrives. Humbug has to handle that gracefully.'\\n                ),\\n                h('li', {},\\n                    'Markdown doesn\\\\'t have a very clean syntax and has some interesting quirks. One important one for Humbug is around ' +\\n                    'the handling of code fence blocks (denoted by 3 backticks). Humbug needs to handle the scenario where a code fence ' +\\n                    'appears inside a code block (e.g. in a multi-line string or comment block).'\\n                )\\n            )\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'Building tests with AI assistance'),\\n            h('p', {},\\n                'The video has two halves. The first walks through setting up the original test design and shows how to have an ' +\\n                'LLM build something new with some constraints. The second shows the original tests being enhanced.'\\n            ),\\n            h('p', {},\\n                'At the end there\\\\'s 90%+ test coverage and about 1400 lines of commented tests and test support.'\\n            ),\\n            h('figure', {},\\n                h('div', {\\n                    style: 'position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; background: #000;'\\n                },\\n                    h('iframe', {\\n                        src: 'https://www.youtube.com/embed/Q0BGCs_4flk',\\n                        style: 'position: absolute; top: 0; left: 0; width: 100%; height: 100%;',\\n                        width: 560,\\n                        height: 315,\\n                        title: 'Writing tests with Metaphor',\\n                        'aria-label': 'YouTube video: Writing tests with Metaphor'\\n                    })\\n                ),\\n                h('figcaption', {}, 'Writing tests with Metaphor demonstration')\\n            )\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'Key takeaways'),\\n            h('p', {},\\n                'This demonstration shows several important principles for successful AI-assisted development:'\\n            ),\\n            h('ul', {},\\n                h('li', {},\\n                    'Clear constraints and requirements lead to better AI output. By being specific about what the tests needed to do, ' +\\n                    'the AI could generate appropriate test cases.'\\n                ),\\n                h('li', {},\\n                    'Metaphor\\\\'s structured approach helps maintain consistency across different AI interactions, making it easier to ' +\\n                    'build on previous work.'\\n                ),\\n                h('li', {},\\n                    'Iterative enhancement works well with AI assistance. Starting with a solid foundation and then building on it ' +\\n                    'produces better results than trying to create everything at once.'\\n                ),\\n                h('li', {},\\n                    'Good test coverage is achievable with AI assistance when you provide proper context and clear expectations.'\\n                )\\n            )\\n        ),\\n        h('section', {},\\n            h('h2', {}, 'What\\\\'s next?'),\\n            h('p', {},\\n                'This example demonstrates how Metaphor and Humbug can work together to produce substantial, high-quality code with ' +\\n                'AI assistance. The ability to generate comprehensive test suites quickly and reliably is a significant productivity ' +\\n                'multiplier for any development team.'\\n            ),\\n            h('p', {},\\n                'If you\\\\'re interested in trying this approach yourself, check out our ',\\n                h('a', {\\n                    href: 'https://github.com/m6r-ai/getting-started-with-metaphor',\\n                    target: '_blank',\\n                    title: 'Getting started with Metaphor guide'\\n                }, 'getting started guide'),\\n                ' and join us on ',\\n                h('a', {href: 'https://discord.gg/GZhJ7ZtgwN', target: '_blank'}, 'Discord'),\\n                ' to share your experiences and learn from others in the community.'\\n            )\\n        )\\n    ];\\n}\\n\\nexport const blogPost_000012 = new BlogPost(\\n    'Writing tests with Metaphor',\\n    'Dave Hudson',\\n    '2025-06-01',\\n    '/blog/000012-Writing-tests-with-Metaphor',\\n    'A practical demonstration of using Metaphor and AI assistance to build comprehensive test suites, showing how to get large amounts of working code from structured prompts.',\\n    null, // No featured image provided in the original markdown\\n    blogArticle_000012\\n);\\n\",\n    \"error\": null\n}\n```",
      "completed": true,
      "tool_results": [
        {
          "id": "call_0",
          "name": "filesystem",
          "content": "File: m6r.ai/000012-Writing-tests-with-Metaphor/post.ts\nSize: 6,313 bytes\nEncoding: utf-8\n\nimport {h, VElement} from '../../lib/dvdi';\nimport {BlogPost} from '../BlogPost';\n\nfunction blogArticle_000012(): VElement[] {\n    return [\n        h('p', {},\n            'Over the last few months, quite a few people have asked me whether it\\'s possible to get an AI to build good tests for ' +\n            'software. I\\'ve always told them LLMs can do a pretty amazing job, but you need to be very clear about what you want them ' +\n            'to do. I\\'ve also been asked how I manage to get large amounts of working code from Metaphor prompts.'\n        ),\n        h('p', {},\n            'I figured a good example might go a long way!'\n        ),\n        h('p', {},\n            'Over the last month or so, I\\'ve built a new Markdown parser (abstract syntax tree builder). I needed to add some tests, ' +\n            'so I recorded a video of me adding them. All done using a couple of Metaphor prompts and Humbug.'\n        ),\n        h('section', {},\n            h('h2', {}, 'Why Humbug has its own Markdown parser'),\n            h('p', {},\n                'You might be asking why Humbug has a special Markdown parser.  After all, there are lots of good open-source ones around. ' +\n                'The answer is Humbug has a few unusual requirements:'\n            ),\n            h('ul', {},\n                h('li', {},\n                    'There are a lot of parsing capabilities inside Humbug and I want them to all work in a consistent way to make the code ' +\n                    'easier to understand.'\n                ),\n                h('li', {},\n                    'Most Markdown parsers assume a complete Markdown file, but Humbug has to deal with streaming responses from LLMs and ' +\n                    'that means we can end up with contents that don\\'t make sense until more data arrives. Humbug has to handle that gracefully.'\n                ),\n                h('li', {},\n                    'Markdown doesn\\'t have a very clean syntax and has some interesting quirks. One important one for Humbug is around ' +\n                    'the handling of code fence blocks (denoted by 3 backticks). Humbug needs to handle the scenario where a code fence ' +\n                    'appears inside a code block (e.g. in a multi-line string or comment block).'\n                )\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'Building tests with AI assistance'),\n            h('p', {},\n                'The video has two halves. The first walks through setting up the original test design and shows how to have an ' +\n                'LLM build something new with some constraints. The second shows the original tests being enhanced.'\n            ),\n            h('p', {},\n                'At the end there\\'s 90%+ test coverage and about 1400 lines of commented tests and test support.'\n            ),\n            h('figure', {},\n                h('div', {\n                    style: 'position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; background: #000;'\n                },\n                    h('iframe', {\n                        src: 'https://www.youtube.com/embed/Q0BGCs_4flk',\n                        style: 'position: absolute; top: 0; left: 0; width: 100%; height: 100%;',\n                        width: 560,\n                        height: 315,\n                        title: 'Writing tests with Metaphor',\n                        'aria-label': 'YouTube video: Writing tests with Metaphor'\n                    })\n                ),\n                h('figcaption', {}, 'Writing tests with Metaphor demonstration')\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'Key takeaways'),\n            h('p', {},\n                'This demonstration shows several important principles for successful AI-assisted development:'\n            ),\n            h('ul', {},\n                h('li', {},\n                    'Clear constraints and requirements lead to better AI output. By being specific about what the tests needed to do, ' +\n                    'the AI could generate appropriate test cases.'\n                ),\n                h('li', {},\n                    'Metaphor\\'s structured approach helps maintain consistency across different AI interactions, making it easier to ' +\n                    'build on previous work.'\n                ),\n                h('li', {},\n                    'Iterative enhancement works well with AI assistance. Starting with a solid foundation and then building on it ' +\n                    'produces better results than trying to create everything at once.'\n                ),\n                h('li', {},\n                    'Good test coverage is achievable with AI assistance when you provide proper context and clear expectations.'\n                )\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'What\\'s next?'),\n            h('p', {},\n                'This example demonstrates how Metaphor and Humbug can work together to produce substantial, high-quality code with ' +\n                'AI assistance. The ability to generate comprehensive test suites quickly and reliably is a significant productivity ' +\n                'multiplier for any development team.'\n            ),\n            h('p', {},\n                'If you\\'re interested in trying this approach yourself, check out our ',\n                h('a', {\n                    href: 'https://github.com/m6r-ai/getting-started-with-metaphor',\n                    target: '_blank',\n                    title: 'Getting started with Metaphor guide'\n                }, 'getting started guide'),\n                ' and join us on ',\n                h('a', {href: 'https://discord.gg/GZhJ7ZtgwN', target: '_blank'}, 'Discord'),\n                ' to share your experiences and learn from others in the community.'\n            )\n        )\n    ];\n}\n\nexport const blogPost_000012 = new BlogPost(\n    'Writing tests with Metaphor',\n    'Dave Hudson',\n    '2025-06-01',\n    '/blog/000012-Writing-tests-with-Metaphor',\n    'A practical demonstration of using Metaphor and AI assistance to build comprehensive test suites, showing how to get large amounts of working code from structured prompts.',\n    null, // No featured image provided in the original markdown\n    blogArticle_000012\n);\n",
          "error": null
        }
      ]
    },
    {
      "id": "e28c2233-e80d-475d-a597-a53ea0b97728",
      "timestamp": "2025-07-27T12:51:33.793196+00:00",
      "type": "user_message",
      "content": "",
      "completed": true,
      "tool_results": [
        {
          "id": "call_0",
          "name": "filesystem",
          "content": "File: m6r.ai/000012-Writing-tests-with-Metaphor/post.ts\nSize: 6,313 bytes\nEncoding: utf-8\n\nimport {h, VElement} from '../../lib/dvdi';\nimport {BlogPost} from '../BlogPost';\n\nfunction blogArticle_000012(): VElement[] {\n    return [\n        h('p', {},\n            'Over the last few months, quite a few people have asked me whether it\\'s possible to get an AI to build good tests for ' +\n            'software. I\\'ve always told them LLMs can do a pretty amazing job, but you need to be very clear about what you want them ' +\n            'to do. I\\'ve also been asked how I manage to get large amounts of working code from Metaphor prompts.'\n        ),\n        h('p', {},\n            'I figured a good example might go a long way!'\n        ),\n        h('p', {},\n            'Over the last month or so, I\\'ve built a new Markdown parser (abstract syntax tree builder). I needed to add some tests, ' +\n            'so I recorded a video of me adding them. All done using a couple of Metaphor prompts and Humbug.'\n        ),\n        h('section', {},\n            h('h2', {}, 'Why Humbug has its own Markdown parser'),\n            h('p', {},\n                'You might be asking why Humbug has a special Markdown parser.  After all, there are lots of good open-source ones around. ' +\n                'The answer is Humbug has a few unusual requirements:'\n            ),\n            h('ul', {},\n                h('li', {},\n                    'There are a lot of parsing capabilities inside Humbug and I want them to all work in a consistent way to make the code ' +\n                    'easier to understand.'\n                ),\n                h('li', {},\n                    'Most Markdown parsers assume a complete Markdown file, but Humbug has to deal with streaming responses from LLMs and ' +\n                    'that means we can end up with contents that don\\'t make sense until more data arrives. Humbug has to handle that gracefully.'\n                ),\n                h('li', {},\n                    'Markdown doesn\\'t have a very clean syntax and has some interesting quirks. One important one for Humbug is around ' +\n                    'the handling of code fence blocks (denoted by 3 backticks). Humbug needs to handle the scenario where a code fence ' +\n                    'appears inside a code block (e.g. in a multi-line string or comment block).'\n                )\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'Building tests with AI assistance'),\n            h('p', {},\n                'The video has two halves. The first walks through setting up the original test design and shows how to have an ' +\n                'LLM build something new with some constraints. The second shows the original tests being enhanced.'\n            ),\n            h('p', {},\n                'At the end there\\'s 90%+ test coverage and about 1400 lines of commented tests and test support.'\n            ),\n            h('figure', {},\n                h('div', {\n                    style: 'position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; background: #000;'\n                },\n                    h('iframe', {\n                        src: 'https://www.youtube.com/embed/Q0BGCs_4flk',\n                        style: 'position: absolute; top: 0; left: 0; width: 100%; height: 100%;',\n                        width: 560,\n                        height: 315,\n                        title: 'Writing tests with Metaphor',\n                        'aria-label': 'YouTube video: Writing tests with Metaphor'\n                    })\n                ),\n                h('figcaption', {}, 'Writing tests with Metaphor demonstration')\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'Key takeaways'),\n            h('p', {},\n                'This demonstration shows several important principles for successful AI-assisted development:'\n            ),\n            h('ul', {},\n                h('li', {},\n                    'Clear constraints and requirements lead to better AI output. By being specific about what the tests needed to do, ' +\n                    'the AI could generate appropriate test cases.'\n                ),\n                h('li', {},\n                    'Metaphor\\'s structured approach helps maintain consistency across different AI interactions, making it easier to ' +\n                    'build on previous work.'\n                ),\n                h('li', {},\n                    'Iterative enhancement works well with AI assistance. Starting with a solid foundation and then building on it ' +\n                    'produces better results than trying to create everything at once.'\n                ),\n                h('li', {},\n                    'Good test coverage is achievable with AI assistance when you provide proper context and clear expectations.'\n                )\n            )\n        ),\n        h('section', {},\n            h('h2', {}, 'What\\'s next?'),\n            h('p', {},\n                'This example demonstrates how Metaphor and Humbug can work together to produce substantial, high-quality code with ' +\n                'AI assistance. The ability to generate comprehensive test suites quickly and reliably is a significant productivity ' +\n                'multiplier for any development team.'\n            ),\n            h('p', {},\n                'If you\\'re interested in trying this approach yourself, check out our ',\n                h('a', {\n                    href: 'https://github.com/m6r-ai/getting-started-with-metaphor',\n                    target: '_blank',\n                    title: 'Getting started with Metaphor guide'\n                }, 'getting started guide'),\n                ' and join us on ',\n                h('a', {href: 'https://discord.gg/GZhJ7ZtgwN', target: '_blank'}, 'Discord'),\n                ' to share your experiences and learn from others in the community.'\n            )\n        )\n    ];\n}\n\nexport const blogPost_000012 = new BlogPost(\n    'Writing tests with Metaphor',\n    'Dave Hudson',\n    '2025-06-01',\n    '/blog/000012-Writing-tests-with-Metaphor',\n    'A practical demonstration of using Metaphor and AI assistance to build comprehensive test suites, showing how to get large amounts of working code from structured prompts.',\n    null, // No featured image provided in the original markdown\n    blogArticle_000012\n);\n",
          "error": null
        }
      ]
    },
    {
      "id": "b18d3b50-f1c5-4a5c-888f-f50df085fd01",
      "timestamp": "2025-07-27T12:51:36.725181+00:00",
      "type": "system_message",
      "content": "Server failed to complete response",
      "completed": true,
      "error": {
        "code": "cancelled",
        "message": "Server failed to complete response",
        "details": {
          "type": "CancelledError"
        }
      }
    }
  ]
}